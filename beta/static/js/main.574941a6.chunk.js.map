{"version":3,"sources":["../../src/netmd.ts","../../src/netmd-interface.ts","../../src/index.ts","../../src/encrypt-generator.ts","../../src/web-encrypt-worker.ts","images/chrome-icon.svg","../../src/query-utils.ts","../../src/netmd-commands.ts","../../netmd-js/dist/web-encrypt-worker.js","webpack:///./src/services/atracdenc-worker.ts?dc3c","utils.ts","services/netmd.ts","services/registry.ts","redux/upload-dialog-feature.ts","redux/rename-dialog-feature.ts","redux/error-dialog-feature.ts","redux/panic-dialog-feature.ts","redux/convert-dialog-feature.ts","redux/dump-dialog-feature.ts","redux/record-dialog-feature.ts","redux/app-feature.ts","redux/main-feature.ts","redux/store.ts","redux/actions.ts","components/about-dialog.tsx","components/topmenu.tsx","components/welcome.tsx","components/rename-dialog.tsx","components/upload-dialog.tsx","components/record-dialog.tsx","components/error-dialog.tsx","components/panic-dialog.tsx","components/convert-dialog.tsx","images/md0.svg","images/md1.svg","images/md2.svg","images/md3.svg","components/controls.tsx","components/dump-dialog.tsx","components/main.tsx","components/app.tsx","services/atracdenc-worker.ts","services/audio-export.ts","index.tsx","services/mediarecorder.ts","../../src/utils.ts"],"names":["vendorId","deviceId","name","device","res","i","len","module","exports","Worker","sleep","ms","Promise","resolve","setTimeout","async","sleepWithProgressCallback","cb","elapsedSecs","interval","setInterval","Math","min","window","clearInterval","useShallowEqualSelector","selector","useSelector","shallowEqual","getPublicPathFor","script","savePreference","key","value","localStorage","setItem","JSON","stringify","loadPreference","defaultValue","getItem","parse","e","sanitizeTitle","title","normalize","replace","EncodingName","Encoding","sp","lp2","lp4","getSortedTracks","disc","tracks","group","groups","track","push","index","encoding","duration","formatTimeFromFrames","sort","l","r","asyncMutex","target","propertyKey","descriptor","oldValue","args","mutex","this","release","acquire","apply","forAnyDesktop","theme","breakpoints","up","spacing","belowDesktop","down","forWideDesktop","require","NetMDUSBService","constructor","debug","netmdInterface","logger","Mutex","statusMonitorTimer","_fn","method","console","log","info","warn","error","child","iface","openNewDevice","navigator","usb","openPairedDevice","listContent","getDeviceStatus","netMd","getDeviceName","finalize","cacheTOC","setTrackTitle","syncTOC","newName","oldName","getDiscTitle","oldRawName","_getDiscTitle","hasGroups","indexOf","hasGroupsAndTitle","startsWith","newNameWithGroups","setDiscTitle","eraseTrack","eraseDisc","src","dst","moveTrack","data","format","progressCallback","total","byteLength","written","encrypted","updateProgress","w","webWorkerAsyncPacketIterator","makeGetAsyncPacketIteratorOnWorkerThread","encryptedBytes","mdTrack","MDTrack","download","writtenBytes","terminate","play","pause","stop","nextTrack","previousTrack","gotoTrack","getPosition","ServiceRegistry","slice","createSlice","initialState","visible","writtenProgress","encryptedProgress","totalProgress","trackTotal","trackConverting","trackCurrent","titleCurrent","titleConverting","reducers","setVisible","state","action","payload","setWriteProgress","setTrackProgress","current","converting","reducer","actions","enableBatching","setCurrentName","setIndex","setErrorMessage","dismissed","dismiss","titleSource","titleFormat","setFormat","setTitleSource","setTitleFormat","inputDeviceId","setInputDeviceId","trackDone","setProgress","mainView","loading","pairingFailed","pairingMessage","browserSupported","darkMode","aboutDialogVisible","setState","setLoading","setPairingFailed","setPairingMessage","setBrowserSupported","setDarkMode","showAboutDialog","deviceName","deviceStatus","setDisc","setDeviceName","setDeviceStatus","combineReducers","renameDialog","uploadDialog","errorDialog","panicDialog","convertDialog","dumpDialog","recordDialog","appState","main","resetStateAction","appActions","toString","store","configureStore","type","middleware","next","panicDialogActions","getDefaultMiddleware","Object","freeze","getState","control","params","dispatch","serviceRegistry","netmdService","prev","mainActions","appStateActions","batchActions","WireformatDict","SP","Wireformat","pcm","LP2","LP105","l105kbps","LP4","getTrackNameFromMediaTags","file","fileData","arrayBuffer","reject","jsmediatags","read","Blob","onSuccess","tags","artist","album","onError","convertAndUpload","files","audioExportService","wireformat","uploadDialogActions","updateProgressCallback","trackUpdate","length","updateTrack","maxTitleLength","getTracks","map","reduce","acc","floor","errorMessage","item","converted","convertNext","f","prepare","export","err","j","conversionIterator","extStartIndex","lastIndexOf","substring","upload","actionToDispatch","concat","errorDialogAction","Transition","React","forwardRef","props","ref","Slide","direction","AboutDialog","useDispatch","Dialog","open","maxWidth","fullWidth","TransitionComponent","aria-labelledby","DialogTitle","id","DialogContent","DialogContentText","Link","rel","href","DialogActions","Button","onClick","useStyles","makeStyles","listItemIcon","minWidth","TopMenu","classes","discTitle","githubLinkRef","useRef","menuAnchorEl","setMenuAnchorEl","useState","menuOpen","Boolean","handleMenuOpen","useCallback","event","currentTarget","handleDarkMode","handleMenuClose","handleWipeDisc","confirm","wipeDisc","handleRefresh","handleRenameDisc","renameDialogActions","handleExit","handleShowAbout","handleGithubLink","stopPropagation","click","menuItems","MenuItem","ListItemIcon","className","fontSize","ListItemText","Fragment","IconButton","aria-label","aria-controls","aria-haspopup","Menu","anchorEl","keepMounted","onClose","position","flex","display","justifyContent","flexDirection","alignItems","button","marginTop","chromeLogo","width","height","why","alignSelf","headBox","Welcome","toLowerCase","match","showWhyUnsupported","setWhyUnsupported","Box","Typography","component","variant","align","color","init","connect","pair","message","FormControl","style","visibility","FormHelperText","preventDefault","alt","ChromeIconPath","RenameDialog","renameDialogVisible","renameDialogTitle","renameDialogIndex","what","handleCancelRename","handleDoRename","renameDisc","renameTrack","TextField","autoFocus","label","onKeyDown","onChange","progressPerc","progressBar","uploadLabel","UploadDialog","progressValue","bufferValue","convertedValue","aria-describedby","LinearProgress","valueBuffer","RecordDialog","round","ErrorDialog","handleClose","errorDialogActions","PanicDialog","handleReloadApp","location","reload","handleIgnore","scroll","size","container","formControl","toggleButton","dialogContent","flexWrap","rightBlock","titleFormControl","ConvertDialog","convertDialogActions","handleChangeFormat","ev","newFormat","handleChangeTitleSource","newTitleSource","handleChangeTitleFormat","handleConvert","ToggleButtonGroup","exclusive","ToggleButton","Select","input","Input","_extends","assign","arguments","source","prototype","hasOwnProperty","call","createElement","fill","fillRule","d","SvgMd0","svgRef","viewBox","ForwardRef","SvgMd1","SvgMd2","SvgMd3","frames","MDIcon0","MDIcon1","MDIcon2","MDIcon3","from","transform","to","lcd","marginLeft","marginRight","paddingLeft","paddingRight","borderRadius","backgroundColor","palette","background","default","lcdText","overflow","left","fontFamily","lcdDisc","top","lcdDiscIcon","active","scrollingStatusMessage","whiteSpace","animationName","animationTimingFunction","animationIterationCount","statusMessage","Controls","handlePrev","handlePlay","handleStop","handleNext","trackIndex","deviceState","discPresent","lcdScroll","setLcdScroll","lcdScrollDuration","setLcdScrollDuration","lcdIconFrame","setLcdIconFrame","scrollTimerRef","lcdRef","useEffect","clearTimeout","domEl","textWidth","scrollWidth","lcdWidth","parentElement","offsetWidth","scrollDurationInSec","updateLCDScroll","lcdIconAnimationTimer","DiscFrame","animationDuration","flexFlow","selectEmpty","head","textShadow","typography","h2","textAlign","marginBottom","DumpDialog","trackIndexes","devices","setDevices","mediaRecorderService","stopTestInput","dumpDialogActions","handleChange","playTestInput","handleStartTransfer","indexes","recordDialogAction","filter","t","entries","expected","every","_","initStream","startRecording","durationInSec","perc","stopRecording","downloadRecorded","closeStream","mediaDevices","getUserMedia","audio","inputDevices","enumerateDevices","kind","updateDeviceList","displayEmpty","disabled","add","bottom","right","overflowY","outline","toolbar","toolbarLabel","toolbarHighlight","secondary","lighten","light","text","primary","dark","formatBadge","BadgeImpl","badge","colorPrimary","border","paper","padding","verticalAlign","titleCell","textOverflow","durationCell","durationCellTime","indexCell","backdrop","zIndex","drawer","remainingTimeTooltip","textDecoration","textDecorationStyle","Main","selected","setSelected","selectedCount","moveMenuAnchorEl","setMoveMenuAnchorEl","handleShowMoveMenu","handleCloseMoveMenu","handleMoveSelectedTrack","destIndex","srcIndex","handleShowDumpDialog","uploadedFiles","setUploadedFiles","onDrop","acceptedFiles","rejectedFiles","getRootProps","getInputProps","isDragActive","useDropzone","accept","noClick","handleRenameDoubleClick","selectedIndex","currentName","find","Tooltip","arrow","Toolbar","clsx","Checkbox","indeterminate","checked","inputProps","PaperProps","maxHeight","Array","reverse","deleteTrack","Table","TableHead","TableRow","TableCell","TableBody","hover","includes","onDoubleClick","handleSelectClick","Backdrop","Fab","layout","bottomBar","copyrightTypography","minidiscLogo","controlsContainer","darkTheme","createMuiTheme","contrastText","lightTheme","App","ThemeProvider","CssBaseline","Paper","Date","getFullYear","CircularProgress","AtracdencProcess","worker","messageCallback","onmessage","handleMessage","bind","postMessage","bitrate","result","undefined","WorkerGlobalScope","self","Module","others","importScripts","then","m","setLogger","msg","stream","inWavFile","outAt3File","dataArray","Uint8Array","FS","writeFile","callMain","stat","tmp","outAt3FileStream","close","buffer","AtracdencWorker","ffmpegProcess","atracdencProcess","loglines","inFileName","outFileNameNoExt","setLogging","createWorker","corePath","workerPath","load","ext","split","Error","write","transcode","audioFormatRegex","inputFormatRegex","line","outFileName","encode","recorder","audioContext","analyserNode","gainNode","AudioContext","createGain","createAnalyser","createMediaStreamSource","destination","recordConstraints","autoGainControl","channelCount","echoCancellation","noiseSuppression","sampleRate","highpassFilter","audioTracks","getAudioTracks","getSettings","Recorder","record","forEach","exportWAV","url","URL","createObjectURL","a","document","body","appendChild","revokeObjectURL","removeChild","deferredPrompt","addEventListener","returnValue","ondisconnect","statusMonitorInterval","exceptionOccurred","shouldMonitorBeRunning","subscribe","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.574941a6.chunk.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"util\");\nvar utils_1 = require(\"./utils\");\nvar BULK_WRITE_ENDPOINT = 0x02;\nvar BULK_READ_ENDPOINT = 0x81;\nexports.DevicesIds = [\n    { vendorId: 0x04dd, deviceId: 0x7202, name: 'Sharp IM-MT899H' },\n    { vendorId: 0x04dd, deviceId: 0x9013, name: 'Sharp IM-DR400' },\n    { vendorId: 0x04dd, deviceId: 0x9014, name: 'Sharp IM-DR80' },\n    { vendorId: 0x054c, deviceId: 0x0034, name: 'Sony PCLK-XX' },\n    { vendorId: 0x054c, deviceId: 0x0036, name: 'Sony' },\n    { vendorId: 0x054c, deviceId: 0x0075, name: 'Sony MZ-N1' },\n    { vendorId: 0x054c, deviceId: 0x007c, name: 'Sony' },\n    { vendorId: 0x054c, deviceId: 0x0080, name: 'Sony LAM-1' },\n    { vendorId: 0x054c, deviceId: 0x0081, name: 'Sony MDS-JB980' },\n    { vendorId: 0x054c, deviceId: 0x0084, name: 'Sony MZ-N505' },\n    { vendorId: 0x054c, deviceId: 0x0085, name: 'Sony MZ-S1' },\n    { vendorId: 0x054c, deviceId: 0x0086, name: 'Sony MZ-N707' },\n    { vendorId: 0x054c, deviceId: 0x008e, name: 'Sony CMT-C7NT' },\n    { vendorId: 0x054c, deviceId: 0x0097, name: 'Sony PCGA-MDN1' },\n    { vendorId: 0x054c, deviceId: 0x00ad, name: 'Sony CMT-L7HD' },\n    { vendorId: 0x054c, deviceId: 0x00c6, name: 'Sony MZ-N10' },\n    { vendorId: 0x054c, deviceId: 0x00c7, name: 'Sony MZ-N910' },\n    { vendorId: 0x054c, deviceId: 0x00c8, name: 'Sony MZ-N710/NF810' },\n    { vendorId: 0x054c, deviceId: 0x00c9, name: 'Sony MZ-N510/N610' },\n    { vendorId: 0x054c, deviceId: 0x00ca, name: 'Sony MZ-NE410/NF520D' },\n    { vendorId: 0x054c, deviceId: 0x00eb, name: 'Sony MZ-NE810/NE910' },\n    { vendorId: 0x054c, deviceId: 0x0101, name: 'Sony LAM-10' },\n    { vendorId: 0x054c, deviceId: 0x0113, name: 'Aiwa AM-NX1' },\n    { vendorId: 0x054c, deviceId: 0x014c, name: 'Aiwa AM-NX9' },\n    { vendorId: 0x054c, deviceId: 0x017e, name: 'Sony MZ-NH1' },\n    { vendorId: 0x054c, deviceId: 0x0180, name: 'Sony MZ-NH3D' },\n    { vendorId: 0x054c, deviceId: 0x0182, name: 'Sony MZ-NH900' },\n    { vendorId: 0x054c, deviceId: 0x0184, name: 'Sony MZ-NH700/NH800' },\n    { vendorId: 0x054c, deviceId: 0x0186, name: 'Sony MZ-NH600/NH600D' },\n    { vendorId: 0x054c, deviceId: 0x0188, name: 'Sony MZ-N920' },\n    { vendorId: 0x054c, deviceId: 0x018a, name: 'Sony LAM-3' },\n    { vendorId: 0x054c, deviceId: 0x01e9, name: 'Sony MZ-DH10P' },\n    { vendorId: 0x054c, deviceId: 0x0219, name: 'Sony MZ-RH10' },\n    { vendorId: 0x054c, deviceId: 0x021b, name: 'Sony MZ-RH710/MZ-RH910' },\n    { vendorId: 0x054c, deviceId: 0x021d, name: 'Sony CMT-AH10' },\n    { vendorId: 0x054c, deviceId: 0x022c, name: 'Sony CMT-AH10' },\n    { vendorId: 0x054c, deviceId: 0x023c, name: 'Sony DS-HMD1' },\n    { vendorId: 0x054c, deviceId: 0x0286, name: 'Sony MZ-RH1' },\n];\nvar NetMD = /** @class */ (function () {\n    function NetMD(device, iface, logger) {\n        if (iface === void 0) { iface = 0; }\n        var _a;\n        this.device = device;\n        this.iface = iface;\n        this.logger = logger;\n        this.logger = (_a = logger) === null || _a === void 0 ? void 0 : _a.child({ class: 'NetMD' });\n    }\n    NetMD.prototype.init = function () {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var len;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug('Init');\n                        if (!!this.device.opened) return [3 /*break*/, 2];\n                        (_b = this.logger) === null || _b === void 0 ? void 0 : _b.debug('Opening device');\n                        return [4 /*yield*/, this.device.open()];\n                    case 1:\n                        _c.sent();\n                        _c.label = 2;\n                    case 2: return [4 /*yield*/, this.device.selectConfiguration(1)];\n                    case 3:\n                        _c.sent();\n                        return [4 /*yield*/, this.device.claimInterface(this.iface)];\n                    case 4:\n                        _c.sent();\n                        return [4 /*yield*/, this.getReplyLength()];\n                    case 5:\n                        len = _c.sent();\n                        if (!(len > 0)) return [3 /*break*/, 7];\n                        return [4 /*yield*/, this.readReply()];\n                    case 6:\n                        _c.sent();\n                        _c.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMD.prototype.getDeviceName = function () {\n        var _a, _b;\n        var _c = this.device, vendorId = _c.vendorId, productId = _c.productId;\n        var deviceId = exports.DevicesIds.find(function (device) { return device.deviceId === productId && device.vendorId === vendorId; });\n        return _b = (_a = deviceId) === null || _a === void 0 ? void 0 : _a.name, (_b !== null && _b !== void 0 ? _b : 'Unknown Device');\n    };\n    NetMD.prototype.finalize = function () {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var err_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug('Finalize');\n                        _c.label = 1;\n                    case 1:\n                        _c.trys.push([1, 5, , 6]);\n                        return [4 /*yield*/, this.device.reset()];\n                    case 2:\n                        _c.sent();\n                        return [4 /*yield*/, this.device.releaseInterface(this.iface)];\n                    case 3:\n                        _c.sent();\n                        return [4 /*yield*/, this.device.close()];\n                    case 4:\n                        _c.sent();\n                        return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _c.sent();\n                        (_b = this.logger) === null || _b === void 0 ? void 0 : _b.error({ err: err_1 });\n                        return [3 /*break*/, 6];\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMD.prototype.getReplyLength = function () {\n        var _a, _b, _c;\n        return __awaiter(this, void 0, void 0, function () {\n            var result, len;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4 /*yield*/, this.device.controlTransferIn({\n                            requestType: 'vendor',\n                            recipient: 'interface',\n                            request: 0x01,\n                            value: 0,\n                            index: 0,\n                        }, 4)];\n                    case 1:\n                        result = _d.sent();\n                        len = (_b = (_a = result.data) === null || _a === void 0 ? void 0 : _a.getUint8(2), (_b !== null && _b !== void 0 ? _b : 0));\n                        (_c = this.logger) === null || _c === void 0 ? void 0 : _c.debug({ action: 'getReplyLength', result: util_1.inspect(result), len: len });\n                        return [2 /*return*/, len];\n                }\n            });\n        });\n    };\n    NetMD.prototype.sendCommand = function (command) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug({ action: 'sendCommand', command: util_1.inspect(command) });\n                        return [4 /*yield*/, this.device.controlTransferOut({\n                                requestType: 'vendor',\n                                recipient: 'interface',\n                                request: 0x80,\n                                value: 0,\n                                index: 0,\n                            }, command)];\n                    case 1:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMD.prototype.readReply = function () {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var len, i, result;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.getReplyLength()];\n                    case 1:\n                        len = _b.sent();\n                        i = 0;\n                        _b.label = 2;\n                    case 2:\n                        if (!(len === 0)) return [3 /*break*/, 5];\n                        return [4 /*yield*/, utils_1.sleep(NetMD.readReplyRetryIntervalInMsec * Math.pow(2, ~~(i / 10)))];\n                    case 3:\n                        _b.sent(); // Double wait time every 10 attempts\n                        return [4 /*yield*/, this.getReplyLength()];\n                    case 4:\n                        len = _b.sent();\n                        i++;\n                        return [3 /*break*/, 2];\n                    case 5: return [4 /*yield*/, this.device.controlTransferIn({\n                            requestType: 'vendor',\n                            recipient: 'interface',\n                            request: 0x81,\n                            value: 0,\n                            index: 0,\n                        }, len)];\n                    case 6:\n                        result = _b.sent();\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug({ action: 'readReply', result: util_1.inspect(result) });\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    NetMD.prototype.readBulk = function (length) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.readBulkToArray(length)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, new Uint8Array(result)];\n                }\n            });\n        });\n    };\n    NetMD.prototype.readBulkToArray = function (length, chunksize) {\n        if (chunksize === void 0) { chunksize = 0x10000; }\n        return __awaiter(this, void 0, void 0, function () {\n            var done, buffer, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        done = 0;\n                        buffer = new ArrayBuffer(0);\n                        _a.label = 1;\n                    case 1:\n                        if (!(done < length)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, this.device.transferIn(this.iface, Math.min(length - done, length))];\n                    case 2:\n                        res = _a.sent();\n                        if (!res.data) {\n                            throw new Error('expected data');\n                        }\n                        done += res.data.byteLength; // TODO: handle this case\n                        buffer = utils_1.concatArrayBuffers(buffer, res.data.buffer);\n                        return [3 /*break*/, 1];\n                    case 3: return [2 /*return*/, buffer];\n                }\n            });\n        });\n    };\n    NetMD.prototype.writeBulk = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.device.transferOut(BULK_WRITE_ENDPOINT, data)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    NetMD.readReplyRetryIntervalInMsec = 10;\n    return NetMD;\n}());\nexports.NetMD = NetMD;\n//# sourceMappingURL=netmd.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __asyncValues = (this && this.__asyncValues) || function (o) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var m = o[Symbol.asyncIterator], i;\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\n};\nvar __await = (this && this.__await) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); }\nvar __asyncGenerator = (this && this.__asyncGenerator) || function (thisArg, _arguments, generator) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n    function fulfill(value) { resume(\"next\", value); }\n    function reject(value) { resume(\"throw\", value); }\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar _a, _b;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar query_utils_1 = require(\"./query-utils\");\nvar utils_1 = require(\"./utils\");\nvar jsbi_1 = __importDefault(require(\"jsbi\"));\nvar crypto_js_1 = __importDefault(require(\"crypto-js\"));\nvar Status;\n(function (Status) {\n    // NetMD Protocol return status (first byte of request)\n    Status[Status[\"control\"] = 0] = \"control\";\n    Status[Status[\"status\"] = 1] = \"status\";\n    Status[Status[\"specificInquiry\"] = 2] = \"specificInquiry\";\n    Status[Status[\"notify\"] = 3] = \"notify\";\n    Status[Status[\"generalInquiry\"] = 4] = \"generalInquiry\";\n    //  ... (first byte of response)\n    Status[Status[\"notImplemented\"] = 8] = \"notImplemented\";\n    Status[Status[\"accepted\"] = 9] = \"accepted\";\n    Status[Status[\"rejected\"] = 10] = \"rejected\";\n    Status[Status[\"inTransition\"] = 11] = \"inTransition\";\n    Status[Status[\"implemented\"] = 12] = \"implemented\";\n    Status[Status[\"changed\"] = 13] = \"changed\";\n    Status[Status[\"interim\"] = 15] = \"interim\";\n})(Status || (Status = {}));\nvar Action;\n(function (Action) {\n    Action[Action[\"play\"] = 117] = \"play\";\n    Action[Action[\"pause\"] = 125] = \"pause\";\n    Action[Action[\"fastForward\"] = 57] = \"fastForward\";\n    Action[Action[\"rewind\"] = 73] = \"rewind\";\n})(Action || (Action = {}));\nvar Track;\n(function (Track) {\n    Track[Track[\"previous\"] = 2] = \"previous\";\n    Track[Track[\"next\"] = 32769] = \"next\";\n    Track[Track[\"restart\"] = 1] = \"restart\";\n})(Track || (Track = {}));\nvar DiscFormat;\n(function (DiscFormat) {\n    DiscFormat[DiscFormat[\"lp4\"] = 0] = \"lp4\";\n    DiscFormat[DiscFormat[\"lp2\"] = 2] = \"lp2\";\n    DiscFormat[DiscFormat[\"spMono\"] = 4] = \"spMono\";\n    DiscFormat[DiscFormat[\"spStereo\"] = 6] = \"spStereo\";\n})(DiscFormat = exports.DiscFormat || (exports.DiscFormat = {}));\nvar Wireformat;\n(function (Wireformat) {\n    Wireformat[Wireformat[\"pcm\"] = 0] = \"pcm\";\n    Wireformat[Wireformat[\"l105kbps\"] = 144] = \"l105kbps\";\n    Wireformat[Wireformat[\"lp2\"] = 148] = \"lp2\";\n    Wireformat[Wireformat[\"lp4\"] = 168] = \"lp4\";\n})(Wireformat = exports.Wireformat || (exports.Wireformat = {}));\nvar Encoding;\n(function (Encoding) {\n    Encoding[Encoding[\"sp\"] = 144] = \"sp\";\n    Encoding[Encoding[\"lp2\"] = 146] = \"lp2\";\n    Encoding[Encoding[\"lp4\"] = 147] = \"lp4\";\n})(Encoding = exports.Encoding || (exports.Encoding = {}));\nvar Channels;\n(function (Channels) {\n    Channels[Channels[\"mono\"] = 1] = \"mono\";\n    Channels[Channels[\"stereo\"] = 0] = \"stereo\";\n})(Channels = exports.Channels || (exports.Channels = {}));\nvar ChannelCount;\n(function (ChannelCount) {\n    ChannelCount[ChannelCount[\"mono\"] = 1] = \"mono\";\n    ChannelCount[ChannelCount[\"stereo\"] = 2] = \"stereo\";\n})(ChannelCount = exports.ChannelCount || (exports.ChannelCount = {}));\nvar TrackFlag;\n(function (TrackFlag) {\n    TrackFlag[TrackFlag[\"protected\"] = 3] = \"protected\";\n    TrackFlag[TrackFlag[\"unprotected\"] = 0] = \"unprotected\";\n})(TrackFlag = exports.TrackFlag || (exports.TrackFlag = {}));\nvar DiscFlag;\n(function (DiscFlag) {\n    DiscFlag[DiscFlag[\"writable\"] = 16] = \"writable\";\n    DiscFlag[DiscFlag[\"writeProtected\"] = 64] = \"writeProtected\";\n})(DiscFlag = exports.DiscFlag || (exports.DiscFlag = {}));\nexports.FrameSize = (_a = {},\n    _a[Wireformat.pcm] = 2048,\n    _a[Wireformat.lp2] = 192,\n    _a[Wireformat.l105kbps] = 152,\n    _a[Wireformat.lp4] = 96,\n    _a);\n// https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// I could have used the make-error library\nvar NetMDError = /** @class */ (function (_super) {\n    __extends(NetMDError, _super);\n    function NetMDError(m) {\n        var _this = _super.call(this, m) || this;\n        Object.setPrototypeOf(_this, NetMDError.prototype);\n        return _this;\n    }\n    return NetMDError;\n}(Error));\nvar NetMDNotImplemented = /** @class */ (function (_super) {\n    __extends(NetMDNotImplemented, _super);\n    function NetMDNotImplemented(m) {\n        var _this = _super.call(this, m) || this;\n        Object.setPrototypeOf(_this, NetMDNotImplemented.prototype);\n        return _this;\n    }\n    return NetMDNotImplemented;\n}(NetMDError));\nvar NetMDRejected = /** @class */ (function (_super) {\n    __extends(NetMDRejected, _super);\n    function NetMDRejected(m) {\n        var _this = _super.call(this, m) || this;\n        Object.setPrototypeOf(_this, NetMDRejected.prototype);\n        return _this;\n    }\n    return NetMDRejected;\n}(NetMDError));\nvar NetMDInterface = /** @class */ (function () {\n    function NetMDInterface(netMd, logger) {\n        var _a;\n        this.netMd = netMd;\n        this.logger = logger;\n        this.logger = (_a = logger) === null || _a === void 0 ? void 0 : _a.child({ class: 'NetMDInterface' });\n    }\n    NetMDInterface.prototype.sendQuery = function (query, test) {\n        if (test === void 0) { test = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendCommand(query, test)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, this.readReply()];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.sendCommand = function (query, test) {\n        if (test === void 0) { test = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var statusByte;\n            return __generator(this, function (_a) {\n                if (test) {\n                    statusByte = new Uint8Array([Status.specificInquiry]).buffer;\n                }\n                else {\n                    statusByte = new Uint8Array([Status.control]).buffer;\n                }\n                this.netMd.sendCommand(utils_1.concatArrayBuffers(statusByte, query));\n                return [2 /*return*/];\n            });\n        });\n    };\n    NetMDInterface.prototype.sendHandshake = function (handshake) {\n        return __awaiter(this, void 0, void 0, function () {\n            var hs;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hs = query_utils_1.formatQuery(handshake);\n                        return [4 /*yield*/, this.sendQuery(hs)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.readReply = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var currentAttempt, data, status;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        currentAttempt = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(currentAttempt < NetMDInterface.maxInterimReadAttempts)) return [3 /*break*/, 9];\n                        return [4 /*yield*/, this.netMd.readReply()];\n                    case 2:\n                        (data = (_a.sent()).data);\n                        if (data === undefined) {\n                            throw new Error('unexpected undefined value in readReply');\n                        }\n                        status = data.getUint8(0);\n                        if (!(status === Status.notImplemented)) return [3 /*break*/, 3];\n                        throw new NetMDNotImplemented('Not implemented');\n                    case 3:\n                        if (!(status === Status.rejected)) return [3 /*break*/, 4];\n                        throw new NetMDRejected('Rejected');\n                    case 4:\n                        if (!([Status.accepted, Status.implemented].indexOf(status) < -1)) return [3 /*break*/, 5];\n                        throw new NetMDNotImplemented(\"Unknown return status: \" + status);\n                    case 5:\n                        if (!(status === Status.interim)) return [3 /*break*/, 7];\n                        return [4 /*yield*/, utils_1.sleep(NetMDInterface.interimResponseRetryIntervalInMs * (Math.pow(2, currentAttempt) - 1))];\n                    case 6:\n                        _a.sent();\n                        currentAttempt += 1;\n                        return [3 /*break*/, 1]; // Retry\n                    case 7: return [3 /*break*/, 9]; // Success!\n                    case 8: return [3 /*break*/, 1];\n                    case 9:\n                        if (currentAttempt >= NetMDInterface.maxInterimReadAttempts) {\n                            throw new NetMDRejected('Max attempts read attempts for interim status reached');\n                        }\n                        return [2 /*return*/, data.buffer.slice(1)];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.acquire = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('ff 010c ffff ffff ffff ffff ffff ffff');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, 'ff 010c ffff ffff ffff ffff ffff ffff');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.release = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('ff 0100 ffff ffff ffff ffff ffff ffff');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, 'ff 0100 ffff ffff ffff ffff ffff ffff');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getStatus = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('1808 8000 0100')];\n                    case 1:\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1809 8001 0230 8800 0030 8804 00 ff00 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1809 8001 0230 8800 0030 8804 00 1000 00090000 %x');\n                        return [2 /*return*/, res[0]];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.isDiscPresent = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var status;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getStatus()];\n                    case 1:\n                        status = _a.sent();\n                        return [2 /*return*/, status[4] === 0x40];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getOperatingStatus = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: \n                    // WARNING: Does not work for all devices. See https://github.com/cybercase/webminidisc/issues/21\n                    return [4 /*yield*/, this.sendHandshake('1808 8000 0100')];\n                    case 1:\n                        // WARNING: Does not work for all devices. See https://github.com/cybercase/webminidisc/issues/21\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1809 8001 0330 8802 0030 8805 0030 8806 00 ff00 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1809 8001 0330 8802 0030 8805 0030 8806 00 1000 00%?0000 0006 8806 0002 %w')[0];\n                        return [2 /*return*/, jsbi_1.default.toNumber(res)];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype._getPlaybackStatus = function (p1, p2) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1809 8001 0330 %w 0030 8805 0030 %w 00 ff00 00000000', p1, p2);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1809 8001 0330 %?%? %?%? %?%? %?%? %?%? %? 1000 00%?0000 %x');\n                        return [2 /*return*/, res[0]];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getPlaybackStatus1 = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this._getPlaybackStatus(0x8801, 0x8807)];\n            });\n        });\n    };\n    NetMDInterface.prototype.getPlaybackStatus2 = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this._getPlaybackStatus(0x8802, 0x8806)];\n            });\n        });\n    };\n    NetMDInterface.prototype.getPosition = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, err_1, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1809 8001 0430 8802 0030 8805 0030 0003 0030 0002 00 ff00 00000000');\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_1 = _a.sent();\n                        if (err_1 instanceof NetMDRejected) {\n                            return [2 /*return*/, null];\n                        }\n                        else {\n                            throw err_1;\n                        }\n                        return [3 /*break*/, 4];\n                    case 4:\n                        result = query_utils_1.scanQuery(reply, \"1809 8001 0430 %?%? %?%? %?%? \" + \"%?%? %?%? %?%? %?%? %? %?00 00%?0000 \" + \"000b 0002 0007 00 %w %b %b %b %b\");\n                        result[0] = jsbi_1.default.toNumber(result[0]);\n                        result[1] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[1]));\n                        result[2] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[2]));\n                        result[3] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[3]));\n                        result[4] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[4]));\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype._play = function (action) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('18c3 ff %b 000000', action);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '18c3 00 %b 000000');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.play = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._play(Action.play)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.fast_forward = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._play(Action.fastForward)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.rewind = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._play(Action.rewind)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.pause = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._play(Action.pause)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.stop = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('18c5 ff 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '18c5 00 00000000');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.gotoTrack = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1850 ff010000 0000 %w', track);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1850 00010000 0000 %w')[0];\n                        return [2 /*return*/, jsbi_1.default.toNumber(res)];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.gotoTime = function (track, hour, minute, second, frame) {\n        if (hour === void 0) { hour = 0; }\n        if (minute === void 0) { minute = 0; }\n        if (second === void 0) { second = 0; }\n        if (frame === void 0) { frame = 0; }\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1850 ff000000 0000 %w %b%b%b%b', track, query_utils_1.int2BCD(hour), query_utils_1.int2BCD(minute), query_utils_1.int2BCD(second), query_utils_1.int2BCD(frame));\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1850 00000000 %?%? %w %b%b%b%b');\n                        return [2 /*return*/, res.map(function (j) { return jsbi_1.default.toNumber(j); })];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype._trackChange = function (direction) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1850 ff10 00000000 %w', direction);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1850 0010 00000000 %?%?')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.nextTrack = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._trackChange(Track.next)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.previousTrack = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._trackChange(Track.previous)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.restartTrack = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._trackChange(Track.restart)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.eraseDisc = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1840 ff 0000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '1840 00 0000');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.syncTOC = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('180810 1801 0000')];\n                    case 1:\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1808 10180200 00');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '1808 10180200 00');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.cacheTOC = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1808 10180203 00');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '1808 10180203 00');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getDiscFlags = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1806 01101000 ff00 0001000b');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1806 01101000 1000 0001000b %b');\n                        return [2 /*return*/, jsbi_1.default.toNumber(res[0])];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackCount = function () {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res1, data, res2;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('180810 1001 0100')];\n                    case 1:\n                        _b.sent();\n                        query = query_utils_1.formatQuery('1806 02101001 3000 1000 ff00 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _b.sent();\n                        res1 = query_utils_1.scanQuery(reply, '1806 02101001 %?%? %?%? 1000 00%?0000 %x');\n                        data = String.fromCharCode.apply(String, __spread(res1[0]));\n                        utils_1.assert(data.length === 6, \"Expected length === 6 for data\");\n                        utils_1.assert(data.substring(0, 5) === \"\\0\\u0010\\0\\u0002\\0\", \"Wrong header in data response\");\n                        res2 = data.charCodeAt(5);\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug({ method: \"getTrackCount\", result: res2 });\n                        return [2 /*return*/, res2];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype._getDiscTitle = function (wchar) {\n        if (wchar === void 0) { wchar = false; }\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var wcharValue, done, remaining, total, result, chunkSize, chunk, query, reply, res_1, res_2, res;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (wchar) {\n                            wcharValue = 1;\n                        }\n                        else {\n                            wcharValue = 0;\n                        }\n                        done = 0;\n                        remaining = 0;\n                        total = 1;\n                        result = [];\n                        _b.label = 1;\n                    case 1:\n                        if (!(done < total)) return [3 /*break*/, 3];\n                        query = query_utils_1.formatQuery('1806 02201801 00%b 3000 0a00 ff00 %w%w', wcharValue, remaining, done);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _b.sent();\n                        if (remaining === 0) {\n                            res_1 = query_utils_1.scanQuery(reply, '1806 02201801 00%? 3000 0a00 1000 %w0000 %?%?000a %w %*');\n                            chunkSize = jsbi_1.default.toNumber(res_1[0]);\n                            total = jsbi_1.default.toNumber(res_1[1]);\n                            chunk = utils_1.decodeFromSJIS(res_1[2]);\n                            chunkSize -= 6;\n                        }\n                        else {\n                            res_2 = query_utils_1.scanQuery(reply, '1806 02201801 00%? 3000 0a00 1000 %w%?%? %*');\n                            chunkSize = jsbi_1.default.toNumber(res_2[0]);\n                            chunk = utils_1.decodeFromSJIS(res_2[1]);\n                        }\n                        result.push(chunk);\n                        done += chunkSize;\n                        remaining = total - done;\n                        return [3 /*break*/, 1];\n                    case 3:\n                        res = result.join('');\n                        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug({ method: \"_getDiscTitle\", result: res });\n                        return [2 /*return*/, res];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getDiscTitle = function (wchar) {\n        if (wchar === void 0) { wchar = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var title, firstEntry;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._getDiscTitle(wchar)];\n                    case 1:\n                        title = _a.sent();\n                        if (title.endsWith('//')) {\n                            firstEntry = title.split('//')[0];\n                            if (firstEntry.startsWith('0;')) {\n                                title = firstEntry.substring(2);\n                            }\n                            else {\n                                title = '';\n                            }\n                        }\n                        return [2 /*return*/, title];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackGroupList = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var rawTitle, groupList, trackDict, trackCount, result, _a, _b, _c, groupIndex, group, _d, trackRange, groupName, trackMinStr, trackMaxStr, _e, trackMin, trackMax, trackList_1, track, trackList;\n            var e_1, _f, _g;\n            return __generator(this, function (_h) {\n                switch (_h.label) {\n                    case 0: return [4 /*yield*/, this._getDiscTitle()];\n                    case 1:\n                        rawTitle = _h.sent();\n                        groupList = rawTitle.split('//');\n                        trackDict = {};\n                        return [4 /*yield*/, this.getTrackCount()];\n                    case 2:\n                        trackCount = _h.sent();\n                        result = [];\n                        try {\n                            for (_a = __values(groupList.entries()), _b = _a.next(); !_b.done; _b = _a.next()) {\n                                _c = __read(_b.value, 2), groupIndex = _c[0], group = _c[1];\n                                if (group === '') {\n                                    continue;\n                                }\n                                if (group.startsWith('0;') || group.indexOf(';') === -1 || rawTitle.indexOf('//') === -1) {\n                                    continue;\n                                }\n                                _d = __read(group.split(';', 1), 1), trackRange = _d[0];\n                                groupName = group.substring(trackRange.length + 1);\n                                trackMinStr = void 0, trackMaxStr = void 0;\n                                if (trackRange.indexOf('-') >= 0) {\n                                    _g = __read(trackRange.split('-'), 2), trackMinStr = _g[0], trackMaxStr = _g[1];\n                                }\n                                else {\n                                    trackMinStr = trackMaxStr = trackRange;\n                                }\n                                _e = __read([Number.parseInt(trackMinStr, 10), Number.parseInt(trackMaxStr, 10)], 2), trackMin = _e[0], trackMax = _e[1];\n                                trackMax = Math.min(trackMax, trackCount); // Groups might not updated when a song is deleted\n                                utils_1.assert(0 <= trackMin);\n                                utils_1.assert(trackMin <= trackMax);\n                                trackList_1 = [];\n                                for (track = trackMin - 1; track < trackMax; track++) {\n                                    if (track in trackDict) {\n                                        throw new Error(\"Track \" + track + \" is in 2 groups: \" + trackDict[track][0]);\n                                    }\n                                    trackDict[track] = [groupName, groupIndex];\n                                    trackList_1.push(track);\n                                }\n                                result.push([groupName, trackList_1]);\n                            }\n                        }\n                        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                        finally {\n                            try {\n                                if (_b && !_b.done && (_f = _a.return)) _f.call(_a);\n                            }\n                            finally { if (e_1) throw e_1.error; }\n                        }\n                        trackList = __spread(Array(trackCount).keys()).filter(function (x) { return !(x in trackDict); });\n                        if (trackList.length > 0) {\n                            result.unshift([null, trackList]);\n                        }\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackTitle = function (track, wchar) {\n        if (wchar === void 0) { wchar = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var wcharValue, query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (wchar) {\n                            wcharValue = 3;\n                        }\n                        else {\n                            wcharValue = 2;\n                        }\n                        query = query_utils_1.formatQuery('1806 022018%b %w 3000 0a00 ff00 00000000', wcharValue, track);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1806 022018%? %?%? %?%? %?%? 1000 00%?0000 00%?000a %x');\n                        return [2 /*return*/, utils_1.decodeFromSJIS(res[0])];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.setDiscTitle = function (title, wchar) {\n        if (wchar === void 0) { wchar = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var wcharValue, oldLen, _a, newLength, query, reply;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = utils_1.getLengthAfterEncodingToSJIS;\n                        return [4 /*yield*/, this.getDiscTitle()];\n                    case 1:\n                        oldLen = _a.apply(void 0, [_b.sent()]);\n                        newLength = utils_1.getLengthAfterEncodingToSJIS(title);\n                        if (wchar) {\n                            wcharValue = 1;\n                        }\n                        else {\n                            wcharValue = 0;\n                        }\n                        return [4 /*yield*/, this.sendHandshake('180810 1801 0100')];\n                    case 2:\n                        _b.sent();\n                        return [4 /*yield*/, this.sendHandshake('180810 1801 0000')];\n                    case 3:\n                        _b.sent();\n                        return [4 /*yield*/, this.sendHandshake('180810 1801 0300')];\n                    case 4:\n                        _b.sent();\n                        query = query_utils_1.formatQuery('1807 02201801 00%b 3000 0a00 5000 %w 0000 %w %*', wcharValue, newLength, oldLen, utils_1.encodeToSJIS(title));\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 5:\n                        reply = _b.sent();\n                        query_utils_1.scanQuery(reply, '1807 02201801 00%? 3000 0a00 5000 %?%? 0000 %?%?');\n                        return [4 /*yield*/, this.sendHandshake('180810 1801 0100')];\n                    case 6:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.setTrackTitle = function (track, title, wchar) {\n        if (wchar === void 0) { wchar = false; }\n        return __awaiter(this, void 0, void 0, function () {\n            var wcharValue, oldLen, newLen, _a, err_2, query, reply;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (wchar) {\n                            wcharValue = 3;\n                        }\n                        else {\n                            wcharValue = 2;\n                        }\n                        newLen = utils_1.getLengthAfterEncodingToSJIS(title);\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        _a = utils_1.getLengthAfterEncodingToSJIS;\n                        return [4 /*yield*/, this.getTrackTitle(track)];\n                    case 2:\n                        oldLen = _a.apply(void 0, [_b.sent()]);\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _b.sent();\n                        if (err_2 instanceof NetMDRejected) {\n                            oldLen = 0;\n                        }\n                        else {\n                            throw err_2;\n                        }\n                        return [3 /*break*/, 4];\n                    case 4: return [4 /*yield*/, this.sendHandshake('180810 1802 0100')];\n                    case 5:\n                        _b.sent();\n                        return [4 /*yield*/, this.sendHandshake('180810 1802 0000')];\n                    case 6:\n                        _b.sent();\n                        return [4 /*yield*/, this.sendHandshake('180810 1802 0300')];\n                    case 7:\n                        _b.sent();\n                        query = query_utils_1.formatQuery('1807 022018%b %w 3000 0a00 5000 %w 0000 %w %*', wcharValue, track, newLen, oldLen, utils_1.encodeToSJIS(title));\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 8:\n                        reply = _b.sent();\n                        query_utils_1.scanQuery(reply, '1807 022018%? %?%? 3000 0a00 5000 %?%? 0000 %?%?');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.eraseTrack = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1840 ff01 00 201001 %w', track);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.moveTrack = function (source, dest) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('180810 1001 0000')];\n                    case 1:\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1843 ff00 00 201001 %w 201001 %w', source, dest);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype._getTrackInfo = function (track, p1, p2) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('180810 1001 0100')];\n                    case 1:\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1806 02201001 %w %w %w ff00 00000000', track, p1, p2);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1806 02201001 %?%? %?%? %?%? 1000 00%?0000 %x');\n                        return [2 /*return*/, String.fromCharCode.apply(String, __spread(res[0]))];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackLength = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var rawValue, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._getTrackInfo(track, 0x3000, 0x0100)];\n                    case 1:\n                        rawValue = _a.sent();\n                        result = query_utils_1.scanQuery(utils_1.stringToCharCodeArray(rawValue), '0001 0006 0000 %b %b %b %b');\n                        result[0] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[0]));\n                        result[1] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[1]));\n                        result[2] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[2]));\n                        result[3] = query_utils_1.BCD2int(jsbi_1.default.toNumber(result[3]));\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackEncoding = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var rawValue, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this._getTrackInfo(track, 0x3080, 0x0700)];\n                    case 1:\n                        rawValue = _a.sent();\n                        result = query_utils_1.scanQuery(utils_1.stringToCharCodeArray(rawValue), '8007 0004 0110 %b %b');\n                        return [2 /*return*/, result.map(function (i) { return jsbi_1.default.toNumber(i); })];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackFlags = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1806 01201001 %w ff00 00010008', track);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1806 01201001 %?%? 10 00 00010008 %b')[0];\n                        return [2 /*return*/, jsbi_1.default.toNumber(res)];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getDiscCapacity = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, result, res, i, offset, tmp;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.sendHandshake('180810 1000 0100')];\n                    case 1:\n                        _a.sent();\n                        query = query_utils_1.formatQuery('1806 02101000 3080 0300 ff00 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 2:\n                        reply = _a.sent();\n                        result = [];\n                        res = query_utils_1.scanQuery(reply, '1806 02101000 3080 0300 1000 001d0000 001b 8003 0017 8000 0005 %w %b %b %b 0005 %w %b %b %b 0005 %w %b %b %b');\n                        for (i = 0; i < 3; i++) {\n                            offset = i * 4;\n                            tmp = [\n                                query_utils_1.BCD2int(jsbi_1.default.toNumber(res[offset + 0])),\n                                query_utils_1.BCD2int(jsbi_1.default.toNumber(res[offset + 1])),\n                                query_utils_1.BCD2int(jsbi_1.default.toNumber(res[offset + 2])),\n                                query_utils_1.BCD2int(jsbi_1.default.toNumber(res[offset + 3])),\n                            ];\n                            result.push(tmp);\n                        }\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getRecordingParameters = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1809 8001 0330 8801 0030 8805 0030 8807 00 ff00 00000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1809 8001 0330 8801 0030 8805 0030 8807 00 1000 000e0000 000c 8805 0008 80e0 0110 %b %b 4000');\n                        return [2 /*return*/, res.map(function (i) { return jsbi_1.default.toNumber(i); })];\n                }\n            });\n        });\n    };\n    // TODO: saveTrackToStream\n    NetMDInterface.prototype.disableNewTrackProtection = function (val) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 2b ff %w', val);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        query_utils_1.scanQuery(reply, '1800 080046 f0030103 2b 00 %?%?');\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.enterSecureSession = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 80 ff');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 80 00')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.leaveSecureSession = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 81 ff');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 81 00')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getLeafID = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 11 ff');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1800 080046 f0030103 11 00 %*');\n                        return [2 /*return*/, String.fromCharCode.apply(String, __spread(res[0]))];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.sendKeyData = function (ekbid, keychain, depth, ekbsignature) {\n        return __awaiter(this, void 0, void 0, function () {\n            var chainlen, databytes, keychain_1, keychain_1_1, key, keychains, query, reply;\n            var e_2, _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        chainlen = keychain.length;\n                        databytes = 16 + 16 * chainlen + 24;\n                        try {\n                            for (keychain_1 = __values(keychain), keychain_1_1 = keychain_1.next(); !keychain_1_1.done; keychain_1_1 = keychain_1.next()) {\n                                key = keychain_1_1.value;\n                                if (key.length !== 16) {\n                                    throw new Error(\"Each key in the chain needs to have 16 bytes; this one has \" + key.length);\n                                }\n                            }\n                        }\n                        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                        finally {\n                            try {\n                                if (keychain_1_1 && !keychain_1_1.done && (_a = keychain_1.return)) _a.call(keychain_1);\n                            }\n                            finally { if (e_2) throw e_2.error; }\n                        }\n                        if (depth < 1 || depth > 63) {\n                            throw new Error('Supplied depth is invalid');\n                        }\n                        if (ekbsignature.length !== 24) {\n                            throw new Error('Supplied EKB signature length wrong');\n                        }\n                        keychains = utils_1.concatUint8Arrays.apply(void 0, __spread(keychain));\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 12 ff %w %d %d %d %d 00000000 %* %*', databytes, databytes, chainlen, depth, ekbid, keychains, ekbsignature);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _b.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 12 01 %?%? %?%?%?%?')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.sessionKeyExchange = function (hostnonce) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (hostnonce.length !== 8) {\n                            throw new Error('Supplied host nonce length wrong');\n                        }\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 20 ff 000000 %*', hostnonce);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 20 00 000000 %#')[0]];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.sessionKeyForget = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 21 ff 000000');\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 21 00 000000')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.setupDownload = function (contentid, keyenckey, hexSessionKey) {\n        return __awaiter(this, void 0, void 0, function () {\n            var message, encryptedarg, query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (contentid.length !== 20) {\n                            throw new Error('Supplied Content ID length wrong');\n                        }\n                        if (keyenckey.length !== 8) {\n                            throw new Error('Supplied Key Encryption Key length wrong');\n                        }\n                        if (hexSessionKey.length !== 16) {\n                            throw new Error('Supplied Session Key length wrong');\n                        }\n                        message = utils_1.concatUint8Arrays(new Uint8Array([1, 1, 1, 1]), contentid, keyenckey);\n                        encryptedarg = crypto_js_1.default.DES.encrypt(crypto_js_1.default.lib.WordArray.create(message), crypto_js_1.default.enc.Hex.parse(hexSessionKey), {\n                            mode: crypto_js_1.default.mode.CBC,\n                            padding: crypto_js_1.default.pad.NoPadding,\n                            iv: crypto_js_1.default.enc.Hex.parse('0000000000000000'),\n                        });\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 22 ff 0000 %*', utils_1.wordArrayToByteArray(encryptedarg.ciphertext));\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 22 00 0000')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.commitTrack = function (tracknum, hexSessionKey) {\n        return __awaiter(this, void 0, void 0, function () {\n            var authentication, query, reply;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (hexSessionKey.length !== 16) {\n                            throw new Error('Supplied Session Key length wrong');\n                        }\n                        authentication = crypto_js_1.default.DES.encrypt(crypto_js_1.default.enc.Hex.parse('0000000000000000'), crypto_js_1.default.enc.Hex.parse(hexSessionKey), {\n                            mode: crypto_js_1.default.mode.ECB,\n                            padding: crypto_js_1.default.pad.NoPadding,\n                        });\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 48 ff 00 1001 %w %*', tracknum, utils_1.wordArrayToByteArray(authentication.ciphertext));\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        return [2 /*return*/, query_utils_1.scanQuery(reply, '1800 080046 f0030103 48 00 00 1001 %?%?')];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.sendTrack = function (wireformat, discformat, frames, pktSize, packets, hexSessionKey, progressCallback) {\n        var packets_1, packets_1_1;\n        var e_3, _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var totalBytes, query, reply, swapNeeded, packetCount, writtenBytes, _b, key, iv, data, binpack, packedLength, e_3_1, res, replydata;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (hexSessionKey.length !== 16) {\n                            throw new Error('Supplied Session Key length wrong');\n                        }\n                        totalBytes = pktSize + 24;\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 28 ff 000100 1001 ffff 00 %b %b %d %d', wireformat, discformat, frames, totalBytes);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _c.sent();\n                        query_utils_1.scanQuery(reply, '1800 080046 f0030103 28 00 000100 1001 %?%? 00 %*');\n                        swapNeeded = !utils_1.isBigEndian();\n                        packetCount = 0;\n                        writtenBytes = 0;\n                        _c.label = 2;\n                    case 2:\n                        _c.trys.push([2, 8, 9, 14]);\n                        packets_1 = __asyncValues(packets);\n                        _c.label = 3;\n                    case 3: return [4 /*yield*/, packets_1.next()];\n                    case 4:\n                        if (!(packets_1_1 = _c.sent(), !packets_1_1.done)) return [3 /*break*/, 7];\n                        _b = packets_1_1.value, key = _b.key, iv = _b.iv, data = _b.data;\n                        progressCallback && progressCallback({ totalBytes: totalBytes, writtenBytes: writtenBytes });\n                        binpack = void 0;\n                        if (packetCount === 0) {\n                            packedLength = new Uint8Array(new Uint32Array([pktSize]).buffer);\n                            if (swapNeeded) {\n                                packedLength.reverse();\n                            }\n                            binpack = utils_1.concatUint8Arrays(new Uint8Array([0, 0, 0, 0]), packedLength, key, iv, data);\n                        }\n                        else {\n                            binpack = data;\n                        }\n                        return [4 /*yield*/, this.netMd.writeBulk(binpack)];\n                    case 5:\n                        _c.sent();\n                        packetCount += 1;\n                        writtenBytes += data.length;\n                        _c.label = 6;\n                    case 6: return [3 /*break*/, 3];\n                    case 7: return [3 /*break*/, 14];\n                    case 8:\n                        e_3_1 = _c.sent();\n                        e_3 = { error: e_3_1 };\n                        return [3 /*break*/, 14];\n                    case 9:\n                        _c.trys.push([9, , 12, 13]);\n                        if (!(packets_1_1 && !packets_1_1.done && (_a = packets_1.return))) return [3 /*break*/, 11];\n                        return [4 /*yield*/, _a.call(packets_1)];\n                    case 10:\n                        _c.sent();\n                        _c.label = 11;\n                    case 11: return [3 /*break*/, 13];\n                    case 12:\n                        if (e_3) throw e_3.error;\n                        return [7 /*endfinally*/];\n                    case 13: return [7 /*endfinally*/];\n                    case 14:\n                        progressCallback && progressCallback({ totalBytes: totalBytes, writtenBytes: writtenBytes });\n                        return [4 /*yield*/, this.readReply()];\n                    case 15:\n                        reply = _c.sent();\n                        return [4 /*yield*/, this.netMd.getReplyLength()];\n                    case 16:\n                        _c.sent();\n                        res = query_utils_1.scanQuery(reply, '1800 080046 f0030103 28 00 000100 1001 %w 00 %?%? %?%?%?%? %?%?%?%? %*');\n                        replydata = crypto_js_1.default.DES.decrypt(crypto_js_1.default.lib.WordArray.create(res[1]), crypto_js_1.default.enc.Hex.parse(hexSessionKey), {\n                            mode: crypto_js_1.default.mode.CBC,\n                            iv: crypto_js_1.default.enc.Hex.parse('0000000000000000'),\n                        }).toString(crypto_js_1.default.enc.Utf8);\n                        return [2 /*return*/, [jsbi_1.default.toNumber(res[0]), replydata.substring(0, 8), replydata.substring(12, 32)]];\n                }\n            });\n        });\n    };\n    NetMDInterface.prototype.getTrackUUID = function (track) {\n        return __awaiter(this, void 0, void 0, function () {\n            var query, reply, res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        query = query_utils_1.formatQuery('1800 080046 f0030103 23 ff 1001 %w', track);\n                        return [4 /*yield*/, this.sendQuery(query)];\n                    case 1:\n                        reply = _a.sent();\n                        res = query_utils_1.scanQuery(reply, '1800 080046 f0030103 23 00 1001 %?%? %*');\n                        return [2 /*return*/, String.fromCharCode.apply(String, __spread(res[0]))];\n                }\n            });\n        });\n    };\n    NetMDInterface.maxInterimReadAttempts = 3;\n    NetMDInterface.interimResponseRetryIntervalInMs = 100;\n    return NetMDInterface;\n}());\nexports.NetMDInterface = NetMDInterface;\nfunction retailmac(key, value, iv) {\n    if (iv === void 0) { iv = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]); }\n    var subkeyA = key.subarray(0, 8);\n    var beginning = value.subarray(0, value.length - 8);\n    var end = value.subarray(value.length - 8, value.length);\n    var step1 = crypto_js_1.default.DES.encrypt(crypto_js_1.default.lib.WordArray.create(beginning), crypto_js_1.default.lib.WordArray.create(subkeyA), {\n        mode: crypto_js_1.default.mode.CBC,\n        iv: crypto_js_1.default.lib.WordArray.create(iv),\n    });\n    var iv2 = crypto_js_1.default.enc.Hex.stringify(step1.ciphertext);\n    iv2 = iv2.substring(0, iv2.length - 16); // last 8 byte\n    var step2 = crypto_js_1.default.TripleDES.encrypt(crypto_js_1.default.lib.WordArray.create(end), crypto_js_1.default.lib.WordArray.create(key), {\n        mode: crypto_js_1.default.mode.CBC,\n        iv: crypto_js_1.default.enc.Hex.parse(iv2),\n    });\n    return crypto_js_1.default.enc.Hex.stringify(step2.ciphertext).substring(0, 16);\n}\nexports.retailmac = retailmac;\nvar discforwire = (_b = {},\n    _b[Wireformat.pcm] = DiscFormat.spStereo,\n    _b[Wireformat.lp2] = DiscFormat.lp2,\n    _b[Wireformat.l105kbps] = DiscFormat.lp2,\n    _b[Wireformat.lp4] = DiscFormat.lp4,\n    _b);\nvar EKBOpenSource = /** @class */ (function () {\n    function EKBOpenSource() {\n    }\n    EKBOpenSource.prototype.getRootKey = function () {\n        // prettier-ignore\n        return new Uint8Array([\n            0x12, 0x34, 0x56, 0x78, 0x9a, 0xbc, 0xde, 0xf0,\n            0x0f, 0xed, 0xcb, 0xa9, 0x87, 0x65, 0x43, 0x21\n        ]);\n    };\n    EKBOpenSource.prototype.getEKBID = function () {\n        return 0x26422642;\n    };\n    EKBOpenSource.prototype.getEKBDataForLeafId = function () {\n        // prettier-ignore\n        return [\n            [\n                new Uint8Array([0x25, 0x45, 0x06, 0x4d, 0xea, 0xca, 0x14, 0xf9, 0x96, 0xbd, 0xc8, 0xa4, 0x06, 0xc2, 0x2b, 0x81]),\n                new Uint8Array([0xfb, 0x60, 0xbd, 0xdd, 0x0d, 0xbc, 0xab, 0x84, 0x8a, 0x00, 0x5e, 0x03, 0x19, 0x4d, 0x3e, 0xda]),\n            ],\n            9,\n            new Uint8Array([\n                0x8f, 0x2b, 0xc3, 0x52, 0xe8, 0x6c, 0x5e, 0xd3, 0x06, 0xdc, 0xae, 0x18,\n                0xd2, 0xf3, 0x8c, 0x7f, 0x89, 0xb5, 0xe1, 0x85, 0x55, 0xa1, 0x05, 0xea\n            ])\n        ];\n    };\n    return EKBOpenSource;\n}());\nexports.EKBOpenSource = EKBOpenSource;\nvar MDTrack = /** @class */ (function () {\n    function MDTrack(title, format, data, chunkSize, encryptPacketsIterator) {\n        this.title = title;\n        this.format = format;\n        this.data = data;\n        this.chunkSize = chunkSize;\n        this.encryptPacketsIterator = encryptPacketsIterator;\n    }\n    MDTrack.prototype.getTitle = function () {\n        return this.title;\n    };\n    MDTrack.prototype.getDataFormat = function () {\n        return this.format;\n    };\n    MDTrack.prototype.getFrameCount = function () {\n        return this.getTotalSize() / this.getFrameSize();\n    };\n    MDTrack.prototype.getFrameSize = function () {\n        return exports.FrameSize[this.format];\n    };\n    MDTrack.prototype.getChunkSize = function () {\n        return this.chunkSize;\n    };\n    MDTrack.prototype.getTotalSize = function () {\n        var frameSize = this.getFrameSize();\n        var len = this.data.byteLength;\n        if (len % frameSize !== 0) {\n            len = len + (frameSize - (len % frameSize));\n        }\n        return len;\n    };\n    MDTrack.prototype.getContentID = function () {\n        // prettier-ignore\n        return new Uint8Array([\n            0x01, 0x0f, 0x50, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x48,\n            0xa2, 0x8d, 0x3e, 0x1a, 0x3b, 0x0c, 0x44, 0xaf, 0x2f, 0xa0,\n        ]);\n    };\n    MDTrack.prototype.getKEK = function () {\n        return new Uint8Array([0x14, 0xe3, 0x83, 0x4e, 0xe2, 0xd3, 0xcc, 0xa5]);\n    };\n    MDTrack.prototype.getPackets = function () {\n        // Deprecated. Use getPacketIterator\n        var datakey = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);\n        var firstiv = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);\n        var datakeyWA = crypto_js_1.default.lib.WordArray.create(datakey);\n        var kekWA = crypto_js_1.default.lib.WordArray.create(this.getKEK());\n        var key = crypto_js_1.default.DES.encrypt(datakeyWA, kekWA, { mode: crypto_js_1.default.mode.ECB });\n        var firstivWA = crypto_js_1.default.lib.WordArray.create(firstiv);\n        var dataWA = crypto_js_1.default.lib.WordArray.create(this.data);\n        var encrypted = crypto_js_1.default.DES.encrypt(dataWA, key.ciphertext, {\n            mode: crypto_js_1.default.mode.CBC,\n            iv: firstivWA,\n        });\n        var encryptedData = utils_1.wordArrayToByteArray(encrypted.ciphertext);\n        encryptedData = encryptedData.subarray(0, this.data.byteLength); // CAVEAT: don't know why, but python Crypto returns 8 bytes less that js Crypto\n        return [[datakey, firstiv, encryptedData]];\n    };\n    MDTrack.prototype.getPacketWorkerIterator = function () {\n        return this.encryptPacketsIterator({\n            kek: this.getKEK(),\n            data: this.data,\n            frameSize: this.getFrameSize(),\n            chunkSize: this.chunkSize,\n        });\n    };\n    MDTrack.prototype.getPacketIterator = function () {\n        return __asyncGenerator(this, arguments, function getPacketIterator_1() {\n            var iv, ivWA, kekWA, rawKeyWA, keyDec, key, defaultChunkSize, packetCount, chunkSize, uint8DataArray, frameSize, padding, offset, dataChunk, dataChunkWA, encryptedChunk, encryptedDataChunk;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        iv = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);\n                        ivWA = crypto_js_1.default.lib.WordArray.create(iv);\n                        kekWA = crypto_js_1.default.lib.WordArray.create(this.getKEK());\n                        rawKeyWA = crypto_js_1.default.lib.WordArray.random(8);\n                        keyDec = crypto_js_1.default.DES.decrypt({\n                            ciphertext: rawKeyWA,\n                        }, kekWA, { mode: crypto_js_1.default.mode.ECB, padding: crypto_js_1.default.pad.Pkcs7 });\n                        keyDec.sigBytes = 8;\n                        key = utils_1.wordArrayToByteArray(keyDec);\n                        defaultChunkSize = 0x00100000;\n                        packetCount = 0;\n                        chunkSize = 0;\n                        uint8DataArray = new Uint8Array(this.data);\n                        frameSize = this.getFrameSize();\n                        if (uint8DataArray.length % frameSize !== 0) {\n                            padding = frameSize - (uint8DataArray.length % frameSize);\n                            uint8DataArray = utils_1.concatUint8Arrays(uint8DataArray, new Uint8Array(Array(padding).fill(0)));\n                        }\n                        offset = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(offset < uint8DataArray.length)) return [3 /*break*/, 4];\n                        if (packetCount > 0) {\n                            chunkSize = defaultChunkSize;\n                        }\n                        else {\n                            chunkSize = defaultChunkSize - 24;\n                        }\n                        chunkSize = Math.min(chunkSize, uint8DataArray.length - offset);\n                        dataChunk = uint8DataArray.subarray(offset, offset + chunkSize);\n                        dataChunkWA = crypto_js_1.default.lib.WordArray.create(dataChunk);\n                        encryptedChunk = crypto_js_1.default.DES.encrypt(dataChunkWA, rawKeyWA, {\n                            mode: crypto_js_1.default.mode.CBC,\n                            iv: ivWA,\n                        });\n                        encryptedDataChunk = utils_1.wordArrayToByteArray(encryptedChunk.ciphertext);\n                        encryptedDataChunk = encryptedDataChunk.subarray(0, chunkSize); //encryptedDataChunk.length - 8\n                        return [4 /*yield*/, __await([key, iv, encryptedDataChunk])];\n                    case 2: //encryptedDataChunk.length - 8\n                    return [4 /*yield*/, _a.sent()];\n                    case 3:\n                        _a.sent();\n                        // Next iv\n                        ivWA = crypto_js_1.default.lib.WordArray.create(encryptedDataChunk.subarray(encryptedDataChunk.length - 8, encryptedDataChunk.length));\n                        iv = utils_1.wordArrayToByteArray(ivWA);\n                        offset = offset + chunkSize;\n                        packetCount += 1;\n                        return [3 /*break*/, 1];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return MDTrack;\n}());\nexports.MDTrack = MDTrack;\nvar MDSession = /** @class */ (function () {\n    function MDSession(md, ekbobject, hexSessionKey) {\n        this.md = md;\n        this.ekbobject = ekbobject;\n        this.hexSessionKey = hexSessionKey;\n    }\n    MDSession.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, chain, depth, sig, hostnonce, devnonce, nonce;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.md.enterSecureSession()];\n                    case 1:\n                        _b.sent();\n                        _a = __read(this.ekbobject.getEKBDataForLeafId(), 3), chain = _a[0], depth = _a[1], sig = _a[2];\n                        return [4 /*yield*/, this.md.sendKeyData(jsbi_1.default.BigInt(this.ekbobject.getEKBID()), chain, depth, sig)];\n                    case 2:\n                        _b.sent();\n                        hostnonce = new Uint8Array(Array(8)\n                            .fill(0)\n                            .map(function (_) { return Math.round(Math.random() * 255); }));\n                        return [4 /*yield*/, this.md.sessionKeyExchange(hostnonce)];\n                    case 3:\n                        devnonce = _b.sent();\n                        nonce = utils_1.concatUint8Arrays(hostnonce, devnonce);\n                        this.hexSessionKey = retailmac(this.ekbobject.getRootKey(), nonce);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    MDSession.prototype.downloadTrack = function (trk, progressCallback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var dataFormat, _a, track, uuid, ccid;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this.hexSessionKey) {\n                            throw new Error(\"Call init first!\");\n                        }\n                        return [4 /*yield*/, this.md.setupDownload(trk.getContentID(), trk.getKEK(), this.hexSessionKey)];\n                    case 1:\n                        _b.sent();\n                        dataFormat = trk.getDataFormat();\n                        return [4 /*yield*/, this.md.sendTrack(dataFormat, discforwire[dataFormat], trk.getFrameCount(), trk.getTotalSize(), trk.getPacketWorkerIterator(), this.hexSessionKey, progressCallback)];\n                    case 2:\n                        _a = __read.apply(void 0, [_b.sent(), 3]), track = _a[0], uuid = _a[1], ccid = _a[2];\n                        return [4 /*yield*/, this.md.cacheTOC()];\n                    case 3:\n                        _b.sent();\n                        return [4 /*yield*/, this.md.setTrackTitle(track, trk.title)];\n                    case 4:\n                        _b.sent();\n                        return [4 /*yield*/, this.md.syncTOC()];\n                    case 5:\n                        _b.sent();\n                        return [4 /*yield*/, this.md.commitTrack(track, this.hexSessionKey)];\n                    case 6:\n                        _b.sent();\n                        return [2 /*return*/, [track, uuid, ccid]];\n                }\n            });\n        });\n    };\n    MDSession.prototype.close = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var err_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.hexSessionKey !== undefined)) return [3 /*break*/, 5];\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, this.md.sessionKeyForget()];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_3 = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 4:\n                        this.hexSessionKey = undefined;\n                        _a.label = 5;\n                    case 5: return [4 /*yield*/, this.md.leaveSecureSession()];\n                    case 6:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return MDSession;\n}());\nexports.MDSession = MDSession;\n//# sourceMappingURL=netmd-interface.js.map","\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./netmd\"));\n__export(require(\"./netmd-interface\"));\n__export(require(\"./netmd-commands\"));\n__export(require(\"./encrypt-generator\"));\nvar utils_1 = require(\"./utils\");\nexports.formatTimeFromFrames = utils_1.formatTimeFromFrames;\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __await = (this && this.__await) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); }\nvar __asyncGenerator = (this && this.__asyncGenerator) || function (thisArg, _arguments, generator) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n    function fulfill(value) { resume(\"next\", value); }\n    function reject(value) { resume(\"throw\", value); }\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar crypto_js_1 = __importDefault(require(\"crypto-js\"));\nvar utils_1 = require(\"./utils\");\nfunction getAsyncPacketIterator(_a) {\n    var data = _a.data, frameSize = _a.frameSize, kek = _a.kek, chunkSize = _a.chunkSize;\n    return __asyncGenerator(this, arguments, function getAsyncPacketIterator_1() {\n        var iv, ivWA, kekWA, rawKeyWA, keyDec, key, defaultChunkSize, packetCount, currentChunkSize, uint8DataArray, padding, offset, dataChunk, dataChunkWA, encryptedChunk, encryptedDataChunk, nextIvWA, nextiv;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    iv = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);\n                    ivWA = crypto_js_1.default.lib.WordArray.create(iv);\n                    kekWA = crypto_js_1.default.lib.WordArray.create(kek);\n                    rawKeyWA = crypto_js_1.default.lib.WordArray.random(8);\n                    keyDec = crypto_js_1.default.DES.decrypt({\n                        ciphertext: rawKeyWA,\n                    }, kekWA, { mode: crypto_js_1.default.mode.ECB, padding: crypto_js_1.default.pad.Pkcs7 });\n                    keyDec.sigBytes = 8;\n                    key = utils_1.wordArrayToByteArray(keyDec);\n                    defaultChunkSize = chunkSize ? chunkSize : 0x00100000;\n                    packetCount = 0;\n                    currentChunkSize = 0;\n                    uint8DataArray = new Uint8Array(data);\n                    if (uint8DataArray.length % frameSize !== 0) {\n                        padding = frameSize - (uint8DataArray.length % frameSize);\n                        uint8DataArray = utils_1.concatUint8Arrays(uint8DataArray, new Uint8Array(Array(padding).fill(0)));\n                    }\n                    offset = 0;\n                    _a.label = 1;\n                case 1:\n                    if (!(offset < uint8DataArray.length)) return [3 /*break*/, 4];\n                    if (packetCount > 0) {\n                        currentChunkSize = defaultChunkSize;\n                    }\n                    else {\n                        currentChunkSize = defaultChunkSize - 24;\n                    }\n                    currentChunkSize = Math.min(currentChunkSize, uint8DataArray.length - offset);\n                    dataChunk = uint8DataArray.subarray(offset, offset + currentChunkSize);\n                    dataChunkWA = crypto_js_1.default.lib.WordArray.create(dataChunk);\n                    encryptedChunk = crypto_js_1.default.DES.encrypt(dataChunkWA, rawKeyWA, {\n                        mode: crypto_js_1.default.mode.CBC,\n                        iv: ivWA,\n                    });\n                    encryptedDataChunk = utils_1.wordArrayToByteArray(encryptedChunk.ciphertext);\n                    encryptedDataChunk = encryptedDataChunk.subarray(0, currentChunkSize); //encryptedDataChunk.length - 8\n                    nextIvWA = crypto_js_1.default.lib.WordArray.create(encryptedDataChunk.subarray(encryptedDataChunk.length - 8, encryptedDataChunk.length));\n                    nextiv = utils_1.wordArrayToByteArray(ivWA);\n                    return [4 /*yield*/, __await({ key: key, iv: iv, data: encryptedDataChunk })];\n                case 2: return [4 /*yield*/, _a.sent()];\n                case 3:\n                    _a.sent();\n                    ivWA = nextIvWA;\n                    iv = nextiv;\n                    offset = offset + currentChunkSize;\n                    packetCount += 1;\n                    return [3 /*break*/, 1];\n                case 4: return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.getAsyncPacketIterator = getAsyncPacketIterator;\n//# sourceMappingURL=encrypt-generator.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __await = (this && this.__await) || function (v) { return this instanceof __await ? (this.v = v, this) : new __await(v); }\nvar __asyncGenerator = (this && this.__asyncGenerator) || function (thisArg, _arguments, generator) {\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\n    function fulfill(value) { resume(\"next\", value); }\n    function reject(value) { resume(\"throw\", value); }\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar encrypt_generator_1 = require(\"./encrypt-generator\");\n// This generator uses a worker thread to encrypt the nextChunk\n// while yielding the current one.\nfunction makeGetAsyncPacketIteratorOnWorkerThread(worker, progressCallback) {\n    return function getAsyncPacketIteratorOnWorkerThread(_a) {\n        var data = _a.data, frameSize = _a.frameSize, kek = _a.kek, chunkSize = _a.chunkSize;\n        return __asyncGenerator(this, arguments, function getAsyncPacketIteratorOnWorkerThread_1() {\n            var w, initWorker, askNextChunk, resolver, encryptedBytes, totalBytes, chunks, queueNextChunk, i, r;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        w = worker;\n                        initWorker = function () {\n                            w.postMessage({\n                                action: 'init',\n                                data: data,\n                                frameSize: frameSize,\n                                kek: kek,\n                                chunkSize: chunkSize,\n                            }, [data]);\n                        };\n                        askNextChunk = function () {\n                            w.postMessage({ action: 'getChunk' });\n                        };\n                        w.onmessage = function (ev) {\n                            resolver(ev.data);\n                        };\n                        encryptedBytes = 0;\n                        totalBytes = data.byteLength;\n                        chunks = [];\n                        queueNextChunk = function () {\n                            var chunkPromise = new Promise(function (resolve) {\n                                resolver = function (data) {\n                                    if (data !== null) {\n                                        encryptedBytes += data.data.byteLength;\n                                        progressCallback && progressCallback({ totalBytes: totalBytes, encryptedBytes: encryptedBytes });\n                                        queueNextChunk();\n                                    }\n                                    resolve(data);\n                                };\n                            });\n                            chunks.push(chunkPromise);\n                            askNextChunk();\n                        };\n                        initWorker();\n                        queueNextChunk();\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!1) return [3 /*break*/, 5];\n                        return [4 /*yield*/, __await(chunks[i])];\n                    case 2:\n                        r = _a.sent();\n                        if (r === null) {\n                            return [3 /*break*/, 5];\n                        }\n                        return [4 /*yield*/, __await(r)];\n                    case 3: return [4 /*yield*/, _a.sent()];\n                    case 4:\n                        _a.sent();\n                        delete chunks[i];\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n}\nexports.makeGetAsyncPacketIteratorOnWorkerThread = makeGetAsyncPacketIteratorOnWorkerThread;\nif (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope) {\n    // Worker\n    var iterator_1;\n    onmessage = function (ev) { return __awaiter(void 0, void 0, void 0, function () {\n        var _a, action, others, data, frameSize, kek, chunkSize, _b, value, done, key, iv, data;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    _a = ev.data, action = _a.action, others = __rest(_a, [\"action\"]);\n                    if (!(action === 'init')) return [3 /*break*/, 1];\n                    data = others.data, frameSize = others.frameSize, kek = others.kek, chunkSize = others.chunkSize;\n                    iterator_1 = encrypt_generator_1.getAsyncPacketIterator({ data: data, frameSize: frameSize, kek: kek, chunkSize: chunkSize });\n                    return [3 /*break*/, 3];\n                case 1:\n                    if (!(action === 'getChunk')) return [3 /*break*/, 3];\n                    return [4 /*yield*/, iterator_1.next()];\n                case 2:\n                    _b = _c.sent(), value = _b.value, done = _b.done;\n                    if (done) {\n                        postMessage(null);\n                        self.close();\n                    }\n                    else {\n                        key = value.key, iv = value.iv, data = value.data;\n                        postMessage({ key: key, iv: iv, data: data }, [data.buffer]);\n                    }\n                    _c.label = 3;\n                case 3: return [2 /*return*/];\n            }\n        });\n    }); };\n}\nelse {\n    // Main\n}\n//# sourceMappingURL=web-encrypt-worker.js.map","module.exports = __webpack_public_path__ + \"static/media/chrome-icon.f3b6c54c.svg\";","\"use strict\";\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = require(\"./utils\");\nvar jsbi_1 = __importDefault(require(\"jsbi\"));\n// prettier-ignore\nvar FORMAT_TYPE_LEN_DICT = {\n    'b': 1,\n    'w': 2,\n    'd': 4,\n    'q': 8,\n};\nfunction formatQuery(format) {\n    var e_1, _a;\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    var result = [];\n    var half = null;\n    var argStack = Array.from(args);\n    var escaped = false;\n    try {\n        for (var format_1 = __values(format), format_1_1 = format_1.next(); !format_1_1.done; format_1_1 = format_1.next()) {\n            var char = format_1_1.value;\n            if (escaped) {\n                escaped = false;\n                var value = argStack.shift();\n                if (char in FORMAT_TYPE_LEN_DICT) {\n                    var numberValue = jsbi_1.default.BigInt(value);\n                    for (var byte = FORMAT_TYPE_LEN_DICT[char] - 1; byte >= 0; byte--) {\n                        var v = jsbi_1.default.signedRightShift(numberValue, jsbi_1.default.BigInt(byte * 8));\n                        v = jsbi_1.default.bitwiseAnd(v, jsbi_1.default.BigInt(0xff));\n                        result.push(jsbi_1.default.toNumber(v));\n                    }\n                }\n                else if (char === 'x' || char === 's') {\n                    var uint8ArrayValue = utils_1.assertUint8Array(value);\n                    var bufferLength = uint8ArrayValue.byteLength;\n                    if (char === 's') {\n                        bufferLength += 1;\n                    }\n                    result.push((bufferLength >> 8) & 0xff);\n                    result.push(bufferLength & 0xff);\n                    result.push.apply(result, __spread(uint8ArrayValue));\n                    if (char === 's') {\n                        result.push(0);\n                    }\n                }\n                else if (char === '*') {\n                    if (value instanceof Uint8Array) {\n                        result.push.apply(result, __spread(value));\n                    }\n                    else {\n                        utils_1.assert(false, \"Unexpected type for value\");\n                    }\n                }\n                else {\n                    utils_1.assert(false, \"Unrecognized format char \" + char);\n                }\n                continue;\n            }\n            if (char === '%') {\n                utils_1.assert(half === null, \"Expected \\\"half\\\" to be null\");\n                escaped = true;\n                continue;\n            }\n            if (char === ' ') {\n                continue;\n            }\n            if (half === null) {\n                half = char;\n            }\n            else {\n                result.push(Number.parseInt(half + char, 16));\n                half = null;\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (format_1_1 && !format_1_1.done && (_a = format_1.return)) _a.call(format_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return new Uint8Array(result).buffer;\n}\nexports.formatQuery = formatQuery;\nfunction scanQuery(query, format) {\n    var e_2, _a;\n    var result = [];\n    var inputStack;\n    if (query instanceof ArrayBuffer) {\n        inputStack = Array.from(new Uint8Array(query));\n    }\n    else {\n        inputStack = query;\n    }\n    var initialLength = inputStack.length;\n    var half = null;\n    var escaped = false;\n    try {\n        for (var format_2 = __values(format), format_2_1 = format_2.next(); !format_2_1.done; format_2_1 = format_2.next()) {\n            var char = format_2_1.value;\n            if (escaped) {\n                escaped = false;\n                if (char === '?') {\n                    inputStack.shift();\n                    continue;\n                }\n                if (char in FORMAT_TYPE_LEN_DICT) {\n                    var value = jsbi_1.default.BigInt(0);\n                    for (var byte = FORMAT_TYPE_LEN_DICT[char] - 1; byte >= 0; byte--) {\n                        var v = jsbi_1.default.BigInt(inputStack.shift());\n                        v = jsbi_1.default.leftShift(v, jsbi_1.default.BigInt(byte * 8));\n                        value = jsbi_1.default.bitwiseOr(value, v);\n                    }\n                    result.push(value);\n                }\n                else if (char === 's' || char === 'x') {\n                    var length = (inputStack.shift() << 8) | inputStack.shift();\n                    var newInputStack = inputStack.splice(length);\n                    var buffer = new Uint8Array(inputStack);\n                    inputStack = newInputStack;\n                    if (char === 's') {\n                        result.push(buffer);\n                        // result.push(value.substring(0, value.length - 1));\n                    }\n                    else {\n                        result.push(buffer);\n                    }\n                }\n                else if (char === '*') {\n                    var buffer = new Uint8Array(inputStack.splice(0));\n                    result.push(buffer);\n                }\n                else if (char === '#') {\n                    var value = new Uint8Array(inputStack.splice(0));\n                    result.push(value);\n                }\n                else {\n                    throw new Error(\"Unrecognized format char \" + char);\n                }\n                continue;\n            }\n            if (char === '%') {\n                utils_1.assert(half === null);\n                escaped = true;\n                continue;\n            }\n            if (char === ' ') {\n                continue;\n            }\n            if (half === null) {\n                half = char;\n            }\n            else {\n                var inputValue = inputStack.shift();\n                var formatValue = Number.parseInt(half + char, 16);\n                if (formatValue != inputValue) {\n                    var i = initialLength - inputStack.length - 1;\n                    throw new Error(\"Format and input mismatch at \" + i + \": expected \" + formatValue + \", got \" + inputValue);\n                }\n                half = null;\n            }\n        }\n    }\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n    finally {\n        try {\n            if (format_2_1 && !format_2_1.done && (_a = format_2.return)) _a.call(format_2);\n        }\n        finally { if (e_2) throw e_2.error; }\n    }\n    utils_1.assert(inputStack.length === 0, inputStack.length + \" Bytes remaining to parse\");\n    return result;\n}\nexports.scanQuery = scanQuery;\nfunction BCD2int(bcd /* max 32 bits */) {\n    var value = 0;\n    var nibble = 0;\n    while (bcd !== 0) {\n        var nibbleValue = bcd & 0xf;\n        bcd = bcd >>> 4;\n        value += nibbleValue * Math.pow(10, nibble);\n        nibble += 1;\n    }\n    return value;\n}\nexports.BCD2int = BCD2int;\nfunction int2BCD(value, length) {\n    var _a;\n    if (length === void 0) { length = 1; }\n    if (length > 4) {\n        throw new Error(\"Unsupported length. Max allowed is 4\");\n    }\n    if (value > Math.pow(10, length * 2) - 1) {\n        throw new Error(\"Value \" + value + \" cannot fit in \" + length + \" bytes in BCD\");\n    }\n    var bcd = 0;\n    var nibble = 0;\n    var nibbleValue;\n    while (value) {\n        _a = __read([Math.floor(value / 10), value % 10], 2), value = _a[0], nibbleValue = _a[1];\n        bcd |= nibbleValue << (4 * nibble);\n        nibble += 1;\n    }\n    return bcd;\n}\nexports.int2BCD = int2BCD;\n//# sourceMappingURL=query-utils.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar _a, _b, _c;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar netmd_1 = require(\"./netmd\");\nvar netmd_interface_1 = require(\"./netmd-interface\");\nvar utils_1 = require(\"./utils\");\nexports.EncodingName = (_a = {},\n    _a[netmd_interface_1.Encoding.sp] = 'sp',\n    _a[netmd_interface_1.Encoding.lp2] = 'lp2',\n    _a[netmd_interface_1.Encoding.lp4] = 'lp4',\n    _a);\nexports.ChannelName = (_b = {},\n    _b[netmd_interface_1.Channels.mono] = 'mono',\n    _b[netmd_interface_1.Channels.stereo] = 'stereo',\n    _b);\nexports.Flag = (_c = {},\n    _c[netmd_interface_1.TrackFlag.protected] = 'protected',\n    _c[netmd_interface_1.TrackFlag.unprotected] = 'unprotected',\n    _c);\nfunction openPairedDevice(usb, logger) {\n    return __awaiter(this, void 0, void 0, function () {\n        var devices, netmd;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, usb.getDevices()];\n                case 1:\n                    devices = _a.sent();\n                    if (devices.length === 0) {\n                        return [2 /*return*/, null]; // No device found\n                    }\n                    netmd = new netmd_1.NetMD(devices[0], 0, logger);\n                    return [4 /*yield*/, netmd.init()];\n                case 2:\n                    _a.sent();\n                    return [2 /*return*/, new netmd_interface_1.NetMDInterface(netmd, logger)];\n            }\n        });\n    });\n}\nexports.openPairedDevice = openPairedDevice;\nfunction openNewDevice(usb, logger) {\n    return __awaiter(this, void 0, void 0, function () {\n        var filters, device, err_1, netmd;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    filters = netmd_1.DevicesIds.map(function (_a) {\n                        var vendorId = _a.vendorId, deviceId = _a.deviceId;\n                        return ({ vendorId: vendorId, deviceId: deviceId });\n                    });\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, usb.requestDevice({ filters: filters })];\n                case 2:\n                    device = _a.sent();\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    return [2 /*return*/, null]; // No device found or not allowed by the user\n                case 4:\n                    netmd = new netmd_1.NetMD(device, 0, logger);\n                    return [4 /*yield*/, netmd.init()];\n                case 5:\n                    _a.sent();\n                    return [2 /*return*/, new netmd_interface_1.NetMDInterface(netmd, logger)];\n            }\n        });\n    });\n}\nexports.openNewDevice = openNewDevice;\nfunction listDevice(usb) {\n    var _a, _b, _c, _d;\n    return __awaiter(this, void 0, void 0, function () {\n        var filters, device, id, d;\n        return __generator(this, function (_e) {\n            switch (_e.label) {\n                case 0:\n                    filters = netmd_1.DevicesIds.map(function (_a) {\n                        var vendorId = _a.vendorId, deviceId = _a.deviceId;\n                        return ({ vendorId: vendorId, deviceId: deviceId });\n                    });\n                    return [4 /*yield*/, usb.requestDevice({ filters: filters })];\n                case 1:\n                    device = _e.sent();\n                    id = netmd_1.DevicesIds.find(function (did) {\n                        return did.deviceId == device.productId && did.vendorId === device.vendorId;\n                    });\n                    d = {\n                        manufacturerName: (_a = device.manufacturerName, (_a !== null && _a !== void 0 ? _a : 'unknown')),\n                        productName: (_b = device.productName, (_b !== null && _b !== void 0 ? _b : 'unknown')),\n                        vendorId: device.vendorId,\n                        productId: device.productId,\n                        name: (_d = (_c = id) === null || _c === void 0 ? void 0 : _c.name, (_d !== null && _d !== void 0 ? _d : 'unknown')),\n                    };\n                    return [2 /*return*/, d];\n            }\n        });\n    });\n}\nexports.listDevice = listDevice;\nvar OperatingStatus = {\n    50687: 'ready',\n    50037: 'playing',\n    49983: 'fastForward',\n    49999: 'rewind',\n    65315: 'readingTOC',\n};\nfunction getDeviceStatus(mdIface) {\n    return __awaiter(this, void 0, void 0, function () {\n        var status, playbackStatus2, _a, b1, b2, operatingStatus, position, track, discPresent, state, time;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0: return [4 /*yield*/, mdIface.getStatus()];\n                case 1:\n                    status = _b.sent();\n                    return [4 /*yield*/, mdIface.getPlaybackStatus2()];\n                case 2:\n                    playbackStatus2 = _b.sent();\n                    _a = __read([playbackStatus2[4], playbackStatus2[5]], 2), b1 = _a[0], b2 = _a[1];\n                    operatingStatus = (b1 << 8) | b2;\n                    return [4 /*yield*/, mdIface.getPosition()];\n                case 3:\n                    position = _b.sent();\n                    track = position ? position[0] : null;\n                    discPresent = status[4] === 0x40;\n                    state = operatingStatus in OperatingStatus ? OperatingStatus[operatingStatus] : 'unknown';\n                    if (state === 'playing' && !discPresent) {\n                        state = 'ready';\n                    }\n                    time = position\n                        ? {\n                            minute: position[2],\n                            second: position[3],\n                            frame: position[4],\n                        }\n                        : null;\n                    return [2 /*return*/, {\n                            discPresent: discPresent,\n                            state: state,\n                            track: track,\n                            time: time,\n                        }];\n            }\n        });\n    });\n}\nexports.getDeviceStatus = getDeviceStatus;\nfunction countTracksInDisc(disc) {\n    return disc.groups.reduce(function (acc, g, _) {\n        return acc + g.tracks.length;\n    }, 0);\n}\nexports.countTracksInDisc = countTracksInDisc;\nfunction getTracks(disc) {\n    var e_1, _a, e_2, _b;\n    var tracks = [];\n    try {\n        for (var _c = __values(disc.groups), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var group = _d.value;\n            try {\n                for (var _e = (e_2 = void 0, __values(group.tracks)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                    var track = _f.value;\n                    tracks.push(track);\n                }\n            }\n            catch (e_2_1) { e_2 = { error: e_2_1 }; }\n            finally {\n                try {\n                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                }\n                finally { if (e_2) throw e_2.error; }\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return tracks;\n}\nexports.getTracks = getTracks;\nfunction listContent(mdIface) {\n    return __awaiter(this, void 0, void 0, function () {\n        var flags, title, _a, discUsed, discTotal, discLeft, trackCount, disc, trackGroupList, _b, _c, _d, groupIndex, _e, groupName, trackLists, g, tracks, _f, _g, _h, trackIndex, track, title_1, _j, codec, channel, duration, _k, flags_1, t, e_3_1, e_4_1;\n        var e_4, _l, e_3, _m;\n        return __generator(this, function (_o) {\n            switch (_o.label) {\n                case 0: return [4 /*yield*/, mdIface.getDiscFlags()];\n                case 1:\n                    flags = _o.sent();\n                    return [4 /*yield*/, mdIface.getDiscTitle()];\n                case 2:\n                    title = _o.sent();\n                    return [4 /*yield*/, mdIface.getDiscCapacity()];\n                case 3:\n                    _a = __read.apply(void 0, [_o.sent(), 3]), discUsed = _a[0], discTotal = _a[1], discLeft = _a[2];\n                    return [4 /*yield*/, mdIface.getTrackCount()];\n                case 4:\n                    trackCount = _o.sent();\n                    disc = {\n                        title: title,\n                        writable: !!(flags & netmd_interface_1.DiscFlag.writable),\n                        writeProtected: !!(flags & netmd_interface_1.DiscFlag.writeProtected),\n                        used: utils_1.timeToFrames(discUsed),\n                        left: utils_1.timeToFrames(discLeft),\n                        total: utils_1.timeToFrames(discTotal),\n                        trackCount: trackCount,\n                        groups: [],\n                    };\n                    return [4 /*yield*/, mdIface.getTrackGroupList()];\n                case 5:\n                    trackGroupList = _o.sent();\n                    _o.label = 6;\n                case 6:\n                    _o.trys.push([6, 21, 22, 23]);\n                    _b = __values(trackGroupList.entries()), _c = _b.next();\n                    _o.label = 7;\n                case 7:\n                    if (!!_c.done) return [3 /*break*/, 20];\n                    _d = __read(_c.value, 2), groupIndex = _d[0], _e = __read(_d[1], 2), groupName = _e[0], trackLists = _e[1];\n                    g = {\n                        index: groupIndex,\n                        title: groupName,\n                        tracks: [],\n                    };\n                    disc.groups.push(g);\n                    tracks = [];\n                    _o.label = 8;\n                case 8:\n                    _o.trys.push([8, 16, 17, 18]);\n                    _f = (e_3 = void 0, __values(trackLists.entries())), _g = _f.next();\n                    _o.label = 9;\n                case 9:\n                    if (!!_g.done) return [3 /*break*/, 15];\n                    _h = __read(_g.value, 2), trackIndex = _h[0], track = _h[1];\n                    return [4 /*yield*/, mdIface.getTrackTitle(track)];\n                case 10:\n                    title_1 = _o.sent();\n                    return [4 /*yield*/, mdIface.getTrackEncoding(track)];\n                case 11:\n                    _j = __read.apply(void 0, [_o.sent(), 2]), codec = _j[0], channel = _j[1];\n                    _k = utils_1.timeToFrames;\n                    return [4 /*yield*/, mdIface.getTrackLength(track)];\n                case 12:\n                    duration = _k.apply(void 0, [_o.sent()]);\n                    return [4 /*yield*/, mdIface.getTrackFlags(track)];\n                case 13:\n                    flags_1 = _o.sent();\n                    t = {\n                        index: track,\n                        title: title_1,\n                        duration: duration,\n                        channel: channel,\n                        encoding: codec,\n                        protected: flags_1,\n                    };\n                    tracks.push(t);\n                    _o.label = 14;\n                case 14:\n                    _g = _f.next();\n                    return [3 /*break*/, 9];\n                case 15: return [3 /*break*/, 18];\n                case 16:\n                    e_3_1 = _o.sent();\n                    e_3 = { error: e_3_1 };\n                    return [3 /*break*/, 18];\n                case 17:\n                    try {\n                        if (_g && !_g.done && (_m = _f.return)) _m.call(_f);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                    return [7 /*endfinally*/];\n                case 18:\n                    g.tracks = g.tracks.concat(tracks);\n                    _o.label = 19;\n                case 19:\n                    _c = _b.next();\n                    return [3 /*break*/, 7];\n                case 20: return [3 /*break*/, 23];\n                case 21:\n                    e_4_1 = _o.sent();\n                    e_4 = { error: e_4_1 };\n                    return [3 /*break*/, 23];\n                case 22:\n                    try {\n                        if (_c && !_c.done && (_l = _b.return)) _l.call(_b);\n                    }\n                    finally { if (e_4) throw e_4.error; }\n                    return [7 /*endfinally*/];\n                case 23: return [2 /*return*/, disc];\n            }\n        });\n    });\n}\nexports.listContent = listContent;\nfunction download(mdIface, track, progressCallback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var err_2, err_3, session, _a, trk, uuid, ccid;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    _b.trys.push([0, 3, , 4]);\n                    return [4 /*yield*/, mdIface.sessionKeyForget()];\n                case 1:\n                    _b.sent();\n                    return [4 /*yield*/, mdIface.leaveSecureSession()];\n                case 2:\n                    _b.sent();\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_2 = _b.sent();\n                    return [3 /*break*/, 4];\n                case 4: return [4 /*yield*/, mdIface.acquire()];\n                case 5:\n                    _b.sent();\n                    _b.label = 6;\n                case 6:\n                    _b.trys.push([6, 8, , 9]);\n                    return [4 /*yield*/, mdIface.disableNewTrackProtection(1)];\n                case 7:\n                    _b.sent();\n                    return [3 /*break*/, 9];\n                case 8:\n                    err_3 = _b.sent();\n                    return [3 /*break*/, 9];\n                case 9:\n                    session = new netmd_interface_1.MDSession(mdIface, new netmd_interface_1.EKBOpenSource());\n                    return [4 /*yield*/, session.init()];\n                case 10:\n                    _b.sent();\n                    return [4 /*yield*/, session.downloadTrack(track, progressCallback)];\n                case 11:\n                    _a = __read.apply(void 0, [_b.sent(), 3]), trk = _a[0], uuid = _a[1], ccid = _a[2];\n                    return [4 /*yield*/, session.close()];\n                case 12:\n                    _b.sent();\n                    return [4 /*yield*/, mdIface.release()];\n                case 13:\n                    _b.sent();\n                    return [2 /*return*/, [trk, uuid, ccid]];\n            }\n        });\n    });\n}\nexports.download = download;\n//# sourceMappingURL=netmd-commands.js.map","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"0aba6782ae4344385c04.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"7a2cdea617fc7c50ff57.worker.js\");\n};","import { Disc, formatTimeFromFrames, Encoding } from 'netmd-js';\nimport { useSelector, shallowEqual } from 'react-redux';\nimport { RootState } from './redux/store';\nimport { Mutex } from 'async-mutex';\nimport { Theme } from '@material-ui/core';\n\nexport function sleep(ms: number) {\n    return new Promise(resolve => {\n        setTimeout(resolve, ms);\n    });\n}\n\nexport async function sleepWithProgressCallback(ms: number, cb: (perc: number) => void) {\n    let elapsedSecs = 1;\n    let interval = setInterval(() => {\n        elapsedSecs++;\n        cb(Math.min(100, ((elapsedSecs * 1000) / ms) * 100));\n    }, 1000);\n    await sleep(ms);\n    window.clearInterval(interval);\n}\n\nexport function useShallowEqualSelector<TState = RootState, TSelected = unknown>(selector: (state: TState) => TSelected): TSelected {\n    return useSelector(selector, shallowEqual);\n}\n\nexport function debugEnabled() {\n    return process.env.NODE_ENV === 'development';\n}\n\nexport function getPublicPathFor(script: string) {\n    return `${process.env.PUBLIC_URL}/${script}`;\n}\n\nexport function savePreference(key: string, value: unknown) {\n    localStorage.setItem(key, JSON.stringify(value));\n}\n\nexport function loadPreference<T>(key: string, defaultValue: T): T {\n    let res = localStorage.getItem(key);\n    if (res === null) {\n        return defaultValue;\n    } else {\n        try {\n            return JSON.parse(res) as T;\n        } catch (e) {\n            return defaultValue;\n        }\n    }\n}\n\nexport function getAvailableCharsForTrackTitle(trackTitles: string[]) {\n    const maxChars = 1700; // see https://www.minidisc.org/md_toc.html\n    const usedChars = trackTitles.reduce((acc, title) => {\n        return acc + title.length;\n    }, 0);\n    return maxChars - usedChars;\n}\n\nexport function framesToSec(frames: number) {\n    return frames / 512;\n}\n\nexport function sanitizeTitle(title: string) {\n    return title.normalize('NFD').replace(/[^\\x00-\\x7F]/g, '');\n}\n\nconst EncodingName: { [k: number]: string } = {\n    [Encoding.sp]: 'SP',\n    [Encoding.lp2]: 'LP2',\n    [Encoding.lp4]: 'LP4',\n};\n\nexport function getSortedTracks(disc: Disc | null) {\n    let tracks: { index: number; title: string; group: string; duration: string; encoding: string }[] = [];\n    if (disc !== null) {\n        for (let group of disc.groups) {\n            for (let track of group.tracks) {\n                tracks.push({\n                    index: track.index,\n                    title: track.title ?? `Unknown Title`,\n                    group: group.title ?? ``,\n                    encoding: EncodingName[track.encoding],\n                    duration: formatTimeFromFrames(track.duration, false),\n                });\n            }\n        }\n    }\n    tracks.sort((l, r) => l.index - r.index);\n    return tracks;\n}\n\nexport function asyncMutex(target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    // This is meant to be used only with classes having a \"mutex\" instance property\n    const oldValue = descriptor.value;\n    descriptor.value = async function(...args: any) {\n        const mutex = (this as any).mutex as Mutex;\n        const release = await mutex.acquire();\n        try {\n            return await oldValue.apply(this, args);\n        } finally {\n            release();\n        }\n    };\n    return descriptor;\n}\n\nexport function forAnyDesktop(theme: Theme) {\n    return theme.breakpoints.up(600 + theme.spacing(2) * 2);\n}\n\nexport function belowDesktop(theme: Theme) {\n    return theme.breakpoints.down(600 + theme.spacing(2) * 2);\n}\n\nexport function forWideDesktop(theme: Theme) {\n    return theme.breakpoints.up(700 + theme.spacing(2) * 2) + ` and (min-height: 750px)`;\n}\n\ndeclare let process: any;\n","import {\n    openNewDevice,\n    NetMDInterface,\n    Disc,\n    listContent,\n    openPairedDevice,\n    Wireformat,\n    MDTrack,\n    download,\n    getDeviceStatus,\n    DeviceStatus,\n} from 'netmd-js';\nimport { makeGetAsyncPacketIteratorOnWorkerThread } from 'netmd-js/dist/web-encrypt-worker';\nimport { Logger } from 'netmd-js/dist/logger';\nimport { asyncMutex, sanitizeTitle, sleep } from '../utils';\nimport { Mutex } from 'async-mutex';\n\nconst Worker = require('worker-loader!netmd-js/dist/web-encrypt-worker.js'); // eslint-disable-line import/no-webpack-loader-syntax\n\nexport interface NetMDService {\n    mutex: Mutex;\n    getDeviceStatus(): Promise<DeviceStatus>;\n    pair(): Promise<boolean>;\n    connect(): Promise<boolean>;\n    listContent(): Promise<Disc>;\n    getDeviceName(): Promise<string>;\n    finalize(): Promise<void>;\n    renameTrack(index: number, newTitle: string): Promise<void>;\n    renameDisc(newName: string): Promise<void>;\n    deleteTrack(index: number): Promise<void>;\n    moveTrack(src: number, dst: number): Promise<void>;\n    wipeDisc(): Promise<void>;\n    upload(\n        title: string,\n        data: ArrayBuffer,\n        format: Wireformat,\n        progressCallback: (progress: { written: number; encrypted: number; total: number }) => void\n    ): Promise<void>;\n\n    play(): Promise<void>;\n    pause(): Promise<void>;\n    stop(): Promise<void>;\n    next(): Promise<void>;\n    prev(): Promise<void>;\n    gotoTrack(index: number): Promise<void>;\n    getPosition(): Promise<number[] | null>;\n}\n\nexport class NetMDUSBService implements NetMDService {\n    private netmdInterface?: NetMDInterface;\n    private logger?: Logger;\n    public mutex = new Mutex();\n    public statusMonitorTimer: any;\n\n    constructor({ debug = false }: { debug: boolean }) {\n        if (debug) {\n            // Logging a few methods that have been causing issues with some units\n            const _fn = (...args: any) => {\n                if (args && args[0] && args[0].method) {\n                    console.log(...args);\n                }\n            };\n            this.logger = {\n                debug: _fn,\n                info: _fn,\n                warn: _fn,\n                error: _fn,\n                child: () => this.logger!,\n            };\n        }\n    }\n\n    async pair() {\n        let iface = await openNewDevice(navigator.usb, this.logger);\n        if (iface === null) {\n            return false;\n        }\n        this.netmdInterface = iface;\n        return true;\n    }\n\n    async connect() {\n        let iface = await openPairedDevice(navigator.usb, this.logger);\n        if (iface === null) {\n            return false;\n        }\n        this.netmdInterface = iface;\n        return true;\n    }\n\n    @asyncMutex\n    async listContent() {\n        return await listContent(this.netmdInterface!);\n    }\n\n    @asyncMutex\n    async getDeviceStatus() {\n        return await getDeviceStatus(this.netmdInterface!);\n    }\n\n    @asyncMutex\n    async getDeviceName() {\n        return await this.netmdInterface!.netMd.getDeviceName();\n    }\n\n    @asyncMutex\n    async finalize() {\n        await this.netmdInterface!.netMd.finalize();\n    }\n\n    @asyncMutex\n    async renameTrack(index: number, title: string) {\n        // Removing non ascii chars... Sorry, I didn't implement char encoding.\n        title = sanitizeTitle(title);\n        await this.netmdInterface!.cacheTOC();\n        await this.netmdInterface!.setTrackTitle(index, title);\n        await this.netmdInterface!.syncTOC();\n    }\n\n    @asyncMutex\n    async renameDisc(newName: string) {\n        // TODO: This whole function should be moved in netmd-js\n        const oldName = await this.netmdInterface!.getDiscTitle();\n        const oldRawName = await this.netmdInterface!._getDiscTitle();\n        const hasGroups = oldRawName.indexOf('//') >= 0;\n        const hasGroupsAndTitle = oldRawName.startsWith('0;');\n\n        if (newName === oldName) {\n            return;\n        }\n\n        let newNameWithGroups;\n\n        if (hasGroups) {\n            if (hasGroupsAndTitle) {\n                newNameWithGroups = oldRawName.replace(/^0;.*?\\/\\//, newName !== '' ? `0;${newName}//` : ``); // Replace or delete the old title\n            } else {\n                newNameWithGroups = `0;${newName}//${oldRawName}`; // Add the new title\n            }\n        } else {\n            newNameWithGroups = newName;\n        }\n\n        await this.netmdInterface!.cacheTOC();\n        await this.netmdInterface!.setDiscTitle(newNameWithGroups);\n        await this.netmdInterface!.syncTOC();\n    }\n\n    @asyncMutex\n    async deleteTrack(index: number) {\n        await this.netmdInterface!.eraseTrack(index);\n        await sleep(100);\n    }\n\n    @asyncMutex\n    async wipeDisc() {\n        await this.netmdInterface!.eraseDisc();\n    }\n\n    @asyncMutex\n    async moveTrack(src: number, dst: number) {\n        await this.netmdInterface!.moveTrack(src, dst);\n    }\n\n    async upload(\n        title: string,\n        data: ArrayBuffer,\n        format: Wireformat,\n        progressCallback: (progress: { written: number; encrypted: number; total: number }) => void\n    ) {\n        let total = data.byteLength;\n        let written = 0;\n        let encrypted = 0;\n        function updateProgress() {\n            progressCallback({ written, encrypted, total });\n        }\n\n        let w = new Worker();\n\n        let webWorkerAsyncPacketIterator = makeGetAsyncPacketIteratorOnWorkerThread(w, ({ encryptedBytes }) => {\n            encrypted = encryptedBytes;\n            updateProgress();\n        });\n\n        // Removing non ascii chars... Sorry, I didn't implement char encoding.\n        title = sanitizeTitle(title);\n        let mdTrack = new MDTrack(title, format, data, 0x80000, webWorkerAsyncPacketIterator);\n\n        await download(this.netmdInterface!, mdTrack, ({ writtenBytes }) => {\n            written = writtenBytes;\n            updateProgress();\n        });\n\n        w.terminate();\n    }\n\n    @asyncMutex\n    async play() {\n        await this.netmdInterface!.play();\n    }\n    @asyncMutex\n    async pause() {\n        await this.netmdInterface!.pause();\n    }\n    @asyncMutex\n    async stop() {\n        await this.netmdInterface!.stop();\n    }\n    @asyncMutex\n    async next() {\n        await this.netmdInterface!.nextTrack();\n    }\n    @asyncMutex\n    async prev() {\n        await this.netmdInterface!.previousTrack();\n    }\n\n    @asyncMutex\n    async gotoTrack(index: number) {\n        await this.netmdInterface!.gotoTrack(index);\n    }\n\n    @asyncMutex\n    async getPosition() {\n        return await this.netmdInterface!.getPosition();\n    }\n}\n","import { NetMDService } from './netmd';\nimport { AudioExportService } from './audio-export';\nimport { MediaRecorderService } from './mediarecorder';\n\ninterface ServiceRegistry {\n    netmdService?: NetMDService;\n    audioExportService?: AudioExportService;\n    mediaRecorderService?: MediaRecorderService;\n}\n\nconst ServiceRegistry: ServiceRegistry = {};\n\nexport default ServiceRegistry;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface LoadingDialogState {\n    visible: boolean;\n    writtenProgress: number;\n    encryptedProgress: number;\n    totalProgress: number;\n\n    trackTotal: number;\n    trackConverting: number;\n    trackCurrent: number;\n\n    titleCurrent: string;\n    titleConverting: string;\n}\n\nconst initialState: LoadingDialogState = {\n    visible: false,\n    // Current Track Upload\n    writtenProgress: 0,\n    encryptedProgress: 0,\n    totalProgress: 1,\n\n    // Tracks done\n    trackTotal: 1,\n    trackConverting: 0,\n    trackCurrent: 0,\n    titleCurrent: '',\n    titleConverting: '',\n};\n\nexport const slice = createSlice({\n    name: 'uploadDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setWriteProgress: (state, action: PayloadAction<{ written: number; encrypted: number; total: number }>) => {\n            state.encryptedProgress = action.payload.encrypted;\n            state.writtenProgress = action.payload.written;\n            state.totalProgress = action.payload.total;\n        },\n        setTrackProgress: (\n            state,\n            action: PayloadAction<{ total: number; current: number; converting: number; titleCurrent: string; titleConverting: string }>\n        ) => {\n            state.trackTotal = action.payload.total;\n            state.trackCurrent = action.payload.current;\n            state.trackConverting = action.payload.converting;\n            state.titleCurrent = action.payload.titleCurrent;\n            state.titleConverting = action.payload.titleConverting;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface RenameDialogState {\n    visible: boolean;\n    title: string;\n    index: number;\n}\n\nconst initialState: RenameDialogState = {\n    visible: false,\n    title: '',\n    index: -1,\n};\n\nexport const slice = createSlice({\n    name: 'renameDialog',\n    initialState,\n    reducers: {\n        setVisible: (state: RenameDialogState, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setCurrentName: (state: RenameDialogState, action: PayloadAction<string>) => {\n            state.title = action.payload;\n        },\n        setIndex: (state: RenameDialogState, action: PayloadAction<number>) => {\n            state.index = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface ErrorDialogState {\n    visible: boolean;\n    error: string;\n}\n\nconst initialState: ErrorDialogState = {\n    visible: false,\n    error: ``,\n};\n\nconst slice = createSlice({\n    name: 'errorDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setErrorMessage: (state, action: PayloadAction<string>) => {\n            state.error = `${action.payload}`;\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport const initialState = {\n    visible: false,\n    dismissed: false, // This will prevent showing the dialog during the same session\n};\n\nconst slice = createSlice({\n    name: 'panicDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        dismiss: (state, action: PayloadAction<void>) => {\n            state.visible = false;\n            state.dismissed = true;\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\nimport { savePreference, loadPreference } from '../utils';\n\nexport type TitleSourceType = 'file' | 'media';\nexport type TitleFormatType = 'title' | 'album-title' | 'artist-title' | 'artist-album-title';\n\nexport interface ConvertDialogFeature {\n    visible: boolean;\n    format: string;\n    titleSource: TitleSourceType;\n    titleFormat: TitleFormatType;\n}\n\nconst initialState: ConvertDialogFeature = {\n    visible: false,\n    format: `LP2`,\n    titleSource: loadPreference('trackTitleSource', 'file') as TitleSourceType,\n    titleFormat: loadPreference('trackTitleFormat', 'title') as TitleFormatType,\n};\n\nconst slice = createSlice({\n    name: 'convertDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setFormat: (state, action: PayloadAction<string>) => {\n            state.format = action.payload;\n        },\n        setTitleSource: (state, action: PayloadAction<TitleSourceType>) => {\n            state.titleSource = action.payload;\n            savePreference('trackTitleSource', state.titleSource);\n        },\n        setTitleFormat: (state, action: PayloadAction<TitleFormatType>) => {\n            state.titleFormat = action.payload;\n            savePreference('trackTitleFormat', state.titleFormat);\n        },\n    },\n});\n\nexport const { actions, reducer } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface DumpDialogState {\n    visible: boolean;\n    inputDeviceId: string;\n}\n\nconst initialState: DumpDialogState = {\n    visible: false,\n    inputDeviceId: '',\n};\n\nexport const slice = createSlice({\n    name: 'dumpDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setInputDeviceId: (state, action: PayloadAction<string>) => {\n            state.inputDeviceId = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface RecordingDialogState {\n    visible: boolean;\n\n    trackTotal: number;\n    trackDone: number;\n    trackCurrent: number;\n\n    titleCurrent: string;\n}\n\nconst initialState: RecordingDialogState = {\n    visible: false,\n\n    trackTotal: 1,\n    trackDone: 0,\n    trackCurrent: 0,\n\n    titleCurrent: '',\n\n    // visible: true,\n    // trackTotal: 4,\n    // trackDone: 1,\n    // trackCurrent: 25,\n\n    // titleCurrent: 'Seconda traccia',\n};\n\nexport const slice = createSlice({\n    name: 'recordDialog',\n    initialState,\n    reducers: {\n        setVisible: (state, action: PayloadAction<boolean>) => {\n            state.visible = action.payload;\n        },\n        setProgress: (\n            state,\n            action: PayloadAction<{ trackTotal: number; trackDone: number; trackCurrent: number; titleCurrent: string }>\n        ) => {\n            state.trackTotal = action.payload.trackTotal;\n            state.trackDone = action.payload.trackDone;\n            state.trackCurrent = action.payload.trackCurrent;\n            state.titleCurrent = action.payload.titleCurrent;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\nimport { savePreference, loadPreference } from '../utils';\n\ntype Views = 'WELCOME' | 'MAIN';\n\nexport interface AppState {\n    mainView: Views;\n    loading: boolean;\n    pairingFailed: boolean;\n    pairingMessage: string;\n    browserSupported: boolean;\n    darkMode: boolean;\n    aboutDialogVisible: boolean;\n}\n\nconst initialState: AppState = {\n    mainView: 'WELCOME',\n    loading: false,\n    pairingFailed: false,\n    pairingMessage: ``,\n    browserSupported: true,\n    darkMode: loadPreference('darkMode', false),\n    aboutDialogVisible: false,\n};\n\nexport const slice = createSlice({\n    name: 'app',\n    initialState,\n    reducers: {\n        setState: (state, action: PayloadAction<Views>) => {\n            state.mainView = action.payload;\n        },\n        setLoading: (state, action: PayloadAction<boolean>) => {\n            state.loading = action.payload;\n        },\n        setPairingFailed: (state, action: PayloadAction<boolean>) => {\n            state.pairingFailed = action.payload;\n        },\n        setPairingMessage: (state, action: PayloadAction<string>) => {\n            state.pairingMessage = action.payload;\n        },\n        setBrowserSupported: (state, action: PayloadAction<boolean>) => {\n            state.browserSupported = action.payload;\n        },\n        setDarkMode: (state, action: PayloadAction<boolean>) => {\n            state.darkMode = action.payload;\n            savePreference('darkMode', state.darkMode);\n        },\n        showAboutDialog: (state, action: PayloadAction<boolean>) => {\n            state.aboutDialogVisible = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { Disc, DeviceStatus } from 'netmd-js';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { enableBatching } from 'redux-batched-actions';\n\nexport interface MainState {\n    disc: Disc | null;\n    deviceName: string;\n    deviceStatus: DeviceStatus | null;\n}\n\nconst initialState: MainState = {\n    disc: null,\n    deviceName: '',\n    deviceStatus: null,\n};\n\nexport const slice = createSlice({\n    name: 'main',\n    initialState,\n    reducers: {\n        setDisc: (state, action: PayloadAction<Disc>) => {\n            state.disc = action.payload;\n        },\n        setDeviceName: (state, action: PayloadAction<string>) => {\n            state.deviceName = action.payload;\n        },\n        setDeviceStatus: (state, action: PayloadAction<DeviceStatus | null>) => {\n            state.deviceStatus = action.payload;\n        },\n    },\n});\n\nexport const { reducer, actions } = slice;\nexport default enableBatching(reducer);\n","import { configureStore, getDefaultMiddleware, Middleware, combineReducers } from '@reduxjs/toolkit';\nimport uploadDialog from './upload-dialog-feature';\nimport renameDialog from './rename-dialog-feature';\nimport errorDialog from './error-dialog-feature';\nimport panicDialog, { actions as panicDialogActions } from './panic-dialog-feature';\nimport convertDialog from './convert-dialog-feature';\nimport dumpDialog from './dump-dialog-feature';\nimport recordDialog from './record-dialog-feature';\nimport appState, { actions as appActions } from './app-feature';\nimport main from './main-feature';\n\nconst errorCatcher: Middleware = store => next => async action => {\n    try {\n        await next(action);\n    } catch (e) {\n        console.error(e);\n        next(panicDialogActions.setVisible(true));\n    }\n};\n\nlet reducer = combineReducers({\n    renameDialog,\n    uploadDialog,\n    errorDialog,\n    panicDialog,\n    convertDialog,\n    dumpDialog,\n    recordDialog,\n    appState,\n    main,\n});\n\nconst resetStateAction = appActions.setState.toString();\nconst resetStatePayoload = 'WELCOME';\nconst resetStateReducer: typeof reducer = function(...args) {\n    const [state, action] = args;\n    if (action.type === resetStateAction && action.payload === resetStatePayoload) {\n        return initialState;\n    }\n    return reducer(...args);\n};\n\nexport const store = configureStore({\n    reducer: resetStateReducer,\n    middleware: [errorCatcher, ...getDefaultMiddleware()],\n});\n\nconst initialState = Object.freeze(store.getState());\n\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppDispatch = typeof store.dispatch;\n","import { batchActions } from 'redux-batched-actions';\nimport { AppDispatch, RootState } from './store';\nimport { actions as uploadDialogActions } from './upload-dialog-feature';\nimport { actions as renameDialogActions } from './rename-dialog-feature';\nimport { actions as errorDialogAction } from './error-dialog-feature';\nimport { actions as recordDialogAction } from './record-dialog-feature';\nimport { actions as appStateActions } from './app-feature';\nimport { actions as mainActions } from './main-feature';\nimport serviceRegistry from '../services/registry';\nimport { Wireformat, getTracks } from 'netmd-js';\nimport { AnyAction } from '@reduxjs/toolkit';\nimport { getAvailableCharsForTrackTitle, framesToSec, sleepWithProgressCallback, sleep } from '../utils';\nimport jsmediatags from 'jsmediatags';\nimport { TitleSourceType, TitleFormatType } from './convert-dialog-feature';\n\nexport function control(action: 'play' | 'stop' | 'next' | 'prev' | 'goto', params?: unknown) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        switch (action) {\n            case 'play':\n                await serviceRegistry.netmdService!.play();\n                break;\n            case 'stop':\n                await serviceRegistry.netmdService!.stop();\n                break;\n            case 'next':\n                await serviceRegistry.netmdService!.next();\n                break;\n            case 'prev':\n                await serviceRegistry.netmdService!.prev();\n                break;\n            case 'goto':\n                if (params && typeof params === 'number' && params >= 0) {\n                    await serviceRegistry.netmdService!.gotoTrack(params);\n                }\n                break;\n        }\n        // CAVEAT: change-track might take a up to a few seconds to complete.\n        // We wait 500ms and let the monitor do further updates\n        await sleep(500);\n        try {\n            let deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n            dispatch(mainActions.setDeviceStatus(deviceStatus));\n        } catch (e) {\n            console.log('control: Cannot get device status');\n        }\n    };\n}\n\nexport function pair() {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        dispatch(appStateActions.setPairingFailed(false));\n\n        await serviceRegistry.audioExportService!.init();\n\n        try {\n            let connected = await serviceRegistry.netmdService!.connect();\n            if (connected) {\n                dispatch(appStateActions.setState('MAIN'));\n                return;\n            }\n        } catch (err) {\n            console.error(err);\n            // In case of error, just log and try to pair\n        }\n\n        try {\n            let paired = await serviceRegistry.netmdService!.pair();\n            if (paired) {\n                dispatch(appStateActions.setState('MAIN'));\n                return;\n            }\n            dispatch(batchActions([appStateActions.setPairingMessage(`Connection Failed`), appStateActions.setPairingFailed(true)]));\n        } catch (err) {\n            console.error(err);\n            let message = (err as Error).message;\n            dispatch(batchActions([appStateActions.setPairingMessage(message), appStateActions.setPairingFailed(true)]));\n        }\n    };\n}\n\nexport function listContent() {\n    return async function(dispatch: AppDispatch) {\n        // Issue loading\n        dispatch(appStateActions.setLoading(true));\n        let disc = await serviceRegistry.netmdService!.listContent();\n        let deviceName = await serviceRegistry.netmdService!.getDeviceName();\n        let deviceStatus = null;\n        try {\n            deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n        } catch (e) {\n            console.log('listContent: Cannot get device status');\n        }\n        dispatch(\n            batchActions([\n                mainActions.setDisc(disc),\n                mainActions.setDeviceName(deviceName),\n                mainActions.setDeviceStatus(deviceStatus),\n                appStateActions.setLoading(false),\n            ])\n        );\n    };\n}\n\nexport function renameTrack({ index, newName }: { index: number; newName: string }) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        dispatch(renameDialogActions.setVisible(false));\n        try {\n            await netmdService!.renameTrack(index, newName);\n        } catch (err) {\n            console.error(err);\n            dispatch(batchActions([errorDialogAction.setVisible(true), errorDialogAction.setErrorMessage(`Rename failed.`)]));\n        }\n        listContent()(dispatch);\n    };\n}\n\nexport function renameDisc({ newName }: { newName: string }) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        await netmdService!.renameDisc(newName);\n        dispatch(renameDialogActions.setVisible(false));\n        listContent()(dispatch);\n    };\n}\n\nexport function deleteTracks(indexes: number[]) {\n    return async function(dispatch: AppDispatch) {\n        const confirmation = window.confirm(\n            `Proceed with Delete Track${indexes.length !== 1 ? 's' : ''}? This operation cannot be undone.`\n        );\n        if (!confirmation) {\n            return;\n        }\n        const { netmdService } = serviceRegistry;\n        dispatch(appStateActions.setLoading(true));\n        indexes = indexes.sort();\n        indexes.reverse();\n        for (let index of indexes) {\n            await netmdService!.deleteTrack(index);\n        }\n        listContent()(dispatch);\n    };\n}\n\nexport function wipeDisc() {\n    return async function(dispatch: AppDispatch) {\n        const confirmation = window.confirm(`Proceed with Wipe Disc? This operation cannot be undone.`);\n        if (!confirmation) {\n            return;\n        }\n        const { netmdService } = serviceRegistry;\n        dispatch(appStateActions.setLoading(true));\n        await netmdService!.wipeDisc();\n        listContent()(dispatch);\n    };\n}\n\nexport function moveTrack(srcIndex: number, destIndex: number) {\n    return async function(dispatch: AppDispatch) {\n        const { netmdService } = serviceRegistry;\n        await netmdService!.moveTrack(srcIndex, destIndex);\n        listContent()(dispatch);\n    };\n}\n\nexport function recordTracks(indexes: number[], deviceId: string) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        dispatch(\n            batchActions([\n                recordDialogAction.setVisible(true),\n                recordDialogAction.setProgress({ trackTotal: indexes.length, trackDone: 0, trackCurrent: 0, titleCurrent: '' }),\n            ])\n        );\n\n        let disc = getState().main.disc;\n        let tracks = getTracks(disc!).filter(t => indexes.indexOf(t.index) >= 0);\n\n        const { netmdService, mediaRecorderService } = serviceRegistry;\n        await serviceRegistry.netmdService!.stop();\n\n        for (let [i, track] of tracks.entries()) {\n            dispatch(\n                recordDialogAction.setProgress({\n                    trackTotal: tracks.length,\n                    trackDone: i,\n                    trackCurrent: -1,\n                    titleCurrent: track.title ?? '',\n                })\n            );\n\n            // Wait for the track to be ready to play from 0:00\n            await netmdService!.gotoTrack(track.index);\n            await netmdService!.play();\n            console.log('Waiting for track to be ready to play');\n            let position = await netmdService!.getPosition();\n            let expected = [track.index, 0, 0, 1];\n            while (position === null || !expected.every((_, i) => expected[i] === position![i])) {\n                await sleep(250);\n                position = await netmdService!.getPosition();\n            }\n            await netmdService!.pause();\n            await netmdService?.gotoTrack(track.index);\n            console.log('Track is ready to play');\n\n            // Start recording and play track\n            await mediaRecorderService?.initStream(deviceId);\n            await mediaRecorderService?.startRecording();\n            await netmdService!.play();\n\n            // Wait until track is finished\n            let durationInSec = framesToSec(track.duration);\n            // await sleep(durationInSec * 1000);\n            await sleepWithProgressCallback(durationInSec * 1000, (perc: number) => {\n                dispatch(\n                    recordDialogAction.setProgress({\n                        trackTotal: tracks.length,\n                        trackDone: i,\n                        trackCurrent: perc,\n                        titleCurrent: track.title ?? '',\n                    })\n                );\n            });\n\n            // Stop recording and download the wav\n            await mediaRecorderService?.stopRecording();\n            mediaRecorderService?.downloadRecorded(`${track.title}`);\n\n            await mediaRecorderService?.closeStream();\n        }\n\n        await netmdService!.stop();\n        dispatch(recordDialogAction.setVisible(false));\n    };\n}\n\nexport const WireformatDict: { [k: string]: Wireformat } = {\n    SP: Wireformat.pcm,\n    LP2: Wireformat.lp2,\n    LP105: Wireformat.l105kbps,\n    LP4: Wireformat.lp4,\n};\n\nasync function getTrackNameFromMediaTags(file: File, titleFormat: TitleFormatType) {\n    const fileData = await file.arrayBuffer();\n    return await new Promise<string>((resolve, reject) => {\n        jsmediatags.read(new Blob([fileData]), {\n            onSuccess: data => {\n                const title = data.tags.title ?? 'Unknown Title';\n                const artist = data.tags.artist ?? 'Unknown Artist';\n                const album = data.tags.album ?? 'Unknown Album';\n                switch (titleFormat) {\n                    case 'title': {\n                        resolve(title);\n                        break;\n                    }\n                    case 'artist-title': {\n                        resolve(`${artist} - ${title}`);\n                        break;\n                    }\n                    case 'album-title': {\n                        resolve(`${album} - ${title}`);\n                        break;\n                    }\n                    case 'artist-album-title': {\n                        resolve(`${artist} - ${album} - ${title}`);\n                        break;\n                    }\n                }\n            },\n            onError: error => {\n                reject(error);\n            },\n        });\n    });\n}\n\nexport function convertAndUpload(files: File[], format: string, titleSource: TitleSourceType, titleFormat: TitleFormatType) {\n    return async function(dispatch: AppDispatch, getState: () => RootState) {\n        const { audioExportService, netmdService } = serviceRegistry;\n        const wireformat = WireformatDict[format];\n\n        await netmdService?.stop();\n        dispatch(uploadDialogActions.setVisible(true));\n\n        const updateProgressCallback = ({ written, encrypted, total }: { written: number; encrypted: number; total: number }) => {\n            dispatch(uploadDialogActions.setWriteProgress({ written, encrypted, total }));\n        };\n\n        let trackUpdate: {\n            current: number;\n            converting: number;\n            total: number;\n            titleCurrent: string;\n            titleConverting: string;\n        } = {\n            current: 0,\n            converting: 0,\n            total: files.length,\n            titleCurrent: '',\n            titleConverting: '',\n        };\n        const updateTrack = () => {\n            dispatch(uploadDialogActions.setTrackProgress(trackUpdate));\n        };\n\n        let conversionIterator = async function*(files: File[]) {\n            let converted: Promise<{ file: File; data: ArrayBuffer }>[] = [];\n\n            let i = 0;\n            function convertNext() {\n                if (i === files.length) {\n                    trackUpdate.converting = i;\n                    trackUpdate.titleConverting = ``;\n                    updateTrack();\n                    return;\n                }\n\n                let f = files[i];\n                trackUpdate.converting = i;\n                trackUpdate.titleConverting = f.name;\n                updateTrack();\n                i++;\n\n                converted.push(\n                    new Promise(async (resolve, reject) => {\n                        let data: ArrayBuffer;\n                        try {\n                            await audioExportService!.prepare(f);\n                            data = await audioExportService!.export({ format });\n                            convertNext();\n                            resolve({ file: f, data: data });\n                        } catch (err) {\n                            error = err;\n                            errorMessage = `${f.name}: Unsupported or unrecognized format`;\n                            reject(err);\n                        }\n                    })\n                );\n            }\n            convertNext();\n\n            let j = 0;\n            while (j < converted.length) {\n                yield await converted[j];\n                delete converted[j];\n                j++;\n            }\n        };\n\n        let disc = getState().main.disc;\n        let maxTitleLength = disc ? getAvailableCharsForTrackTitle(getTracks(disc).map(track => track.title || ``)) : -1;\n        maxTitleLength = Math.floor(maxTitleLength / files.length);\n\n        let error: any;\n        let errorMessage = ``;\n        let i = 1;\n        for await (let item of conversionIterator(files)) {\n            const { file, data } = item;\n\n            let title = file.name;\n            if (titleSource === 'media') {\n                try {\n                    title = await getTrackNameFromMediaTags(file, titleFormat);\n                } catch (err) {\n                    console.error(err);\n                }\n            }\n\n            const extStartIndex = title.lastIndexOf('.');\n            if (extStartIndex > 0) {\n                title = title.substring(0, extStartIndex);\n            }\n            if (maxTitleLength > -1) {\n                title = title.substring(0, maxTitleLength);\n            }\n\n            trackUpdate.current = i++;\n            trackUpdate.titleCurrent = title;\n            updateTrack();\n            updateProgressCallback({ written: 0, encrypted: 0, total: 100 });\n            try {\n                await netmdService?.upload(title, data, wireformat, updateProgressCallback);\n            } catch (err) {\n                error = err;\n                errorMessage = `${file.name}: Error uploading to device`;\n                break;\n            }\n        }\n\n        let actionToDispatch: AnyAction[] = [uploadDialogActions.setVisible(false)];\n\n        if (error) {\n            console.error(error);\n            actionToDispatch = actionToDispatch.concat([\n                errorDialogAction.setVisible(true),\n                errorDialogAction.setErrorMessage(errorMessage),\n            ]);\n        }\n\n        dispatch(batchActions(actionToDispatch));\n        listContent()(dispatch);\n    };\n}\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as appActions } from '../redux/app-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport Link from '@material-ui/core/Link';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const AboutDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let visible = useShallowEqualSelector(state => state.appState.aboutDialogVisible);\n\n    const handleClose = () => {\n        dispatch(appActions.showAboutDialog(false));\n    };\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"about-dialog-slide-title\"\n        >\n            <DialogTitle id=\"about-dialog-slide-title\">About Web MiniDisc</DialogTitle>\n            <DialogContent>\n                <DialogContentText>Web MiniDisc has been made possible by</DialogContentText>\n                <ul>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://www.ffmpeg.org/\" target=\"_blank\">\n                            FFmpeg\n                        </Link>{' '}\n                        and{' '}\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/ffmpegjs/FFmpeg\" target=\"_blank\">\n                            ffmpegjs\n                        </Link>\n                        , to read your audio files (wav, mp3, ogg, mp4, etc...).\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/dcherednik/atracdenc/\" target=\"_blank\">\n                            Atracdenc\n                        </Link>\n                        , to support atrac3 encoding (lp2, lp4 audio formats).\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://emscripten.org/\" target=\"_blank\">\n                            Emscripten\n                        </Link>\n                        , to run both FFmpeg and Atracdenc in the browser.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/cybercase/netmd-js\" target=\"_blank\">\n                            netmd-js\n                        </Link>\n                        , to send commands to NetMD devices using Javascript.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://github.com/glaubitz/linux-minidisc\" target=\"_blank\">\n                            linux-minidisc\n                        </Link>\n                        , to make the netmd-js project possible.\n                    </li>\n                    <li>\n                        <Link rel=\"noopener noreferrer\" href=\"https://material-ui.com/\" target=\"_blank\">\n                            material-ui\n                        </Link>\n                        , to build the user interface.\n                    </li>\n                </ul>\n                <DialogContentText>Attribution</DialogContentText>\n                <ul>\n                    <li>\n                        MiniDisc logo from{' '}\n                        <Link rel=\"noopener noreferrer\" href=\"https://en.wikipedia.org/wiki/MiniDisc\" target=\"_blank\">\n                            https://en.wikipedia.org/wiki/MiniDisc\n                        </Link>\n                    </li>\n                    <li>\n                        MiniDisc icon from{' '}\n                        <Link\n                            rel=\"noopener noreferrer\"\n                            href=\"https://www.deviantart.com/blinkybill/art/Sony-MiniDisc-Plastic-Icon-473812540\"\n                            target=\"_blank\"\n                        >\n                            http://fav.me/d7u3g3g\n                        </Link>\n                    </li>\n                </ul>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Close</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { batchActions } from 'redux-batched-actions';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\n\nimport { wipeDisc, listContent } from '../redux/actions';\nimport { actions as appActions } from '../redux/app-feature';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { useShallowEqualSelector } from '../utils';\nimport Link from '@material-ui/core/Link';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport RefreshIcon from '@material-ui/icons/Refresh';\nimport EditIcon from '@material-ui/icons/Edit';\nimport GitHubIcon from '@material-ui/icons/GitHub';\nimport DeleteForeverIcon from '@material-ui/icons/DeleteForever';\nimport ExitToAppIcon from '@material-ui/icons/ExitToApp';\nimport InfoIcon from '@material-ui/icons/Info';\nimport ToggleOffIcon from '@material-ui/icons/ToggleOff';\nimport ToggleOnIcon from '@material-ui/icons/ToggleOn';\n\nconst useStyles = makeStyles(theme => ({\n    listItemIcon: {\n        minWidth: theme.spacing(5),\n    },\n}));\n\nexport const TopMenu = function() {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n\n    let { mainView, darkMode } = useShallowEqualSelector(state => state.appState);\n    let discTitle = useShallowEqualSelector(state => state.main.disc?.title ?? ``);\n\n    const githubLinkRef = React.useRef<null | HTMLAnchorElement>(null);\n    const [menuAnchorEl, setMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const menuOpen = Boolean(menuAnchorEl);\n\n    const handleMenuOpen = useCallback(\n        (event: React.MouseEvent<HTMLElement>) => {\n            setMenuAnchorEl(event.currentTarget);\n        },\n        [setMenuAnchorEl]\n    );\n\n    const handleDarkMode = useCallback(() => {\n        dispatch(appActions.setDarkMode(!darkMode));\n    }, [dispatch, darkMode]);\n\n    const handleMenuClose = useCallback(() => {\n        setMenuAnchorEl(null);\n    }, [setMenuAnchorEl]);\n\n    const handleWipeDisc = useCallback(() => {\n        dispatch(wipeDisc());\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleRefresh = useCallback(() => {\n        dispatch(listContent());\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleRenameDisc = useCallback(() => {\n        dispatch(\n            batchActions([\n                renameDialogActions.setVisible(true),\n                renameDialogActions.setCurrentName(discTitle),\n                renameDialogActions.setIndex(-1),\n            ])\n        );\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleExit = useCallback(() => {\n        dispatch(appActions.setState('WELCOME'));\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleShowAbout = useCallback(() => {\n        dispatch(appActions.showAboutDialog(true));\n        handleMenuClose();\n    }, [dispatch, handleMenuClose]);\n\n    const handleGithubLink = useCallback(\n        (event: React.MouseEvent<HTMLElement>) => {\n            event.stopPropagation();\n            if (event.target !== githubLinkRef.current) {\n                // Prevent opening the link twice\n                githubLinkRef.current?.click();\n            }\n            handleMenuClose();\n        },\n        [handleMenuClose]\n    );\n\n    const menuItems = [];\n    if (mainView === 'MAIN') {\n        menuItems.push(\n            <MenuItem key=\"update\" onClick={handleRefresh}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <RefreshIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Reload TOC</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"title\" onClick={handleRenameDisc}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <EditIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Rename Disc</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"wipe\" onClick={handleWipeDisc}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <DeleteForeverIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Wipe Disc</ListItemText>\n            </MenuItem>\n        );\n        menuItems.push(\n            <MenuItem key=\"exit\" onClick={handleExit}>\n                <ListItemIcon className={classes.listItemIcon}>\n                    <ExitToAppIcon fontSize=\"small\" />\n                </ListItemIcon>\n                <ListItemText>Exit</ListItemText>\n            </MenuItem>\n        );\n    }\n    menuItems.push(\n        <MenuItem key=\"darkMode\" onClick={handleDarkMode}>\n            <ListItemIcon className={classes.listItemIcon}>\n                {/* <Switch name=\"darkModeSwitch\" inputProps={{ 'aria-label': 'Dark Mode switch' }} size=\"small\" /> */}\n                {darkMode ? <ToggleOnIcon fontSize=\"small\" /> : <ToggleOffIcon fontSize=\"small\" />}\n            </ListItemIcon>\n            <ListItemText>Dark Mode</ListItemText>\n        </MenuItem>\n    );\n    menuItems.push(\n        <MenuItem key=\"about\" onClick={handleShowAbout}>\n            <ListItemIcon className={classes.listItemIcon}>\n                <InfoIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText>About</ListItemText>\n        </MenuItem>\n    );\n    menuItems.push(\n        <MenuItem key=\"github\" onClick={handleGithubLink}>\n            <ListItemIcon className={classes.listItemIcon}>\n                <GitHubIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText>\n                <Link\n                    rel=\"noopener noreferrer\"\n                    href=\"https://github.com/cybercase/webminidisc\"\n                    target=\"_blank\"\n                    ref={githubLinkRef}\n                    onClick={handleGithubLink}\n                >\n                    Fork me on GitHub\n                </Link>\n            </ListItemText>\n        </MenuItem>\n    );\n\n    return (\n        <React.Fragment>\n            <IconButton aria-label=\"actions\" aria-controls=\"actions-menu\" aria-haspopup=\"true\" onClick={handleMenuOpen}>\n                <MoreVertIcon />\n            </IconButton>\n            <Menu id=\"actions-menu\" anchorEl={menuAnchorEl} keepMounted open={menuOpen} onClose={handleMenuClose}>\n                {menuItems}\n            </Menu>\n        </React.Fragment>\n    );\n};\n","import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { pair } from '../redux/actions';\n\nimport { useShallowEqualSelector } from '../utils';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport Box from '@material-ui/core/Box';\nimport Link from '@material-ui/core/Link';\n\nimport { AboutDialog } from './about-dialog';\nimport { TopMenu } from './topmenu';\nimport ChromeIconPath from '../images/chrome-icon.svg';\n\nconst useStyles = makeStyles(theme => ({\n    main: {\n        position: 'relative',\n        flex: '1 1 auto',\n        display: 'flex',\n        justifyContent: 'center',\n        flexDirection: 'column',\n        alignItems: 'center',\n    },\n    button: {\n        marginTop: theme.spacing(3),\n        minWidth: 150,\n    },\n    spacing: {\n        marginTop: theme.spacing(1),\n    },\n    chromeLogo: {\n        marginTop: theme.spacing(1),\n        width: 96,\n        height: 96,\n    },\n    why: {\n        alignSelf: 'flex-start',\n        marginTop: theme.spacing(3),\n    },\n    headBox: {\n        display: 'flex',\n        justifyContent: 'space-between',\n    },\n}));\n\nexport const Welcome = (props: {}) => {\n    const classes = useStyles();\n\n    const dispatch = useDispatch();\n    const { browserSupported, pairingFailed, pairingMessage } = useShallowEqualSelector(state => state.appState);\n    if (pairingMessage.toLowerCase().match(/denied/)) {\n        // show linux instructions\n    }\n    // Access denied.\n\n    const [showWhyUnsupported, setWhyUnsupported] = useState(false);\n    const handleLearnWhy = (event: React.SyntheticEvent) => {\n        event.preventDefault();\n        setWhyUnsupported(true);\n    };\n\n    return (\n        <React.Fragment>\n            <Box className={classes.headBox}>\n                <Typography component=\"h1\" variant=\"h4\">\n                    Web MiniDisc\n                </Typography>\n                <TopMenu />\n            </Box>\n            <Typography component=\"h2\" variant=\"body2\">\n                Brings NetMD Devices to the Web\n            </Typography>\n            <Box className={classes.main}>\n                {browserSupported ? (\n                    <React.Fragment>\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            Press the button to connect to a NetMD device\n                        </Typography>\n\n                        <Button variant=\"contained\" color=\"primary\" onClick={() => dispatch(pair())} className={classes.button}>\n                            Connect\n                        </Button>\n\n                        <FormControl error={true} className={classes.spacing} style={{ visibility: pairingFailed ? 'visible' : 'hidden' }}>\n                            <FormHelperText>{pairingMessage}</FormHelperText>\n                        </FormControl>\n                    </React.Fragment>\n                ) : (\n                    <React.Fragment>\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            This Web browser is not supported.&nbsp;\n                            <Link rel=\"noopener noreferrer\" href=\"#\" onClick={handleLearnWhy}>\n                                Learn Why\n                            </Link>\n                        </Typography>\n\n                        <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://www.google.com/chrome/\">\n                            <img alt=\"Chrome Logo\" src={ChromeIconPath} className={classes.chromeLogo} />\n                        </Link>\n\n                        <Typography component=\"h2\" variant=\"subtitle1\" align=\"center\" className={classes.spacing}>\n                            Try using{' '}\n                            <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://www.google.com/chrome/\">\n                                Chrome\n                            </Link>{' '}\n                            instead\n                        </Typography>\n\n                        {showWhyUnsupported ? (\n                            <>\n                                <Typography component=\"p\" variant=\"body2\" className={classes.why}>\n                                    Web MiniDisc requires a browser that supports both{' '}\n                                    <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://wicg.github.io/webusb/\">\n                                        WebUSB\n                                    </Link>{' '}\n                                    and{' '}\n                                    <Link rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://webassembly.org/\">\n                                        WebAssembly\n                                    </Link>\n                                    .\n                                </Typography>\n                                <ul>\n                                    <li>WebUSB is needed to control the NetMD device via the USB connection to your computer.</li>\n                                    <li>WebAssembly is used to convert the music to a MiniDisc compatible format</li>\n                                </ul>\n                            </>\n                        ) : null}\n                    </React.Fragment>\n                )}\n            </Box>\n            <AboutDialog />\n        </React.Fragment>\n    );\n};\n","import React from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { renameTrack, renameDisc } from '../redux/actions';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport TextField from '@material-ui/core/TextField';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const RenameDialog = (props: {}) => {\n    let dispatch = useDispatch();\n\n    let renameDialogVisible = useShallowEqualSelector(state => state.renameDialog.visible);\n    let renameDialogTitle = useShallowEqualSelector(state => state.renameDialog.title);\n    let renameDialogIndex = useShallowEqualSelector(state => state.renameDialog.index);\n\n    const what = renameDialogIndex < 0 ? `Disc` : `Track`;\n\n    const handleCancelRename = () => {\n        dispatch(renameDialogActions.setVisible(false));\n    };\n\n    const handleDoRename = () => {\n        if (renameDialogIndex < 0) {\n            dispatch(renameDisc({ newName: renameDialogTitle }));\n        } else {\n            dispatch(renameTrack({ index: renameDialogIndex, newName: renameDialogTitle }));\n        }\n    };\n\n    return (\n        <Dialog\n            open={renameDialogVisible}\n            onClose={handleCancelRename}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"rename-dialog-title\"\n        >\n            <DialogTitle id=\"rename-dialog-title\">Rename {what}</DialogTitle>\n            <DialogContent>\n                <TextField\n                    autoFocus\n                    id=\"name\"\n                    label={`${what} Name`}\n                    type=\"text\"\n                    fullWidth\n                    value={renameDialogTitle}\n                    onKeyDown={event => {\n                        event.key === `Enter` && handleDoRename();\n                    }}\n                    onChange={event => {\n                        dispatch(renameDialogActions.setCurrentName(event.target.value.substring(0, 120))); // MAX title length\n                    }}\n                />\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleCancelRename}>Cancel</Button>\n                <Button color={'primary'} onClick={handleDoRename}>\n                    Rename\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React from 'react';\nimport { useShallowEqualSelector } from '../utils';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport Box from '@material-ui/core/Box';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst useStyles = makeStyles(theme => ({\n    progressPerc: {\n        marginTop: theme.spacing(1),\n    },\n    progressBar: {\n        marginTop: theme.spacing(3),\n    },\n    uploadLabel: {\n        marginTop: theme.spacing(3),\n    },\n}));\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const UploadDialog = (props: {}) => {\n    const classes = useStyles();\n\n    let {\n        visible,\n        writtenProgress,\n        encryptedProgress,\n        totalProgress,\n\n        trackTotal,\n        trackCurrent,\n        trackConverting,\n        titleCurrent,\n        titleConverting,\n    } = useShallowEqualSelector(state => state.uploadDialog);\n\n    let progressValue = Math.floor((writtenProgress / totalProgress) * 100);\n    let bufferValue = Math.floor((encryptedProgress / totalProgress) * 100);\n    let convertedValue = Math.floor((trackConverting / trackTotal) * 100);\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"alert-dialog-slide-title\"\n            aria-describedby=\"alert-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Recording...</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"alert-dialog-slide-description\">\n                    {convertedValue === 100 && trackConverting === trackTotal\n                        ? `Conversion completed`\n                        : `Converting ${trackConverting + 1} of ${trackTotal}: ${titleConverting}`}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant={convertedValue === 0 ? 'indeterminate' : 'determinate'}\n                    color=\"primary\"\n                    value={convertedValue}\n                />\n                <Box className={classes.progressPerc}>{convertedValue}%</Box>\n\n                <DialogContentText id=\"alert-dialog-slide-description\" className={classes.uploadLabel}>\n                    Uploading {trackCurrent} of {trackTotal}: {titleCurrent}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant=\"buffer\"\n                    color=\"secondary\"\n                    value={progressValue}\n                    valueBuffer={bufferValue}\n                />\n                <Box className={classes.progressPerc}>{progressValue}%</Box>\n            </DialogContent>\n            <DialogActions></DialogActions>\n        </Dialog>\n    );\n};\n","import React from 'react';\nimport { useShallowEqualSelector } from '../utils';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport Box from '@material-ui/core/Box';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst useStyles = makeStyles(theme => ({\n    progressPerc: {\n        marginTop: theme.spacing(1),\n    },\n    progressBar: {\n        marginTop: theme.spacing(3),\n    },\n}));\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const RecordDialog = (props: {}) => {\n    const classes = useStyles();\n\n    let { visible, trackTotal, trackDone, trackCurrent, titleCurrent } = useShallowEqualSelector(state => state.recordDialog);\n\n    let progressValue = Math.round(trackCurrent);\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"record-dialog-slide-title\"\n            aria-describedby=\"record-dialog-slide-description\"\n        >\n            <DialogTitle id=\"record-dialog-slide-title\">Recording...</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"record-dialog-slide-description\">\n                    {`Recording track ${trackDone + 1} of ${trackTotal}: ${titleCurrent}`}\n                </DialogContentText>\n                <LinearProgress\n                    className={classes.progressBar}\n                    variant={trackCurrent >= 0 ? 'determinate' : 'indeterminate'}\n                    color=\"primary\"\n                    value={progressValue}\n                />\n                <Box className={classes.progressPerc}>{progressValue >= 0 ? `${progressValue}%` : ``}</Box>\n            </DialogContent>\n            <DialogActions></DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as errorDialogActions } from '../redux/error-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const ErrorDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let { visible, error } = useShallowEqualSelector(state => state.errorDialog);\n\n    const handleClose = useCallback(() => {\n        dispatch(errorDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"error-dialog-slide-title\"\n            aria-describedby=\"error-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Error</DialogTitle>\n            <DialogContent>\n                <DialogContentText id=\"alert-dialog-slide-description\">{error}</DialogContentText>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Close</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\nimport { actions as panicDialogActions } from '../redux/panic-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { TransitionProps } from '@material-ui/core/transitions';\nimport { Typography } from '@material-ui/core';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nexport const PanicDialog = (props: {}) => {\n    const dispatch = useDispatch();\n\n    let { visible, dismissed } = useShallowEqualSelector(state => state.panicDialog);\n\n    const handleReloadApp = useCallback(() => {\n        window.location.reload();\n    }, []);\n\n    const handleIgnore = useCallback(() => {\n        dispatch(panicDialogActions.dismiss());\n    }, [dispatch]);\n\n    return (\n        <Dialog\n            open={visible && !dismissed}\n            maxWidth={'sm'}\n            fullWidth={true}\n            scroll={'paper'}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"error-dialog-slide-title\"\n            aria-describedby=\"error-dialog-slide-description\"\n        >\n            <DialogTitle id=\"alert-dialog-slide-title\">Oops Something unexpected happened.</DialogTitle>\n            <DialogContent>\n                <Typography color=\"textSecondary\" variant=\"body1\" component=\"div\">\n                    Try to restart the app. If the error persists, try the followings:\n                    <ol>\n                        <li>Use your browser in incognito mode.</li>\n                        <li>Use a blank MiniDisc.</li>\n                        <li>Try to use Web MiniDisc on another computer.</li>\n                    </ol>\n                    If this does not solve the error, your unit might not be supported yet or you have encountered a bug. The full error is\n                    reported in the JS console.\n                </Typography>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleIgnore} size=\"small\">\n                    Ignore and Continue\n                </Button>\n                <Button onClick={handleReloadApp} color=\"primary\">\n                    Restart the App\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { actions as convertDialogActions } from '../redux/convert-dialog-feature';\nimport { convertAndUpload } from '../redux/actions';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport FormControl from '@material-ui/core/FormControl';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport { TransitionProps } from '@material-ui/core/transitions';\nimport { Typography } from '@material-ui/core';\nimport Select from '@material-ui/core/Select';\nimport Input from '@material-ui/core/Input';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nconst useStyles = makeStyles(theme => ({\n    container: {\n        display: 'flex',\n        flexDirection: 'row',\n    },\n    formControl: {\n        minWidth: 60,\n    },\n    toggleButton: {\n        minWidth: 40,\n    },\n    dialogContent: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        justifyContent: 'space-between',\n    },\n    rightBlock: {\n        display: 'flex',\n        flexDirection: 'column',\n    },\n    titleFormControl: {\n        marginTop: theme.spacing(1),\n    },\n}));\n\nexport const ConvertDialog = (props: { files: File[] }) => {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n\n    let { visible, format, titleSource, titleFormat } = useShallowEqualSelector(state => state.convertDialog);\n\n    const handleClose = useCallback(() => {\n        dispatch(convertDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    const handleChangeFormat = useCallback(\n        (ev, newFormat) => {\n            if (newFormat === null) {\n                return;\n            }\n            dispatch(convertDialogActions.setFormat(newFormat as string));\n        },\n        [dispatch]\n    );\n\n    const handleChangeTitleSource = useCallback(\n        (ev, newTitleSource) => {\n            if (newTitleSource === null) {\n                return;\n            }\n            dispatch(convertDialogActions.setTitleSource(newTitleSource));\n        },\n        [dispatch]\n    );\n\n    const handleChangeTitleFormat = useCallback(\n        (event: React.ChangeEvent<{ value: any }>) => {\n            dispatch(convertDialogActions.setTitleFormat(event.target.value));\n        },\n        [dispatch]\n    );\n\n    const handleConvert = useCallback(() => {\n        handleClose();\n        dispatch(convertAndUpload(props.files, format, titleSource, titleFormat));\n    }, [dispatch, props, format, titleSource, titleFormat]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'xs'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"convert-dialog-slide-title\"\n            aria-describedby=\"convert-dialog-slide-description\"\n        >\n            <DialogTitle id=\"convert-dialog-slide-title\">Upload Settings</DialogTitle>\n            <DialogContent className={classes.dialogContent}>\n                <FormControl>\n                    <Typography component=\"label\" variant=\"caption\" color=\"textSecondary\">\n                        Recording Mode\n                    </Typography>\n                    <ToggleButtonGroup value={format} exclusive onChange={handleChangeFormat} size=\"small\">\n                        <ToggleButton className={classes.toggleButton} value=\"SP\">\n                            SP\n                        </ToggleButton>\n                        <ToggleButton className={classes.toggleButton} value=\"LP2\">\n                            LP2\n                        </ToggleButton>\n                        <ToggleButton className={classes.toggleButton} value=\"LP4\">\n                            LP4\n                        </ToggleButton>\n                    </ToggleButtonGroup>\n                </FormControl>\n                <div className={classes.rightBlock}>\n                    <FormControl className={classes.formControl}>\n                        <Typography component=\"label\" variant=\"caption\" color=\"textSecondary\">\n                            Track title\n                        </Typography>\n                        <ToggleButtonGroup value={titleSource} exclusive onChange={handleChangeTitleSource} size=\"small\">\n                            <ToggleButton className={classes.toggleButton} value=\"file\">\n                                Filename\n                            </ToggleButton>\n                            <ToggleButton className={classes.toggleButton} value=\"media\">\n                                Media tags\n                            </ToggleButton>\n                        </ToggleButtonGroup>\n                    </FormControl>\n                    {titleSource === 'media' ? (\n                        <FormControl className={classes.titleFormControl}>\n                            <Select value={titleFormat} color=\"secondary\" input={<Input />} onChange={handleChangeTitleFormat}>\n                                <MenuItem value={`title`}>Title</MenuItem>\n                                <MenuItem value={`album-title`}>Album - Title</MenuItem>\n                                <MenuItem value={`artist-title`}>Artist - Title</MenuItem>\n                                <MenuItem value={`artist-album-title`}>Artist - Album - Title</MenuItem>\n                            </Select>\n                        </FormControl>\n                    ) : null}\n                </div>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Cancel</Button>\n                <Button onClick={handleConvert}>Ok</Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z\"\n}));\n\nconst SvgMd0 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd0, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md0.a7574f83.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M36.927 24.504c.992-1.544 2.25-2.448 5.124-3.474-5.486-4.744-7.34-6.324-14.003-12.173-11.485 3.264-19.33 9.02-20.049 15.647h28.928zM57.47 30.45c4.38 3.707 9.262 8.068 13.687 11.884 11.265-3.066 19.178-8.5 20.57-14.83H61.18c-.667.999-1.516 1.917-3.71 2.946z\"\n}));\n\nconst SvgMd1 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd1, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md1.1ffb5f6c.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M53.259 20.337c6.582-5.574 6.582-5.574 14.753-12.436C62.599 6.72 56.322 6 49.946 6c-6.485 0-12.82.747-18.303 1.966 6.675 5.894 7.084 6.191 14.006 12.252 3.48-.293 3.97-.293 7.61.12zM49.946 45c6.284 0 12.247-.64 17.6-1.79-4.721-4.135-7.729-6.721-13.454-11.689-3.681.692-6.213.59-9.6.068-4.888 4.125-10.974 9.218-13.473 11.324C36.707 44.248 43.137 45 49.946 45z\"\n}));\n\nconst SvgMd2 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd2, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md2.33dd03b3.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  fill: \"#000\",\n  fillRule: \"evenodd\"\n}, React.createElement(\"g\", {\n  fillRule: \"nonzero\"\n}, React.createElement(\"path\", {\n  d: \"M5.756 14.036l2.101 2.14c-2.173 2.135-3.623 4.401-4.303 6.721l-.101.367-2.906-.748c.776-3.013 2.552-5.872 5.209-8.48zM23.576 4.241l.902 2.861c-5.329 1.682-9.916 3.879-13.464 6.436l-.438.322-1.796-2.403c3.894-2.91 8.94-5.368 14.796-7.216zM47.825.5l.054 3c-6.79.122-13.336.962-19.288 2.445l-.846.216-.76-2.902C33.395 1.581 40.477.632 47.825.5zM92.67 14.036l-2.101 2.14c2.173 2.135 3.624 4.401 4.303 6.721l.101.367 2.906-.748c-.776-3.013-2.552-5.872-5.209-8.48zM74.85 4.241l-.902 2.861c5.329 1.682 9.916 3.879 13.464 6.436l.438.322 1.796-2.403c-3.893-2.91-8.94-5.368-14.796-7.216zM50.601.5l-.054 3c6.79.122 13.336.962 19.288 2.445l.846.216.76-2.902C65.031 1.581 57.95.632 50.601.5zM5.756 37.964l2.101-2.14c-2.173-2.135-3.623-4.401-4.303-6.721l-.101-.367-2.906.748c.776 3.013 2.552 5.872 5.209 8.48zM23.576 47.759l.902-2.861c-5.329-1.682-9.916-3.879-13.464-6.436l-.438-.322-1.796 2.403c3.894 2.91 8.94 5.368 14.796 7.216zM47.825 51.5l.054-3c-6.79-.122-13.336-.962-19.288-2.445l-.846-.216-.76 2.902c6.41 1.678 13.492 2.627 20.84 2.759zM92.67 37.964l-2.101-2.14c2.173-2.135 3.624-4.401 4.303-6.721l.101-.367 2.906.748c-.776 3.013-2.552 5.872-5.209 8.48zM74.85 47.759l-.902-2.861c5.329-1.682 9.916-3.879 13.464-6.436l.438-.322 1.796 2.403c-3.893 2.91-8.94 5.368-14.796 7.216zM50.601 51.5l-.054-3c6.79-.122 13.336-.962 19.288-2.445l.846-.216.76 2.902c-6.41 1.678-13.492 2.627-20.84 2.759z\"\n})), React.createElement(\"path\", {\n  d: \"M61.159 24.504c14.02 0 20.615 0 30.732-.004-.789-6.629-8.72-12.468-20.269-15.706-2.061 1.766-11.14 9.316-14.827 12.484 1.793.813 3.226 1.35 4.364 3.226zM40.996 30.602c-2.045-.884-3.476-1.935-4.042-3.102-1.056 0-26.431 0-28.782.039C9.53 33.6 16.924 38.847 27.455 41.964c4.236-3.528 8.255-6.948 13.541-11.362z\"\n}));\n\nconst SvgMd3 = ({\n  svgRef,\n  title,\n  ...props\n}) => React.createElement(\"svg\", _extends({\n  width: 98,\n  height: 52,\n  viewBox: \"0 0 98 52\",\n  ref: svgRef\n}, props), title ? React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => React.createElement(SvgMd3, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/md3.80f42826.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\nimport StopIcon from '@material-ui/icons/Stop';\nimport SkipNextIcon from '@material-ui/icons/SkipNext';\nimport SkipPreviousIcon from '@material-ui/icons/SkipPrevious';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Box from '@material-ui/core/Box';\n\nimport { makeStyles } from '@material-ui/core';\nimport { belowDesktop, getSortedTracks, useShallowEqualSelector } from '../utils';\nimport { control } from '../redux/actions';\nimport { shallowEqual, useDispatch } from 'react-redux';\n\nimport { ReactComponent as MDIcon0 } from '../images/md0.svg';\nimport { ReactComponent as MDIcon1 } from '../images/md1.svg';\nimport { ReactComponent as MDIcon2 } from '../images/md2.svg';\nimport { ReactComponent as MDIcon3 } from '../images/md3.svg';\n\nconst frames = [MDIcon0, MDIcon1, MDIcon2, MDIcon3];\n\nconst useStyles = makeStyles(theme => ({\n    '@keyframes scrollLeft': {\n        from: {\n            transform: `translateX(0%)`,\n        },\n        to: {},\n    },\n    container: {\n        display: 'flex',\n        flex: '1 1 auto',\n        [belowDesktop(theme)]: {\n            flexWrap: 'wrap',\n        },\n    },\n    lcd: {\n        flex: '1 1 auto',\n        position: 'relative',\n        marginLeft: theme.spacing(1.5),\n        marginRight: theme.spacing(1.5),\n        paddingLeft: theme.spacing(3),\n        paddingRight: theme.spacing(3),\n        borderRadius: theme.spacing(3),\n        backgroundColor: theme.palette.background.default,\n        minWidth: 150,\n        height: 48,\n        [belowDesktop(theme)]: {\n            marginLeft: 0,\n            marginRight: theme.spacing(2),\n        },\n    },\n    lcdText: {\n        overflow: 'hidden',\n        position: 'relative',\n        width: 'calc(100% - 40px)',\n        left: 40,\n        height: '100%',\n        fontFamily: 'LCDDot',\n    },\n    lcdDisc: {\n        position: 'absolute',\n        top: 0,\n        left: 20,\n    },\n    lcdDiscIcon: {\n        width: 28,\n        height: 48,\n        '& g': {\n            fill: theme.palette.action.active,\n        },\n    },\n    scrollingStatusMessage: {\n        position: 'absolute',\n        width: '100%',\n        whiteSpace: 'nowrap',\n        animationName: '$scrollLeft',\n        animationTimingFunction: 'linear',\n        animationIterationCount: '1',\n        top: 15,\n        left: 1,\n    },\n    statusMessage: {\n        position: 'absolute',\n        width: '100%',\n        whiteSpace: 'nowrap',\n        top: 15,\n        left: 1,\n    },\n    button: {\n        // padding: 8,\n    },\n}));\n\nexport const Controls = () => {\n    const dispatch = useDispatch();\n    // TODO: The shallow equality won't work for these 2 states\n    const deviceStatus = useShallowEqualSelector(state => state.main.deviceStatus);\n    const disc = useShallowEqualSelector(state => state.main.disc);\n\n    const classes = useStyles();\n    const handlePrev = useCallback(() => {\n        dispatch(control('prev'));\n    }, [dispatch]);\n    const handlePlay = useCallback(() => {\n        dispatch(control('play'));\n    }, [dispatch]);\n    const handleStop = useCallback(() => {\n        dispatch(control('stop'));\n    }, [dispatch]);\n    const handleNext = useCallback(() => {\n        dispatch(control('next'));\n    }, [dispatch]);\n\n    let message = ``;\n    let trackIndex = deviceStatus?.track ?? null;\n    let deviceState = deviceStatus?.state ?? null;\n    let discPresent = deviceStatus?.discPresent ?? false;\n    const tracks = getSortedTracks(disc);\n    if (!discPresent) {\n        message = ``;\n    } else if (deviceState === 'readingTOC') {\n        message = 'READING TOC';\n    } else if (tracks.length === 0) {\n        message = `BLANKDISC`;\n    } else if (deviceStatus && deviceStatus.track !== null) {\n        message = `${deviceStatus.track + 1} - ` + tracks[deviceStatus.track].title;\n    }\n\n    const [lcdScroll, setLcdScroll] = useState(0);\n    const [lcdScrollDuration, setLcdScrollDuration] = useState(0);\n    const [lcdIconFrame, setLcdIconFrame] = useState(0);\n\n    // LCD Text scrolling\n    const animationDelayInMS = 2000;\n    const scrollTimerRef = useRef<any>(null);\n    const lcdRef = useRef<HTMLParagraphElement>(null);\n    useEffect(() => {\n        const updateLCDScroll = () => {\n            const domEl = lcdRef.current;\n            const textWidth = domEl?.scrollWidth ?? 0;\n            const lcdWidth = domEl?.parentElement?.offsetWidth ?? 0;\n            const scrollPerc = textWidth > lcdWidth ? (textWidth * 100) / lcdWidth : 0;\n            const scrollDurationInSec = textWidth > lcdWidth ? textWidth / 20 : 0; // Compute duration to achieve constant speed\n            setLcdScroll(scrollPerc);\n            setLcdScrollDuration(scrollDurationInSec);\n            if (scrollDurationInSec > 0) {\n                scrollTimerRef.current = setTimeout(() => {\n                    setLcdScroll(0);\n                }, scrollDurationInSec * 1000 + 500); // stop animation timer\n            }\n        };\n\n        clearTimeout(scrollTimerRef.current);\n        setLcdScroll(0);\n        scrollTimerRef.current = setTimeout(() => {\n            updateLCDScroll();\n        }, animationDelayInMS); // start animation timer\n\n        return () => {\n            clearTimeout(scrollTimerRef.current); // clear all the timers on unmount\n        };\n    }, [trackIndex, deviceState, message]);\n\n    // Disc animation\n    const lcdIconAnimationTimer = useRef<any>(null);\n    useEffect(() => {\n        clearInterval(lcdIconAnimationTimer.current);\n        if (deviceState === 'playing' || deviceState === 'readingTOC') {\n            lcdIconAnimationTimer.current = setInterval(() => {\n                setLcdIconFrame(1 + (lcdIconFrame % (frames.length - 1)));\n            }, 600);\n        } else {\n            setLcdIconFrame(0);\n        }\n        return () => {\n            clearInterval(lcdIconAnimationTimer.current);\n        };\n    }, [deviceState, lcdIconFrame]);\n\n    const DiscFrame = frames[lcdIconFrame];\n    return (\n        <Box className={classes.container}>\n            <IconButton aria-label=\"prev\" onClick={handlePrev} className={classes.button}>\n                <SkipPreviousIcon />\n            </IconButton>\n            <IconButton aria-label=\"play\" onClick={handlePlay} className={classes.button}>\n                <PlayArrowIcon />\n            </IconButton>\n            <IconButton aria-label=\"stop\" onClick={handleStop} className={classes.button}>\n                <StopIcon />\n            </IconButton>\n            <IconButton aria-label=\"next\" onClick={handleNext} className={classes.button}>\n                <SkipNextIcon />\n            </IconButton>\n            <div className={classes.lcd}>\n                <div className={classes.lcdText}>\n                    <span\n                        className={lcdScroll ? classes.scrollingStatusMessage : classes.statusMessage}\n                        ref={lcdRef}\n                        style={\n                            message && lcdScroll > 0\n                                ? { animationDuration: `${lcdScrollDuration}s`, transform: `translate(-${lcdScroll}%)` }\n                                : {}\n                        }\n                    >\n                        {message}\n                    </span>\n                </div>\n                <div className={classes.lcdDisc}>{discPresent && <DiscFrame className={classes.lcdDiscIcon} />}</div>\n            </div>\n        </Box>\n    );\n};\n","import React, { useEffect, useState, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useShallowEqualSelector } from '../utils';\n\nimport { recordTracks } from '../redux/actions';\nimport { actions as dumpDialogActions } from '../redux/dump-dialog-feature';\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Slide from '@material-ui/core/Slide';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport { Controls } from './controls';\nimport Box from '@material-ui/core/Box';\nimport serviceRegistry from '../services/registry';\nimport { TransitionProps } from '@material-ui/core/transitions';\n\nconst Transition = React.forwardRef(function Transition(\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\n    ref: React.Ref<unknown>\n) {\n    return <Slide direction=\"up\" ref={ref} {...props} />;\n});\n\nconst useStyles = makeStyles(theme => ({\n    container: {\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'flex-end',\n        justifyContent: 'space-between',\n        marginRight: -theme.spacing(2),\n        flexFlow: 'wrap',\n    },\n    formControl: {\n        minWidth: 120,\n    },\n    selectEmpty: {\n        marginTop: theme.spacing(2),\n    },\n    head: {\n        textShadow: '0px 0px 12px rgba(150, 150, 150, 1)',\n        fontSize: theme.typography.h2.fontSize,\n        textAlign: 'center',\n        marginBottom: theme.spacing(2),\n    },\n}));\n\nexport const DumpDialog = ({ trackIndexes }: { trackIndexes: number[] }) => {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n\n    const [devices, setDevices] = useState<{ deviceId: string; label: string }[]>([]);\n    const [inputDeviceId, setInputDeviceId] = useState<string>('');\n\n    let { visible } = useShallowEqualSelector(state => state.dumpDialog);\n\n    const handleClose = useCallback(() => {\n        setInputDeviceId('');\n        serviceRegistry.mediaRecorderService?.stopTestInput();\n        dispatch(dumpDialogActions.setVisible(false));\n    }, [dispatch]);\n\n    const handleChange = useCallback(\n        (ev: React.ChangeEvent<{ value: unknown }>) => {\n            const deviceId = ev.target.value as string;\n            setInputDeviceId(deviceId);\n            serviceRegistry.mediaRecorderService?.stopTestInput();\n            serviceRegistry.mediaRecorderService?.playTestInput(deviceId);\n        },\n        [setInputDeviceId]\n    );\n\n    const handleStartTransfer = useCallback(() => {\n        dispatch(recordTracks(trackIndexes, inputDeviceId));\n        handleClose();\n    }, [trackIndexes, inputDeviceId, dispatch, handleClose]);\n\n    useEffect(() => {\n        async function updateDeviceList() {\n            await navigator.mediaDevices.getUserMedia({ audio: true });\n            let devices = await navigator.mediaDevices.enumerateDevices();\n            let inputDevices = devices\n                .filter(device => device.kind === 'audioinput')\n                .map(device => ({ deviceId: device.deviceId, label: device.label }));\n            setDevices(inputDevices);\n        }\n        if (visible) {\n            updateDeviceList();\n        }\n    }, [visible, setDevices]);\n\n    return (\n        <Dialog\n            open={visible}\n            maxWidth={'sm'}\n            fullWidth={true}\n            TransitionComponent={Transition as any}\n            aria-labelledby=\"dump-dialog-slide-title\"\n            aria-describedby=\"dump-dialog-slide-description\"\n        >\n            <DialogTitle id=\"dump-dialog-slide-title\">Record Selected Tracks</DialogTitle>\n            <DialogContent>\n                <Typography component=\"p\" variant=\"h2\" className={classes.head}>\n                    {`  `}\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    1. Connect your MD Player line-out to your PC audio line-in.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    2. Use the controls at the bottom right to play some tracks.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    3. Select the input source. You should hear the tracks playing on your PC.\n                </Typography>\n                <Typography component=\"p\" variant=\"body2\">\n                    4. Adjust the input gain and the line-out volume of your device.\n                </Typography>\n                <Box className={classes.container}>\n                    <FormControl className={classes.formControl}>\n                        <Select value={inputDeviceId} onChange={handleChange} displayEmpty className={classes.selectEmpty}>\n                            <MenuItem value=\"\" disabled>\n                                Input Source\n                            </MenuItem>\n                            {devices.map(device => (\n                                <MenuItem key={device.deviceId} value={device.deviceId}>\n                                    {device.label}\n                                </MenuItem>\n                            ))}\n                        </Select>\n                        <FormHelperText>Input Source</FormHelperText>\n                    </FormControl>\n                    <Controls />\n                </Box>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleClose}>Cancel</Button>\n                <Button onClick={handleStartTransfer} disabled={inputDeviceId === ''}>\n                    Start Record\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n};\n","import React, { useEffect, useCallback } from 'react';\nimport { useDispatch } from 'react-redux';\nimport clsx from 'clsx';\nimport { useDropzone } from 'react-dropzone';\nimport { listContent, deleteTracks, moveTrack } from '../redux/actions';\nimport { actions as renameDialogActions } from '../redux/rename-dialog-feature';\nimport { actions as convertDialogActions } from '../redux/convert-dialog-feature';\nimport { actions as dumpDialogActions } from '../redux/dump-dialog-feature';\n\nimport { formatTimeFromFrames, getTracks } from 'netmd-js';\n\nimport { belowDesktop, forAnyDesktop, getSortedTracks, useShallowEqualSelector } from '../utils';\n\nimport { lighten, makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Box from '@material-ui/core/Box';\nimport Fab from '@material-ui/core/Fab';\nimport AddIcon from '@material-ui/icons/Add';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport EditIcon from '@material-ui/icons/Edit';\nimport Backdrop from '@material-ui/core/Backdrop';\n\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\n\nimport IconButton from '@material-ui/core/IconButton';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { batchActions } from 'redux-batched-actions';\n\nimport { RenameDialog } from './rename-dialog';\nimport { UploadDialog } from './upload-dialog';\nimport { RecordDialog } from './record-dialog';\nimport { ErrorDialog } from './error-dialog';\nimport { PanicDialog } from './panic-dialog';\nimport { ConvertDialog } from './convert-dialog';\nimport { AboutDialog } from './about-dialog';\nimport { DumpDialog } from './dump-dialog';\nimport { TopMenu } from './topmenu';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport * as BadgeImpl from '@material-ui/core/Badge/Badge';\nimport Button from '@material-ui/core/Button';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nconst useStyles = makeStyles(theme => ({\n    add: {\n        position: 'absolute',\n        bottom: theme.spacing(3),\n        right: theme.spacing(3),\n        [belowDesktop(theme)]: {\n            bottom: theme.spacing(2),\n        },\n    },\n    main: {\n        overflowY: 'auto',\n        flex: '1 1 auto',\n        marginBottom: theme.spacing(3),\n        outline: 'none',\n        marginLeft: theme.spacing(-1),\n        marginRight: theme.spacing(-1),\n        [forAnyDesktop(theme)]: {\n            marginLeft: theme.spacing(-2),\n            marginRight: theme.spacing(-2),\n        },\n    },\n    toolbar: {\n        marginTop: theme.spacing(3),\n        marginLeft: theme.spacing(-2),\n        marginRight: theme.spacing(-2),\n        [theme.breakpoints.up(600 + theme.spacing(2) * 2)]: {\n            marginLeft: theme.spacing(-3),\n            marginRight: theme.spacing(-3),\n        },\n    },\n    toolbarLabel: {\n        flex: '1 1 100%',\n    },\n    toolbarHighlight:\n        theme.palette.type === 'light'\n            ? {\n                  color: theme.palette.secondary.main,\n                  backgroundColor: lighten(theme.palette.secondary.light, 0.85),\n              }\n            : {\n                  color: theme.palette.text.primary,\n                  backgroundColor: theme.palette.secondary.dark,\n              },\n    headBox: {\n        display: 'flex',\n        justifyContent: 'space-between',\n    },\n    spacing: {\n        marginTop: theme.spacing(1),\n    },\n    formatBadge: {\n        ...(BadgeImpl as any).styles(theme).badge,\n        ...(BadgeImpl as any).styles(theme).colorPrimary,\n        position: 'static',\n        display: 'inline-flex',\n        border: `2px solid ${theme.palette.background.paper}`,\n        padding: '0 4px',\n        verticalAlign: 'middle',\n        width: theme.spacing(4.5),\n        marginRight: theme.spacing(0.5),\n    },\n    titleCell: {\n        overflow: 'hidden',\n        maxWidth: '40ch',\n        textOverflow: 'ellipsis',\n        // whiteSpace: 'nowrap',\n    },\n    durationCell: {\n        whiteSpace: 'nowrap',\n    },\n    durationCellTime: {\n        verticalAlign: 'middle',\n    },\n    indexCell: {\n        whiteSpace: 'nowrap',\n        paddingRight: 0,\n        width: `2ch`,\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n    remainingTimeTooltip: {\n        textDecoration: 'underline',\n        textDecorationStyle: 'dotted',\n    },\n}));\n\nexport const Main = (props: {}) => {\n    let dispatch = useDispatch();\n    let disc = useShallowEqualSelector(state => state.main.disc);\n    let deviceName = useShallowEqualSelector(state => state.main.deviceName);\n\n    const [selected, setSelected] = React.useState<number[]>([]);\n    const selectedCount = selected.length;\n\n    const [moveMenuAnchorEl, setMoveMenuAnchorEl] = React.useState<null | HTMLElement>(null);\n    const handleShowMoveMenu = useCallback((event: React.MouseEvent<HTMLButtonElement>) => {\n        setMoveMenuAnchorEl(event.currentTarget);\n    }, []);\n    const handleCloseMoveMenu = useCallback(() => {\n        setMoveMenuAnchorEl(null);\n    }, []);\n    const handleMoveSelectedTrack = useCallback(\n        (destIndex: number) => {\n            dispatch(moveTrack(selected[0], destIndex));\n            handleCloseMoveMenu();\n        },\n        [dispatch, selected, handleCloseMoveMenu]\n    );\n\n    const handleShowDumpDialog = useCallback(() => {\n        dispatch(dumpDialogActions.setVisible(true));\n    }, [dispatch]);\n\n    useEffect(() => {\n        dispatch(listContent());\n    }, [dispatch]);\n\n    useEffect(() => {\n        setSelected([]); // Reset selection if disc changes\n    }, [disc]);\n\n    let [uploadedFiles, setUploadedFiles] = React.useState<File[]>([]);\n    const onDrop = useCallback(\n        (acceptedFiles: File[], rejectedFiles: File[]) => {\n            setUploadedFiles(acceptedFiles);\n            dispatch(convertDialogActions.setVisible(true));\n        },\n        [dispatch]\n    );\n    const { getRootProps, getInputProps, isDragActive, open } = useDropzone({\n        onDrop,\n        accept: [`audio/*`, `video/mp4`],\n        noClick: true,\n    });\n\n    const classes = useStyles();\n    const tracks = getSortedTracks(disc);\n\n    // Action Handlers\n    const handleSelectClick = (event: React.MouseEvent, item: number) => {\n        if (selected.includes(item)) {\n            setSelected(selected.filter(i => i !== item));\n        } else {\n            setSelected([...selected, item]);\n        }\n    };\n\n    const handleSelectAllClick = (event: React.ChangeEvent<HTMLInputElement>) => {\n        if (selected.length < tracks.length) {\n            setSelected(tracks.map(t => t.index));\n        } else {\n            setSelected([]);\n        }\n    };\n\n    const handleRenameDoubleClick = (event: React.MouseEvent, item: number) => {\n        let selectedIndex = item;\n        let currentName = getTracks(disc!).find(track => track.index === selectedIndex)?.title ?? '';\n\n        dispatch(\n            batchActions([\n                renameDialogActions.setVisible(true),\n                renameDialogActions.setCurrentName(currentName),\n                renameDialogActions.setIndex(selectedIndex),\n            ])\n        );\n    };\n\n    const handleRenameActionClick = (event: React.MouseEvent) => {\n        handleRenameDoubleClick(event, selected[0]);\n    };\n\n    const handleDeleteSelected = (event: React.MouseEvent) => {\n        dispatch(deleteTracks(selected));\n    };\n\n    return (\n        <React.Fragment>\n            <Box className={classes.headBox}>\n                <Typography component=\"h1\" variant=\"h4\">\n                    {deviceName || `Loading...`}\n                </Typography>\n                <TopMenu />\n            </Box>\n            <Typography component=\"h2\" variant=\"body2\">\n                {disc !== null ? (\n                    <React.Fragment>\n                        <span>{`${formatTimeFromFrames(disc.left, false)} left of ${formatTimeFromFrames(disc.total, false)} `}</span>\n                        <Tooltip\n                            title={\n                                <React.Fragment>\n                                    <span>{`${formatTimeFromFrames(disc.left * 2, false)} left in LP2 Mode`}</span>\n                                    <br />\n                                    <span>{`${formatTimeFromFrames(disc.left * 4, false)} left in LP4 Mode`}</span>\n                                </React.Fragment>\n                            }\n                            arrow\n                        >\n                            <span className={classes.remainingTimeTooltip}>SP Mode</span>\n                        </Tooltip>\n                    </React.Fragment>\n                ) : (\n                    `Loading...`\n                )}\n            </Typography>\n            <Toolbar\n                className={clsx(classes.toolbar, {\n                    [classes.toolbarHighlight]: selectedCount > 0,\n                })}\n            >\n                {selectedCount > 0 ? (\n                    <Checkbox\n                        indeterminate={selectedCount > 0 && selectedCount < tracks.length}\n                        checked={selectedCount > 0}\n                        onChange={handleSelectAllClick}\n                        inputProps={{ 'aria-label': 'select all tracks' }}\n                    />\n                ) : null}\n                {selectedCount > 0 ? (\n                    <Typography className={classes.toolbarLabel} color=\"inherit\" variant=\"subtitle1\">\n                        {selectedCount} selected\n                    </Typography>\n                ) : (\n                    <Typography component=\"h3\" variant=\"h6\" className={classes.toolbarLabel}>\n                        {disc?.title || `Untitled Disc`}\n                    </Typography>\n                )}\n                {selectedCount === 1 ? (\n                    <React.Fragment>\n                        <Tooltip title=\"Move to Position\">\n                            <Button aria-controls=\"move-menu\" aria-label=\"Move\" onClick={handleShowMoveMenu}>\n                                Move\n                            </Button>\n                        </Tooltip>\n                        <Menu\n                            id=\"move-menu\"\n                            anchorEl={moveMenuAnchorEl}\n                            open={!!moveMenuAnchorEl}\n                            onClose={handleCloseMoveMenu}\n                            PaperProps={{\n                                style: {\n                                    maxHeight: 300,\n                                },\n                            }}\n                        >\n                            {Array(tracks.length)\n                                .fill(null)\n                                .map((_, i) => {\n                                    return (\n                                        <MenuItem key={`pos-${i}`} onClick={() => handleMoveSelectedTrack(i)}>\n                                            {i + 1}\n                                        </MenuItem>\n                                    );\n                                })}\n                        </Menu>\n                    </React.Fragment>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <React.Fragment>\n                        <Tooltip title=\"Record from MD\">\n                            <Button aria-label=\"Record\" onClick={handleShowDumpDialog}>\n                                Record\n                            </Button>\n                        </Tooltip>\n                    </React.Fragment>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <Tooltip title=\"Delete\">\n                        <IconButton aria-label=\"delete\" onClick={handleDeleteSelected}>\n                            <DeleteIcon />\n                        </IconButton>\n                    </Tooltip>\n                ) : null}\n\n                {selectedCount > 0 ? (\n                    <Tooltip title=\"Rename\">\n                        <IconButton aria-label=\"rename\" disabled={selectedCount !== 1} onClick={handleRenameActionClick}>\n                            <EditIcon />\n                        </IconButton>\n                    </Tooltip>\n                ) : null}\n            </Toolbar>\n            <Box className={classes.main} {...getRootProps()}>\n                <input {...getInputProps()} />\n                <Table size=\"small\">\n                    <TableHead>\n                        <TableRow>\n                            <TableCell className={classes.indexCell}>#</TableCell>\n                            <TableCell>Title</TableCell>\n                            <TableCell align=\"right\">Duration</TableCell>\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {tracks.map(track => (\n                            <TableRow\n                                hover\n                                selected={selected.includes(track.index)}\n                                key={track.index}\n                                onDoubleClick={event => handleRenameDoubleClick(event, track.index)}\n                                onClick={event => handleSelectClick(event, track.index)}\n                            >\n                                <TableCell className={classes.indexCell}>{track.index + 1}</TableCell>\n                                <TableCell className={classes.titleCell} title={track.title}>\n                                    {track.title || `No Title`}\n                                </TableCell>\n                                <TableCell align=\"right\" className={classes.durationCell}>\n                                    <span className={classes.formatBadge}>{track.encoding}</span>\n                                    <span className={classes.durationCellTime}>{track.duration}</span>\n                                </TableCell>\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n                <Backdrop className={classes.backdrop} open={isDragActive}>\n                    Drop your Music to Upload\n                </Backdrop>\n            </Box>\n            <Fab color=\"primary\" aria-label=\"add\" className={classes.add} onClick={open}>\n                <AddIcon />\n            </Fab>\n\n            <UploadDialog />\n            <RenameDialog />\n            <ErrorDialog />\n            <ConvertDialog files={uploadedFiles} />\n            <RecordDialog />\n            <DumpDialog trackIndexes={selected} />\n            <AboutDialog />\n            <PanicDialog />\n        </React.Fragment>\n    );\n};\n","import React from 'react';\nimport { belowDesktop, forAnyDesktop, forWideDesktop, useShallowEqualSelector } from '../utils';\n\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makeStyles, createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\n\nimport { Welcome } from './welcome';\nimport { Main } from './main';\nimport { Controls } from './controls';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Link from '@material-ui/core/Link';\nimport Box from '@material-ui/core/Box';\nimport { useDispatch } from 'react-redux';\n\nconst useStyles = makeStyles(theme => ({\n    layout: {\n        width: 'auto',\n        height: '100%',\n        [forAnyDesktop(theme)]: {\n            width: 600,\n            marginLeft: 'auto',\n            marginRight: 'auto',\n        },\n        [forWideDesktop(theme)]: {\n            width: 700,\n        },\n    },\n\n    paper: {\n        position: 'relative',\n        display: 'flex',\n        flexDirection: 'column',\n        padding: theme.spacing(2),\n        height: 'calc(100% - 20px)',\n        [forAnyDesktop(theme)]: {\n            marginTop: theme.spacing(2),\n            marginBottom: theme.spacing(1),\n            padding: theme.spacing(3),\n            height: 600,\n        },\n        [forWideDesktop(theme)]: {\n            height: 700,\n        },\n    },\n    bottomBar: {\n        display: 'flex',\n        alignItems: 'center',\n        [belowDesktop(theme)]: {\n            flexWrap: 'wrap',\n        },\n        marginLeft: -theme.spacing(2),\n    },\n    copyrightTypography: {\n        marginRight: theme.spacing(1),\n        textAlign: 'center',\n    },\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n    minidiscLogo: {\n        width: 48,\n    },\n    controlsContainer: {\n        flex: '0 0 auto',\n        width: '100%',\n        paddingRight: theme.spacing(8),\n        [belowDesktop(theme)]: {\n            paddingLeft: 0,\n        },\n    },\n}));\n\nconst darkTheme = createMuiTheme({\n    palette: {\n        type: 'dark',\n        primary: {\n            light: '#6ec6ff',\n            main: '#2196f3',\n            dark: '#0069c0',\n            contrastText: '#fff',\n        },\n    },\n});\n\nconst lightTheme = createMuiTheme({\n    palette: {\n        type: 'light',\n    },\n});\n\nconst App = () => {\n    const classes = useStyles();\n\n    const dispatch = useDispatch();\n    let { mainView, loading, darkMode } = useShallowEqualSelector(state => state.appState);\n\n    return (\n        <React.Fragment>\n            <ThemeProvider theme={darkMode ? darkTheme : lightTheme}>\n                <CssBaseline />\n\n                <main className={classes.layout}>\n                    <Paper className={classes.paper}>\n                        {mainView === 'WELCOME' ? <Welcome /> : null}\n                        {mainView === 'MAIN' ? <Main /> : null}\n\n                        <Box className={classes.controlsContainer}>{mainView === 'MAIN' ? <Controls /> : null}</Box>\n                    </Paper>\n                    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.copyrightTypography}>\n                        {' '}\n                        <Link rel=\"noopener noreferrer\" color=\"inherit\" target=\"_blank\" href=\"https://stefano.brilli.me/\">\n                            Stefano Brilli\n                        </Link>{' '}\n                        {new Date().getFullYear()}\n                        {'.'}\n                    </Typography>\n                </main>\n\n                <Backdrop className={classes.backdrop} open={loading}>\n                    <CircularProgress color=\"inherit\" />\n                </Backdrop>\n            </ThemeProvider>\n        </React.Fragment>\n    );\n};\n\nexport default App;\n","/* eslint no-restricted-globals: 0 */\nimport { getPublicPathFor } from '../utils';\nexport class AtracdencProcess {\n    private messageCallback?: (ev: MessageEvent) => void;\n\n    constructor(public worker: Worker) {\n        worker.onmessage = this.handleMessage.bind(this);\n    }\n\n    async init() {\n        await new Promise<MessageEvent>(resolve => {\n            this.messageCallback = resolve;\n            this.worker.postMessage({ action: 'init' });\n        });\n    }\n\n    async encode(data: ArrayBuffer, bitrate: string) {\n        let eventData = await new Promise<MessageEvent>(resolve => {\n            this.messageCallback = resolve;\n            this.worker.postMessage({ action: 'encode', bitrate, data }, [data]);\n        });\n        return eventData.data.result as Uint8Array;\n    }\n\n    terminate() {\n        this.worker.terminate();\n    }\n\n    handleMessage(ev: MessageEvent) {\n        this.messageCallback!(ev);\n        this.messageCallback = undefined;\n    }\n}\n\nif (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope) {\n    // Worker\n    let Module: any;\n    onmessage = async (ev: MessageEvent) => {\n        const { action, ...others } = ev.data;\n        if (action === 'init') {\n            self.importScripts(getPublicPathFor(`atracdenc.js`));\n            (self as any).Module().then((m: any) => {\n                Module = m;\n                self.postMessage({ action: 'init' });\n                Module.setLogger && Module.setLogger((msg: string, stream: string) => console.log(`${stream}: ${msg}`));\n            });\n        } else if (action === 'encode') {\n            const { bitrate, data } = others;\n            const inWavFile = `inWavFile.wav`;\n            const outAt3File = `outAt3File.aea`;\n            const dataArray = new Uint8Array(data);\n            Module.FS.writeFile(`${inWavFile}`, dataArray);\n            Module.callMain([`-e`, `atrac3`, `-i`, inWavFile, `-o`, outAt3File, `--bitrate`, bitrate]);\n\n            // Read file and trim header (96 bytes)\n            let fileStat = Module.FS.stat(outAt3File);\n            let size = fileStat.size;\n            let tmp = new Uint8Array(size - 96);\n            let outAt3FileStream = Module.FS.open(outAt3File, 'r');\n            Module.FS.read(outAt3FileStream, tmp, 0, tmp.length, 96);\n            Module.FS.close(outAt3FileStream);\n\n            let result = tmp.buffer;\n\n            self.postMessage(\n                {\n                    action: 'encode',\n                    result,\n                },\n                [result]\n            );\n        }\n    };\n} else {\n    // Main\n}\n","import { createWorker, setLogging } from '@ffmpeg/ffmpeg';\nimport { AtracdencProcess } from './atracdenc-worker';\nimport { getPublicPathFor } from '../utils';\nconst AtracdencWorker = require('worker-loader!./atracdenc-worker'); // eslint-disable-line import/no-webpack-loader-syntax\n\ninterface LogPayload {\n    message: string;\n    action: string;\n}\n\nexport interface AudioExportService {\n    init(): Promise<void>;\n    export(params: { format: string }): Promise<ArrayBuffer>;\n    info(): Promise<{ format: string | null; input: string | null }>;\n    prepare(file: File): Promise<void>;\n}\n\nexport class FFMpegAudioExportService implements AudioExportService {\n    public ffmpegProcess: any;\n    public atracdencProcess?: AtracdencProcess;\n    public loglines: { action: string; message: string }[] = [];\n    public inFileName: string = ``;\n    public outFileNameNoExt: string = ``;\n\n    async init() {\n        setLogging(true);\n    }\n\n    async prepare(file: File) {\n        this.loglines = [];\n        this.ffmpegProcess = createWorker({\n            logger: (payload: LogPayload) => {\n                this.loglines.push(payload);\n                console.log(payload.action, payload.message);\n            },\n            corePath: getPublicPathFor('ffmpeg-core.js'),\n            workerPath: getPublicPathFor('worker.min.js'),\n        });\n        await this.ffmpegProcess.load();\n\n        this.atracdencProcess = new AtracdencProcess(new AtracdencWorker());\n        await this.atracdencProcess.init();\n\n        let ext = file.name.split('.').slice(-1);\n        if (ext.length === 0) {\n            throw new Error(`Unrecognized file format: ${file.name}`);\n        }\n\n        this.inFileName = `inAudioFile.${ext[0]}`;\n        this.outFileNameNoExt = `outAudioFile`;\n\n        await this.ffmpegProcess.write(this.inFileName, file);\n    }\n\n    async info() {\n        await this.ffmpegProcess.transcode(this.inFileName, `${this.outFileNameNoExt}.metadata`, `-f ffmetadata`);\n\n        let audioFormatRegex = /Audio:\\s(.*?),/; // Actual content\n        let inputFormatRegex = /Input #0,\\s(.*?),/; // Container\n        let format: string | null = null;\n        let input: string | null = null;\n\n        for (let line of this.loglines) {\n            let match = line.message.match(audioFormatRegex);\n            if (match !== null) {\n                format = match[1];\n                continue;\n            }\n            match = line.message.match(inputFormatRegex);\n            if (match !== null) {\n                input = match[1];\n                continue;\n            }\n            if (format !== null && input !== null) {\n                break;\n            }\n        }\n\n        return { format, input };\n    }\n\n    async export({ format }: { format: string }) {\n        let result: ArrayBuffer;\n        if (format === `SP`) {\n            const outFileName = `${this.outFileNameNoExt}.raw`;\n            await this.ffmpegProcess.transcode(this.inFileName, outFileName, '-f s16be -ar 44100');\n            let { data } = await this.ffmpegProcess.read(outFileName);\n            result = data.buffer;\n        } else {\n            const outFileName = `${this.outFileNameNoExt}.wav`;\n            await this.ffmpegProcess.transcode(this.inFileName, outFileName, '-f wav -ar 44100');\n            let { data } = await this.ffmpegProcess.read(outFileName);\n            let bitrate: string = `0`;\n            switch (format) {\n                case `LP2`:\n                    bitrate = `128`;\n                    break;\n                case `LP105`:\n                    bitrate = `102`;\n                    break;\n                case `LP4`:\n                    bitrate = `64`;\n                    break;\n            }\n            result = await this.atracdencProcess!.encode(data.buffer, bitrate);\n        }\n        this.ffmpegProcess.worker.terminate();\n        this.atracdencProcess!.terminate();\n        return result;\n    }\n}\n","/* eslint no-restricted-globals: 0 */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\nimport { NetMDUSBService } from './services/netmd';\nimport { NetMDMockService } from './services/netmd-mock';\nimport serviceRegistry from './services/registry';\n\nimport { store } from './redux/store';\nimport { actions as appActions } from './redux/app-feature';\nimport { actions as mainActions } from './redux/main-feature';\n\nimport App from './components/app';\n\nimport './index.css';\nimport './fonts/fonts.css';\n\nimport { FFMpegAudioExportService } from './services/audio-export';\nimport { MediaRecorderService } from './services/mediarecorder';\n\nserviceRegistry.netmdService = new NetMDUSBService({ debug: true });\n// serviceRegistry.netmdService = new NetMDMockService(); // Uncomment to work without a device attached\nserviceRegistry.audioExportService = new FFMpegAudioExportService();\nserviceRegistry.mediaRecorderService = new MediaRecorderService();\n\n(function setupEventHandlers() {\n    window.addEventListener('beforeunload', ev => {\n        let isUploading = store.getState().uploadDialog.visible;\n        if (!isUploading) {\n            return;\n        }\n        ev.preventDefault();\n        ev.returnValue = `Warning! Recording will be interrupted`;\n    });\n\n    if (navigator && navigator.usb) {\n        navigator.usb.ondisconnect = function() {\n            store.dispatch(appActions.setState('WELCOME'));\n        };\n    } else {\n        store.dispatch(appActions.setBrowserSupported(false));\n    }\n\n    // eslint-disable-next-line\n    let deferredPrompt: any;\n    window.addEventListener('beforeinstallprompt', (e: any) => {\n        e.preventDefault();\n        deferredPrompt = e;\n    });\n})();\n\n(function statusMonitorManager() {\n    // Polls the device for its state while playing tracks\n    let statusMonitorInterval: ReturnType<typeof setInterval> | null = null;\n    let exceptionOccurred: boolean = false;\n\n    function shouldMonitorBeRunning(state: ReturnType<typeof store.getState>): boolean {\n        return (\n            !exceptionOccurred &&\n            // App ready\n            state.appState.mainView === 'MAIN' &&\n            state.appState.loading === false &&\n            // Disc playing\n            state.main.deviceStatus?.state === 'playing' &&\n            // No operational dialogs running\n            state.convertDialog.visible === false &&\n            state.uploadDialog.visible === false &&\n            state.recordDialog.visible === false &&\n            state.panicDialog.visible === false &&\n            state.errorDialog.visible === false &&\n            state.dumpDialog.visible === false\n        );\n    }\n\n    store.subscribe(function() {\n        const state = store.getState();\n        if (shouldMonitorBeRunning(state) === true && statusMonitorInterval === null) {\n            // start monitor\n            statusMonitorInterval = setInterval(async () => {\n                try {\n                    const deviceStatus = await serviceRegistry.netmdService!.getDeviceStatus();\n                    store.dispatch(mainActions.setDeviceStatus(deviceStatus));\n                } catch (e) {\n                    console.error(e);\n                    exceptionOccurred = true; // Stop monitor on exception\n                }\n            }, 5000);\n        } else if (shouldMonitorBeRunning(state) === false && statusMonitorInterval !== null) {\n            // stop monitor\n            clearInterval(statusMonitorInterval);\n            statusMonitorInterval = null;\n        }\n    });\n})();\n\nReactDOM.render(\n    <Provider store={store}>\n        <App />\n    </Provider>,\n    document.getElementById('root')\n);\n\n// serviceWorker.unregister();\n// serviceWorker.register();\n","import { sanitizeTitle, getPublicPathFor } from '../utils';\nimport Recorder from 'recorderjs';\n\nexport class MediaRecorderService {\n    public recorder: any;\n    public stream?: MediaStream;\n    public audioContext?: AudioContext;\n    public analyserNode?: AnalyserNode;\n    public gainNode?: GainNode;\n\n    playTestInput(deviceId: string) {\n        this.audioContext = new AudioContext();\n        this.gainNode = this.audioContext.createGain();\n        this.analyserNode = this.audioContext.createAnalyser();\n\n        this.initStream(deviceId).then(() => {\n            const source = this.audioContext!.createMediaStreamSource(this.stream!);\n            source.connect(this.gainNode!);\n            this.gainNode!.connect(this.analyserNode!);\n            this.analyserNode!.connect(this.audioContext!.destination);\n        });\n    }\n\n    stopTestInput() {\n        if (!this.audioContext) {\n            return;\n        }\n        this.audioContext?.close();\n        delete this.audioContext;\n        this.closeStream();\n    }\n\n    async initStream(deviceId: string) {\n        const recordConstraints = {\n            // Try to set the best recording params for ripping the audio tracks\n            autoGainControl: false,\n            channelCount: 2,\n            deviceId: deviceId,\n            echoCancellation: false,\n            noiseSuppression: false,\n            sampleRate: 44100,\n            highpassFilter: false,\n        };\n        this.stream = await navigator.mediaDevices.getUserMedia({ audio: recordConstraints });\n\n        // Dump recording settings\n        const audioTracks = this.stream.getAudioTracks();\n        if (audioTracks.length > 0) {\n            console.log('Record Setings:', audioTracks[0].getSettings());\n        }\n    }\n\n    async startRecording() {\n        this.audioContext = new AudioContext();\n        const input = this.audioContext.createMediaStreamSource(this.stream!);\n        this.recorder = new Recorder(input, { workerPath: getPublicPathFor(`recorderWorker.js`) });\n        this.recorder.record();\n    }\n\n    async stopRecording() {\n        this.recorder.stop();\n    }\n\n    async closeStream() {\n        this.stream?.getTracks().forEach(track => track.stop());\n    }\n\n    downloadRecorded(title: string) {\n        this.recorder.exportWAV((buffer: Blob) => {\n            let url = URL.createObjectURL(buffer);\n            let a = document.createElement('a');\n            document.body.appendChild(a);\n            a.style.display = 'none';\n            a.href = url;\n            a.download = `${sanitizeTitle(title)}.wav`;\n            a.click();\n            window.URL.revokeObjectURL(url);\n            document.body.removeChild(a);\n        });\n    }\n}\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/* A bunch of utils. Some might be unused */\nvar buffer_1 = require(\"buffer\");\nvar jconv_1 = __importDefault(require(\"jconv\"));\nfunction sleep(msec) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, new Promise(function (resolve) { return setTimeout(resolve, msec); })];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.sleep = sleep;\nfunction withTimeout(timeoutInMs, cb) {\n    var _this = this;\n    return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n        var timer, result;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    timer = setTimeout(function () {\n                        reject(new Error(\"Operation timed out\"));\n                    }, timeoutInMs);\n                    return [4 /*yield*/, cb()];\n                case 1:\n                    result = _a.sent();\n                    clearTimeout(timer);\n                    resolve(result);\n                    return [2 /*return*/];\n            }\n        });\n    }); });\n}\nexports.withTimeout = withTimeout;\nfunction assert(condition, message) {\n    if (condition) {\n        return;\n    }\n    message = message || 'no message provided';\n    throw new Error(\"Assertion failed: \" + message);\n}\nexports.assert = assert;\nfunction assertBigInt(value, message) {\n    if (typeof value === 'bigint') {\n        return value;\n    }\n    throw assert(false, \"Expected BigInt type - \" + message);\n}\nexports.assertBigInt = assertBigInt;\nfunction assertNumber(value, message) {\n    if (typeof value === 'number') {\n        return value;\n    }\n    throw assert(false, \"Expected number type - \" + message);\n}\nexports.assertNumber = assertNumber;\nfunction assertString(value, message) {\n    if (typeof value === 'string') {\n        return value;\n    }\n    throw assert(false, \"Expected string type - \" + message);\n}\nexports.assertString = assertString;\nfunction assertUint8Array(value, message) {\n    if (value instanceof Uint8Array) {\n        return value;\n    }\n    throw assert(false, \"Expected Uint8Array type - \" + message);\n}\nexports.assertUint8Array = assertUint8Array;\nfunction stringToCharCodeArray(str) {\n    var result = new Array(str.length);\n    for (var i = 0; i < str.length; i++) {\n        result[i] = str.charCodeAt(i);\n    }\n    return result;\n}\nexports.stringToCharCodeArray = stringToCharCodeArray;\n// compare ArrayBuffers\nfunction arrayBuffersAreEqual(a, b) {\n    return dataViewsAreEqual(new DataView(a), new DataView(b));\n}\nexports.arrayBuffersAreEqual = arrayBuffersAreEqual;\n// compare DataViews\nfunction dataViewsAreEqual(a, b) {\n    if (a.byteLength !== b.byteLength)\n        return false;\n    for (var i = 0; i < a.byteLength; i++) {\n        if (a.getUint8(i) !== b.getUint8(i))\n            return false;\n    }\n    return true;\n}\nexports.dataViewsAreEqual = dataViewsAreEqual;\n// Thanks to https://gist.github.com/TooTallNate/4750953\nfunction isBigEndian() {\n    return new Uint8Array(new Uint32Array([0x12345678]).buffer)[0] === 0x12;\n}\nexports.isBigEndian = isBigEndian;\nfunction hexEncode(str) {\n    var hex;\n    var result = '';\n    for (var i = 0; i < str.length; i++) {\n        hex = str.charCodeAt(i).toString(16);\n        result += ('0' + hex).slice(-2);\n    }\n    return result;\n}\nexports.hexEncode = hexEncode;\nfunction arrayBufferToBinaryString(ab) {\n    var src = new Uint8Array(ab);\n    return uint8arrayToBinaryString(src);\n}\nexports.arrayBufferToBinaryString = arrayBufferToBinaryString;\nfunction uint8arrayToBinaryString(u8a) {\n    var dst = Array(u8a.length);\n    u8a.forEach(function (c, i) { return (dst[i] = String.fromCharCode(c)); });\n    return dst.join('');\n}\nexports.uint8arrayToBinaryString = uint8arrayToBinaryString;\nfunction concatUint8Arrays() {\n    var e_1, _a, e_2, _b;\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var totalLength = 0;\n    try {\n        for (var args_1 = __values(args), args_1_1 = args_1.next(); !args_1_1.done; args_1_1 = args_1.next()) {\n            var a = args_1_1.value;\n            totalLength += a.length;\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (args_1_1 && !args_1_1.done && (_a = args_1.return)) _a.call(args_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    var res = new Uint8Array(totalLength);\n    var offset = 0;\n    try {\n        for (var args_2 = __values(args), args_2_1 = args_2.next(); !args_2_1.done; args_2_1 = args_2.next()) {\n            var a = args_2_1.value;\n            res.set(a, offset);\n            offset += a.length;\n        }\n    }\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n    finally {\n        try {\n            if (args_2_1 && !args_2_1.done && (_b = args_2.return)) _b.call(args_2);\n        }\n        finally { if (e_2) throw e_2.error; }\n    }\n    return res;\n}\nexports.concatUint8Arrays = concatUint8Arrays;\nfunction concatArrayBuffers(buffer1, buffer2) {\n    var tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n    tmp.set(new Uint8Array(buffer1), 0);\n    tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n    return tmp.buffer;\n}\nexports.concatArrayBuffers = concatArrayBuffers;\n// Thanks to: https://gist.github.com/artjomb/7ef1ee574a411ba0dd1933c1ef4690d1\nfunction wordToByteArray(word, length) {\n    var ba = [], xFF = 0xff;\n    if (length > 0)\n        ba.push(word >>> 24);\n    if (length > 1)\n        ba.push((word >>> 16) & xFF);\n    if (length > 2)\n        ba.push((word >>> 8) & xFF);\n    if (length > 3)\n        ba.push(word & xFF);\n    return ba;\n}\nfunction wordArrayToByteArray(wordArray, length) {\n    if (length === void 0) { length = wordArray.sigBytes; }\n    var res = new Uint8Array(length);\n    var bytes;\n    var i = 0;\n    var offset = 0;\n    while (length > 0) {\n        bytes = wordToByteArray(wordArray.words[i], Math.min(4, length));\n        res.set(bytes, offset);\n        length -= bytes.length;\n        offset += bytes.length;\n        i++;\n    }\n    return res;\n}\nexports.wordArrayToByteArray = wordArrayToByteArray;\nfunction timeToFrames(time) {\n    assert(time.length === 4);\n    return ((time[0] * 60 + time[1]) * 60 + time[2]) * 512 + time[3];\n}\nexports.timeToFrames = timeToFrames;\nfunction pad(str, pad) {\n    return (pad + str).slice(-pad.length);\n}\nexports.pad = pad;\nfunction formatTimeFromFrames(value, frames) {\n    if (frames === void 0) { frames = true; }\n    var f = value % 512;\n    value = (value - f) / 512; // sec\n    var s = value % 60;\n    value = (value - s) / 60; // min\n    var m = value % 60;\n    value = (value - m) / 60; // hour\n    var h = value;\n    return pad(h, '00') + \":\" + pad(m, '00') + \":\" + pad(s, '00') + (frames ? \"+\" + pad(f, '000') : \"\");\n}\nexports.formatTimeFromFrames = formatTimeFromFrames;\nfunction sanitizeTrackTitle(title) {\n    return encodeURIComponent(title);\n}\nexports.sanitizeTrackTitle = sanitizeTrackTitle;\nfunction encodeToSJIS(utf8String) {\n    return jconv_1.default.encode(utf8String, 'SJIS');\n}\nexports.encodeToSJIS = encodeToSJIS;\nfunction decodeFromSJIS(sjisBuffer) {\n    return jconv_1.default.decode(buffer_1.Buffer.from(sjisBuffer), 'SJIS');\n}\nexports.decodeFromSJIS = decodeFromSJIS;\nfunction getLengthAfterEncodingToSJIS(utf8String) {\n    return encodeToSJIS(utf8String).length;\n}\nexports.getLengthAfterEncodingToSJIS = getLengthAfterEncodingToSJIS;\n//# sourceMappingURL=utils.js.map"],"sourceRoot":""}